


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>astropy.modeling.physical_models &#8212; Astropy v5.2.dev104+gcdd6a1f81.d20220509</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">Astropy v5.2.dev104+gcdd6a1f81.d20220509</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astropy.modeling.physical_models</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Models that have physical origins.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=invalid-name, no-member</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.utils.exceptions</span> <span class="kn">import</span> <span class="n">AstropyUserWarning</span>

<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">Fittable1DModel</span>
<span class="kn">from</span> <span class="nn">.parameters</span> <span class="kn">import</span> <span class="n">InputParameterError</span><span class="p">,</span> <span class="n">Parameter</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BlackBody&quot;</span><span class="p">,</span> <span class="s2">&quot;Drude1D&quot;</span><span class="p">,</span> <span class="s2">&quot;Plummer1D&quot;</span><span class="p">,</span> <span class="s2">&quot;NFW&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="BlackBody"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.BlackBody.html#astropy.modeling.physical_models.BlackBody">[docs]</a><span class="k">class</span> <span class="nc">BlackBody</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Blackbody model using the Planck function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    temperature : `~astropy.units.Quantity` [&#39;temperature&#39;]</span>
<span class="sd">        Blackbody temperature.</span>

<span class="sd">    scale : float or `~astropy.units.Quantity` [&#39;dimensionless&#39;]</span>
<span class="sd">        Scale factor.  If dimensionless, input units will assumed</span>
<span class="sd">        to be in Hz and output units in (erg / (cm ** 2 * s * Hz * sr).</span>
<span class="sd">        If not dimensionless, must be equivalent to either</span>
<span class="sd">        (erg / (cm ** 2 * s * Hz * sr) or erg / (cm ** 2 * s * AA * sr),</span>
<span class="sd">        in which case the result will be returned in the requested units and</span>
<span class="sd">        the scale will be stripped of units (with the float value applied).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Model formula:</span>

<span class="sd">        .. math:: B_{\\nu}(T) = A \\frac{2 h \\nu^{3} / c^{2}}{exp(h \\nu / k T) - 1}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from astropy.modeling import models</span>
<span class="sd">    &gt;&gt;&gt; from astropy import units as u</span>
<span class="sd">    &gt;&gt;&gt; bb = models.BlackBody(temperature=5000*u.K)</span>
<span class="sd">    &gt;&gt;&gt; bb(6000 * u.AA)  # doctest: +FLOAT_CMP</span>
<span class="sd">    &lt;Quantity 1.53254685e-05 erg / (cm2 Hz s sr)&gt;</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        import numpy as np</span>
<span class="sd">        import matplotlib.pyplot as plt</span>

<span class="sd">        from astropy.modeling.models import BlackBody</span>
<span class="sd">        from astropy import units as u</span>
<span class="sd">        from astropy.visualization import quantity_support</span>

<span class="sd">        bb = BlackBody(temperature=5778*u.K)</span>
<span class="sd">        wav = np.arange(1000, 110000) * u.AA</span>
<span class="sd">        flux = bb(wav)</span>

<span class="sd">        with quantity_support():</span>
<span class="sd">            plt.figure()</span>
<span class="sd">            plt.semilogx(wav, flux)</span>
<span class="sd">            plt.axvline(bb.nu_max.to(u.AA, equivalencies=u.spectral()).value, ls=&#39;--&#39;)</span>
<span class="sd">            plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We parametrize this model with a temperature and a scale.</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Blackbody temperature&quot;</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Scale factor&quot;</span><span class="p">)</span>

    <span class="c1"># We allow values without units to be passed when evaluating the model, and</span>
    <span class="c1"># in this case the input x values are assumed to be frequencies in Hz or wavelengths</span>
    <span class="c1"># in AA (depending on the choice of output units controlled by units on scale</span>
    <span class="c1"># and stored in self._output_units during init).</span>
    <span class="n">_input_units_allow_dimensionless</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># We enable the spectral equivalency by default for the spectral axis</span>
    <span class="n">input_units_equivalencies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()}</span>

    <span class="c1"># Store the native units returned by B_nu equation</span>
    <span class="n">_native_units</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="p">)</span>

    <span class="c1"># Store the base native output units.  If scale is not dimensionless, it</span>
    <span class="c1"># must be equivalent to one of these.  If equivalent to SLAM, then</span>
    <span class="c1"># input_units will expect AA for &#39;x&#39;, otherwise Hz.</span>
    <span class="n">_native_output_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SNU&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="p">),</span>
                            <span class="s1">&#39;SLAM&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="p">)}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Support scale with non-dimensionless unit by stripping the unit and</span>
        <span class="c1"># storing as self._output_units.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">scale</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">):</span>
            <span class="n">output_units</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">output_units</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_native_units</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral_density</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;scale units not dimensionless or in &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;surface brightness: </span><span class="si">{</span><span class="n">output_units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_units</span> <span class="o">=</span> <span class="n">output_units</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_native_units</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="BlackBody.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.BlackBody.html#astropy.modeling.physical_models.BlackBody.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float, `~numpy.ndarray`, or `~astropy.units.Quantity` [&#39;frequency&#39;]</span>
<span class="sd">            Frequency at which to compute the blackbody. If no units are given,</span>
<span class="sd">            this defaults to Hz (or AA if `scale` was initialized with units</span>
<span class="sd">            equivalent to erg / (cm ** 2 * s * AA * sr)).</span>

<span class="sd">        temperature : float, `~numpy.ndarray`, or `~astropy.units.Quantity`</span>
<span class="sd">            Temperature of the blackbody. If no units are given, this defaults</span>
<span class="sd">            to Kelvin.</span>

<span class="sd">        scale : float, `~numpy.ndarray`, or `~astropy.units.Quantity` [&#39;dimensionless&#39;]</span>
<span class="sd">            Desired scale for the blackbody.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        y : number or ndarray</span>
<span class="sd">            Blackbody spectrum. The units are determined from the units of</span>
<span class="sd">            ``scale``.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Use `numpy.errstate` to suppress Numpy warnings, if desired.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Output values might contain ``nan`` and ``inf``.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Invalid temperature.</span>

<span class="sd">        ZeroDivisionError</span>
<span class="sd">            Wavelength is zero (when converting to frequency).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">in_temp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_temp</span> <span class="o">=</span> <span class="n">temperature</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="c1"># then we assume it has input_units which depends on the</span>
            <span class="c1"># requested output units (either Hz or AA)</span>
            <span class="n">in_x</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_units</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_x</span> <span class="o">=</span> <span class="n">x</span>

        <span class="c1"># Convert to units for calculations, also force double precision</span>
        <span class="k">with</span> <span class="n">u</span><span class="o">.</span><span class="n">add_enabled_equivalencies</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">temperature</span><span class="p">()):</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">in_x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">in_temp</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>

        <span class="c1"># Check if input values are physically possible</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temperature should be positive: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">freq</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Input contains invalid wavelength/frequency value(s)&quot;</span><span class="p">,</span>
                <span class="n">AstropyUserWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">log_boltz</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">/</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">k_B</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span>
        <span class="n">boltzm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">log_boltz</span><span class="p">)</span>

        <span class="c1"># Calculate blackbody flux</span>
        <span class="n">bb_nu</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">boltzm1</span><span class="p">)</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Will be dimensionless at this point, but may not be dimensionless_unscaled</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">):</span>
                <span class="c1"># during fitting, scale will be passed without units</span>
                <span class="c1"># but we still need to convert from the input dimensionless</span>
                <span class="c1"># to dimensionless unscaled</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># NOTE: scale is already stripped of any input units</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">bb_nu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_units</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral_density</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>

        <span class="c1"># If the temperature parameter has no unit, we should return a unitless</span>
        <span class="c1"># value. This occurs for instance during fitting, since we drop the</span>
        <span class="c1"># units temporarily.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">return</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The input units are those of the &#39;x&#39; value, which will depend on the</span>
        <span class="c1"># units compatible with the expected output units.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_units</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_native_output_units</span><span class="p">[</span><span class="s1">&#39;SNU&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># only other option is equivalent with SLAM</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bolometric_flux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bolometric flux.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Will be dimensionless at this point, but may not be dimensionless_unscaled</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># bolometric flux in the native units of the planck function</span>
        <span class="n">native_bolflux</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">scale</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">sigma_sb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="p">)</span>
        <span class="c1"># return in more &quot;astro&quot; units</span>
        <span class="k">return</span> <span class="n">native_bolflux</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lambda_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Peak wavelength when the curve is expressed as power density.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">const</span><span class="o">.</span><span class="n">b_wien</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nu_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Peak frequency when the curve is expressed as power density.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">2.8214391</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">k_B</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">h</span></div>


<div class="viewcode-block" id="Drude1D"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.Drude1D.html#astropy.modeling.physical_models.Drude1D">[docs]</a><span class="k">class</span> <span class="nc">Drude1D</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drude model based one the behavior of electons in materials (esp. metals).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    amplitude : float</span>
<span class="sd">        Peak value</span>
<span class="sd">    x_0 : float</span>
<span class="sd">        Position of the peak</span>
<span class="sd">    fwhm : float</span>
<span class="sd">        Full width at half maximum</span>

<span class="sd">    Model formula:</span>

<span class="sd">        .. math:: f(x) = A \\frac{(fwhm/x_0)^2}{((x/x_0 - x_0/x)^2 + (fwhm/x_0)^2}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        import numpy as np</span>
<span class="sd">        import matplotlib.pyplot as plt</span>

<span class="sd">        from astropy.modeling.models import Drude1D</span>

<span class="sd">        fig, ax = plt.subplots()</span>

<span class="sd">        # generate the curves and plot them</span>
<span class="sd">        x = np.arange(7.5 , 12.5 , 0.1)</span>

<span class="sd">        dmodel = Drude1D(amplitude=1.0, fwhm=1.0, x_0=10.0)</span>
<span class="sd">        ax.plot(x, dmodel(x))</span>

<span class="sd">        ax.set_xlabel(&#39;x&#39;)</span>
<span class="sd">        ax.set_ylabel(&#39;F(x)&#39;)</span>

<span class="sd">        plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Peak Value&quot;</span><span class="p">)</span>
    <span class="n">x_0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Position of the peak&quot;</span><span class="p">)</span>
    <span class="n">fwhm</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Full width at half maximum&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Drude1D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.Drude1D.html#astropy.modeling.physical_models.Drude1D.evaluate">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One dimensional Drude model function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">amplitude</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">fwhm</span> <span class="o">/</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">x_0</span> <span class="o">-</span> <span class="n">x_0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">fwhm</span> <span class="o">/</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Drude1D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.Drude1D.html#astropy.modeling.physical_models.Drude1D.fit_deriv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drude1D model function derivatives.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d_amplitude</span> <span class="o">=</span> <span class="p">(</span><span class="n">fwhm</span> <span class="o">/</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">x_0</span> <span class="o">-</span> <span class="n">x_0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">fwhm</span> <span class="o">/</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">d_x_0</span> <span class="o">=</span> <span class="p">(</span>
            <span class="o">-</span><span class="mi">2</span>
            <span class="o">*</span> <span class="n">amplitude</span>
            <span class="o">*</span> <span class="n">d_amplitude</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">x_0</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">d_amplitude</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">x_0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">fwhm</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">x_0</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">x_0</span> <span class="o">-</span> <span class="n">x_0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>
                    <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">x_0</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">d_fwhm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">d_amplitude</span> <span class="o">/</span> <span class="n">fwhm</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d_amplitude</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d_amplitude</span><span class="p">,</span> <span class="n">d_x_0</span><span class="p">,</span> <span class="n">d_fwhm</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_0</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_0</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;x_0&quot;</span><span class="p">:</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="s2">&quot;fwhm&quot;</span><span class="p">:</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="n">outputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">return_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>

    <span class="nd">@x_0</span><span class="o">.</span><span class="n">validator</span>
    <span class="k">def</span> <span class="nf">x_0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ensure `x_0` is not 0.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InputParameterError</span><span class="p">(</span><span class="s2">&quot;0 is not an allowed value for x_0&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tuple defining the default ``bounding_box`` limits,</span>
<span class="sd">        ``(x_low, x_high)``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factor : float</span>
<span class="sd">            The multiple of FWHM used to define the limits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_0</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">)</span></div>


<div class="viewcode-block" id="Plummer1D"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.Plummer1D.html#astropy.modeling.physical_models.Plummer1D">[docs]</a><span class="k">class</span> <span class="nc">Plummer1D</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;One dimensional Plummer density profile model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mass : float</span>
<span class="sd">        Total mass of cluster.</span>
<span class="sd">    r_plum : float</span>
<span class="sd">        Scale parameter which sets the size of the cluster core.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Model formula:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \rho(r)=\frac{3M}{4\pi a^3}(1+\frac{r^2}{a^2})^{-5/2}</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://ui.adsabs.harvard.edu/abs/1911MNRAS..71..460P</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mass</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                     <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Total mass of cluster&quot;</span><span class="p">)</span>
    <span class="n">r_plum</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                       <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Scale parameter which sets the size of the cluster core&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Plummer1D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.Plummer1D.html#astropy.modeling.physical_models.Plummer1D.evaluate">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">r_plum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate plummer density profile model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">mass</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r_plum</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">r_plum</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plummer1D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.Plummer1D.html#astropy.modeling.physical_models.Plummer1D.fit_deriv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">r_plum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plummer1D model derivatives.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d_mass</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r_plum</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x</span><span class="o">/</span><span class="n">r_plum</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">d_r_plum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">mass</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="n">mass</span><span class="o">*</span><span class="n">r_plum</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r_plum</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">r_plum</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d_mass</span><span class="p">,</span> <span class="n">d_r_plum</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_plum</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_plum</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="n">outputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;r_plum&#39;</span><span class="p">:</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span></div>


<div class="viewcode-block" id="NFW"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.NFW.html#astropy.modeling.physical_models.NFW">[docs]</a><span class="k">class</span> <span class="nc">NFW</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NavarroFrenkWhite (NFW) profile - model for radial distribution of dark matter.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mass : float or `~astropy.units.Quantity` [&#39;mass&#39;]</span>
<span class="sd">        Mass of NFW peak within specified overdensity radius.</span>
<span class="sd">    concentration : float</span>
<span class="sd">        Concentration of the NFW profile.</span>
<span class="sd">    redshift : float</span>
<span class="sd">        Redshift of the NFW profile.</span>
<span class="sd">    massfactor : tuple or str</span>
<span class="sd">        Mass overdensity factor and type for provided profiles:</span>
<span class="sd">            Tuple version:</span>
<span class="sd">                (&quot;virial&quot;,) : virial radius</span>

<span class="sd">                (&quot;critical&quot;, N)  : radius where density is N times that of the critical density</span>

<span class="sd">                (&quot;mean&quot;, N)  : radius where density is N times that of the mean density</span>

<span class="sd">            String version:</span>
<span class="sd">                &quot;virial&quot; : virial radius</span>

<span class="sd">                &quot;Nc&quot;  : radius where density is N times that of the critical density (e.g. &quot;200c&quot;)</span>

<span class="sd">                &quot;Nm&quot;  : radius where density is N times that of the mean density (e.g. &quot;500m&quot;)</span>
<span class="sd">    cosmo : :class:`~astropy.cosmology.Cosmology`</span>
<span class="sd">        Background cosmology for density calculation. If None, the default cosmology will be used.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Model formula:</span>

<span class="sd">    .. math:: \rho(r)=\frac{\delta_c\rho_{c}}{r/r_s(1+r/r_s)^2}</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://arxiv.org/pdf/astro-ph/9508025</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/Navarro%E2%80%93Frenk%E2%80%93White_profile</span>
<span class="sd">    .. [3] https://en.wikipedia.org/wiki/Virial_mass</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Model Parameters</span>

    <span class="c1"># NFW Profile mass</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">M_sun</span><span class="p">,</span>
                     <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Peak mass within specified overdensity radius&quot;</span><span class="p">)</span>

    <span class="c1"># NFW profile concentration</span>
    <span class="n">concentration</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Concentration&quot;</span><span class="p">)</span>

    <span class="c1"># NFW Profile redshift</span>
    <span class="n">redshift</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Redshift&quot;</span><span class="p">)</span>

    <span class="c1"># We allow values without units to be passed when evaluating the model, and</span>
    <span class="c1"># in this case the input r values are assumed to be lengths / positions in kpc.</span>
    <span class="n">_input_units_allow_dimensionless</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mass</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">mass</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
                 <span class="n">concentration</span><span class="o">=</span><span class="n">concentration</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="n">redshift</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                 <span class="n">massfactor</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">cosmo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Set default cosmology</span>
        <span class="k">if</span> <span class="n">cosmo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># LOCAL</span>
            <span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">default_cosmology</span>

            <span class="n">cosmo</span> <span class="o">=</span> <span class="n">default_cosmology</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c1"># Set mass overdensity type and factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_density_delta</span><span class="p">(</span><span class="n">massfactor</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">redshift</span><span class="p">)</span>

        <span class="c1"># Establish mass units for density calculation (default solar masses)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">in_mass</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_mass</span> <span class="o">=</span> <span class="n">mass</span>

        <span class="c1"># Obtain scale radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius_s</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">)</span>

        <span class="c1"># Obtain scale density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_density_s</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="n">in_mass</span><span class="p">,</span> <span class="n">concentration</span><span class="o">=</span><span class="n">concentration</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="NFW.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.NFW.html#astropy.modeling.physical_models.NFW.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">redshift</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One dimensional NFW profile function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : float or `~astropy.units.Quantity` [&#39;length&#39;]</span>
<span class="sd">            Radial position of density to be calculated for the NFW profile.</span>
<span class="sd">        mass : float or `~astropy.units.Quantity` [&#39;mass&#39;]</span>
<span class="sd">            Mass of NFW peak within specified overdensity radius.</span>
<span class="sd">        concentration : float</span>
<span class="sd">            Concentration of the NFW profile.</span>
<span class="sd">        redshift : float</span>
<span class="sd">            Redshift of the NFW profile.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density : float or `~astropy.units.Quantity` [&#39;density&#39;]</span>
<span class="sd">            NFW profile mass density at location ``r``. The density units are:</span>
<span class="sd">            [``mass`` / ``r`` ^3]</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. warning::</span>

<span class="sd">            Output values might contain ``nan`` and ``inf``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create radial version of input with dimension</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">):</span>
            <span class="n">in_r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_r</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>

        <span class="c1"># Define reduced radius (r / r_{\\rm s})</span>
        <span class="c1">#   also update scale radius</span>
        <span class="n">radius_reduced</span> <span class="o">=</span> <span class="n">in_r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius_s</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">in_r</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

        <span class="c1"># Density distribution</span>
        <span class="c1"># \rho (r)=\frac{\rho_0}{\frac{r}{R_s}\left(1~+~\frac{r}{R_s}\right)^2}</span>
        <span class="c1">#   also update scale density</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density_s</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">radius_reduced</span> <span class="o">*</span>
                                                          <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">radius_reduced</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">density</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">density</span><span class="o">.</span><span class="n">value</span></div>

    <span class="k">def</span> <span class="nf">_density_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">massfactor</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">redshift</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate density delta.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set mass overdensity type and factor</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">massfactor</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># Tuple options</span>
            <span class="c1">#   (&quot;virial&quot;)       : virial radius</span>
            <span class="c1">#   (&quot;critical&quot;, N)  : radius where density is N that of the critical density</span>
            <span class="c1">#   (&quot;mean&quot;, N)      : radius where density is N that of the mean density</span>
            <span class="k">if</span> <span class="n">massfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;virial&quot;</span><span class="p">:</span>
                <span class="c1"># Virial Mass</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">masstype</span> <span class="o">=</span> <span class="n">massfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">massfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span>
                <span class="c1"># Critical or Mean Overdensity Mass</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">massfactor</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">masstype</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
            <span class="k">elif</span> <span class="n">massfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
                <span class="c1"># Critical or Mean Overdensity Mass</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">massfactor</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">masstype</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Massfactor &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">massfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39; not one of &#39;critical&#39;, &quot;</span>
                                                                       <span class="s2">&quot;&#39;mean&#39;, or &#39;virial&#39;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># String options</span>
                <span class="c1">#   virial : virial radius</span>
                <span class="c1">#   Nc  : radius where density is N that of the critical density</span>
                <span class="c1">#   Nm  : radius where density is N that of the mean density</span>
                <span class="k">if</span> <span class="n">massfactor</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;virial&quot;</span><span class="p">:</span>
                    <span class="c1"># Virial Mass</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">masstype</span> <span class="o">=</span> <span class="n">massfactor</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">massfactor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span> <span class="ow">or</span> <span class="n">massfactor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
                    <span class="c1"># Critical or Mean Overdensity Mass</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">massfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">masstype</span> <span class="o">=</span> <span class="n">massfactor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Massfactor &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">massfactor</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; string not of the form &quot;</span>
                                                                       <span class="s2">&quot;&#39;#m&#39;, &#39;#c&#39;, or &#39;virial&#39;&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Massfactor &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">massfactor</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not a tuple or string&quot;</span><span class="p">)</span>

        <span class="c1"># Set density from masstype specification</span>
        <span class="k">if</span> <span class="n">masstype</span> <span class="o">==</span> <span class="s2">&quot;virial&quot;</span><span class="p">:</span>
            <span class="n">Om_c</span> <span class="o">=</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">Om</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
            <span class="n">d_c</span> <span class="o">=</span> <span class="mf">18.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">82.0</span> <span class="o">*</span> <span class="n">Om_c</span> <span class="o">-</span> <span class="mf">39.0</span> <span class="o">*</span> <span class="n">Om_c</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">density_delta</span> <span class="o">=</span> <span class="n">d_c</span> <span class="o">*</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">masstype</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">density_delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">masstype</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">density_delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span> <span class="o">*</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">Om</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_delta</span>

<div class="viewcode-block" id="NFW.A_NFW"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.NFW.html#astropy.modeling.physical_models.NFW.A_NFW">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">A_NFW</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dimensionless volume integral of the NFW profile, used as an intermediate step in some</span>
<span class="sd">        calculations for this model.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Model formula:</span>

<span class="sd">        .. math:: A_{NFW} = [\ln(1+y) - \frac{y}{1+y}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_density_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate scale density of the NFW profile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Enforce default units</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">in_mass</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_mass</span> <span class="o">=</span> <span class="n">mass</span>

        <span class="c1"># Calculate scale density</span>
        <span class="c1"># M_{200} = 4\pi \rho_{s} R_{s}^3 \left[\ln(1+c) - \frac{c}{1+c}\right].</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_s</span> <span class="o">=</span> <span class="n">in_mass</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius_s</span><span class="p">(</span><span class="n">in_mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">A_NFW</span><span class="p">(</span><span class="n">concentration</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_s</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rho_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale density of the NFW profile. Often written in the literature as :math:`\rho_s`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_s</span>

    <span class="k">def</span> <span class="nf">_radius_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">concentration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate scale radius of the NFW profile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Enforce default units</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">in_mass</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_mass</span> <span class="o">=</span> <span class="n">mass</span>

        <span class="c1"># Delta Mass is related to delta radius by</span>
        <span class="c1"># M_{200}=\frac{4}{3}\pi r_{200}^3 200 \rho_{c}</span>
        <span class="c1"># And delta radius is related to the NFW scale radius by</span>
        <span class="c1"># c = R / r_{\\rm s}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_s</span> <span class="o">=</span> <span class="p">(((</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">in_mass</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_delta</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span>
                          <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">/</span> <span class="n">concentration</span>

        <span class="c1"># Set radial units to kiloparsec by default (unit will be rescaled by units of radius</span>
        <span class="c1"># in evaluate)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_s</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">r_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale radius of the NFW profile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius_s</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">r_virial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mass factor defined virial radius of the NFW profile (R200c for M200c, Rvir for Mvir, etc.).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">concentration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">r_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Radius of maximum circular velocity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_s</span> <span class="o">*</span> <span class="mf">2.16258</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">v_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum circular velocity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular_velocity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_max</span><span class="p">)</span>

<div class="viewcode-block" id="NFW.circular_velocity"><a class="viewcode-back" href="../../../api/astropy.modeling.physical_models.NFW.html#astropy.modeling.physical_models.NFW.circular_velocity">[docs]</a>    <span class="k">def</span> <span class="nf">circular_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular velocities of the NFW profile.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : float or `~astropy.units.Quantity` [&#39;length&#39;]</span>
<span class="sd">            Radial position of velocity to be calculated for the NFW profile.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        velocity : float or `~astropy.units.Quantity` [&#39;speed&#39;]</span>
<span class="sd">            NFW profile circular velocity at location ``r``. The velocity units are:</span>
<span class="sd">            [km / s]</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Model formula:</span>

<span class="sd">        .. math:: v_{circ}(r)^2 = \frac{1}{x}\frac{\ln(1+cx)-(cx)/(1+cx)}{\ln(1+c)-c/(1+c)}</span>

<span class="sd">        .. math:: x = r/r_s</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Output values might contain ``nan`` and ``inf``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Enforce default units (if parameters are without units)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">):</span>
            <span class="n">in_r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_r</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>

        <span class="c1"># Mass factor defined velocity (i.e. V200c for M200c, Rvir for Mvir)</span>
        <span class="n">v_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">in_r</span><span class="o">.</span><span class="n">unit</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">unit</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">r_virial</span><span class="p">)</span>

        <span class="c1"># Define reduced radius (r / r_{\\rm s})</span>
        <span class="n">reduced_radius</span> <span class="o">=</span> <span class="n">in_r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_virial</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">in_r</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

        <span class="c1"># Circular velocity given by:</span>
        <span class="c1"># v^2=\frac{1}{x}\frac{\ln(1+cx)-(cx)/(1+cx)}{\ln(1+c)-c/(1+c)}</span>
        <span class="c1"># where x=r/r_{200}</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">v_profile</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_NFW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">concentration</span> <span class="o">*</span> <span class="n">reduced_radius</span><span class="p">))</span> <span class="o">/</span>
                           <span class="p">(</span><span class="n">reduced_radius</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_NFW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">concentration</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">velocity</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The units for the &#39;r&#39; variable should be a length (default kpc)</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">return_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The units for the &#39;density&#39; variable should be a matter density (default M_sun / kpc^3)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">unit</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span><span class="p">,</span>
                <span class="s2">&quot;concentration&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;redshift&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 20112022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>