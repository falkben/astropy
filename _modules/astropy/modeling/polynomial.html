


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>astropy.modeling.polynomial &#8212; Astropy v5.2.dev104+gcdd6a1f81.d20220509</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">Astropy v5.2.dev104+gcdd6a1f81.d20220509</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astropy.modeling.polynomial</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains models representing polynomials and polynomial series.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=invalid-name</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy.utils</span> <span class="kn">import</span> <span class="n">check_broadcast</span><span class="p">,</span> <span class="n">indent</span>

<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">FittableModel</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">.functional_models</span> <span class="kn">import</span> <span class="n">Shift</span>
<span class="kn">from</span> <span class="nn">.parameters</span> <span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_validate_domain_window</span><span class="p">,</span> <span class="n">comb</span><span class="p">,</span> <span class="n">poly_map_domain</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Chebyshev1D&#39;</span><span class="p">,</span> <span class="s1">&#39;Chebyshev2D&#39;</span><span class="p">,</span> <span class="s1">&#39;Hermite1D&#39;</span><span class="p">,</span> <span class="s1">&#39;Hermite2D&#39;</span><span class="p">,</span>
    <span class="s1">&#39;InverseSIP&#39;</span><span class="p">,</span> <span class="s1">&#39;Legendre1D&#39;</span><span class="p">,</span> <span class="s1">&#39;Legendre2D&#39;</span><span class="p">,</span> <span class="s1">&#39;Polynomial1D&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Polynomial2D&#39;</span><span class="p">,</span> <span class="s1">&#39;SIP&#39;</span><span class="p">,</span> <span class="s1">&#39;OrthoPolynomialBase&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PolynomialModel&#39;</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">PolynomialBase</span><span class="p">(</span><span class="n">FittableModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all polynomial-like models with an arbitrary number of</span>
<span class="sd">    parameters in the form of coefficients.</span>

<span class="sd">    In this case Parameter instances are returned through the class&#39;s</span>
<span class="sd">    ``__getattr__`` rather than through class descriptors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Default _param_names list; this will be filled in by the implementation&#39;s</span>
    <span class="c1"># __init__</span>
    <span class="n">_param_names</span> <span class="o">=</span> <span class="p">()</span>

    <span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">col_fit_deriv</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Coefficient names generated based on the model&#39;s polynomial degree</span>
<span class="sd">        and number of dimensions.</span>

<span class="sd">        Subclasses should implement this to return parameter names in the</span>
<span class="sd">        desired format.</span>

<span class="sd">        On most `Model` classes this is a class attribute, but for polynomial</span>
<span class="sd">        models it is an instance attribute since each polynomial model instance</span>
<span class="sd">        can have different parameters depending on the degree of the polynomial</span>
<span class="sd">        and the number of dimensions, for example.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span>


<div class="viewcode-block" id="PolynomialModel"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.PolynomialModel.html#astropy.modeling.polynomial.PolynomialModel">[docs]</a><span class="k">class</span> <span class="nc">PolynomialModel</span><span class="p">(</span><span class="n">PolynomialBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for polynomial models.</span>

<span class="sd">    Its main purpose is to determine how many coefficients are needed</span>
<span class="sd">    based on the polynomial order and dimension and to provide their</span>
<span class="sd">    default values, names and ordering.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_degree</span> <span class="o">=</span> <span class="n">degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_coeff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_coeff_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_models</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_set_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">model_set_axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">minshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">model_set_axis</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_models</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minshape</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">minshape</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">degree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Degree of polynomial.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degree</span>

<div class="viewcode-block" id="PolynomialModel.get_num_coeff"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.PolynomialModel.html#astropy.modeling.polynomial.PolynomialModel.get_num_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of coefficients in one parameter set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Degree of polynomial must be positive or null&quot;</span><span class="p">)</span>
        <span class="c1"># deg+1 is used to account for the difference between iraf using</span>
        <span class="c1"># degree and numpy using exact degree</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nmixed</span> <span class="o">=</span> <span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nmixed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">numc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">*</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">nmixed</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">numc</span></div>

    <span class="k">def</span> <span class="nf">_invlex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lencoeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lencoeff</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lencoeff</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">:</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_generate_coeff_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndim</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">names</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_PolyDomainWindow1D</span><span class="p">(</span><span class="n">PolynomialModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class sets ``domain`` and ``window`` of 1D polynomials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_domain_window</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_window</span>

    <span class="nd">@window</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span>

    <span class="nd">@domain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_default_domain_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets the ``domain`` and ``window`` attributes on 1D subclasses.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                       <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                                       <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span> <span class="ow">or</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_repr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">],</span>
                                 <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">},</span>
                                 <span class="n">defaults</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span>
                                 <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_str</span><span class="p">([(</span><span class="s1">&#39;Degree&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;Domain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;Window&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">)</span>


<div class="viewcode-block" id="OrthoPolynomialBase"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.OrthoPolynomialBase.html#astropy.modeling.polynomial.OrthoPolynomialBase">[docs]</a><span class="k">class</span> <span class="nc">OrthoPolynomialBase</span><span class="p">(</span><span class="n">PolynomialBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a base class for the 2D Chebyshev and Legendre models.</span>

<span class="sd">    The polynomials implemented here require a maximum degree in x and y.</span>

<span class="sd">    For explanation of ``x_domain``, ``y_domain``, ```x_window`` and ```y_window``</span>
<span class="sd">    see :ref:`Notes regarding usage of domain and window &lt;astropy:domain-window-note&gt;`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x_degree : int</span>
<span class="sd">        degree in x</span>
<span class="sd">    y_degree : int</span>
<span class="sd">        degree in y</span>
<span class="sd">    x_domain : tuple or None, optional</span>
<span class="sd">        domain of the x independent variable</span>
<span class="sd">    x_window : tuple or None, optional</span>
<span class="sd">        range of the x independent variable</span>
<span class="sd">    y_domain : tuple or None, optional</span>
<span class="sd">        domain of the y independent variable</span>
<span class="sd">    y_window : tuple or None, optional</span>
<span class="sd">        range of the y independent variable</span>
<span class="sd">    **params : dict</span>
<span class="sd">        {keyword: value} pairs, representing {parameter_name: value}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">y_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">=</span> <span class="n">x_degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">=</span> <span class="n">y_degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_coeff</span><span class="p">()</span>
        <span class="c1"># Set the ``x/y_domain`` and ``x/y_wndow`` attributes in subclasses.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x_window&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;y_window&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;x_domain&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;y_domain&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span> <span class="o">=</span> <span class="n">x_window</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;x_window&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span> <span class="o">=</span> <span class="n">y_window</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;y_window&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span> <span class="o">=</span> <span class="n">x_domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span> <span class="o">=</span> <span class="n">y_domain</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_coeff_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">n_models</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_set_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">model_set_axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">minshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">model_set_axis</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_models</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minshape</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">minshape</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_domain</span>

    <span class="nd">@x_domain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_domain</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_domain</span>

    <span class="nd">@y_domain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_domain</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_window</span>

    <span class="nd">@x_window</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_window</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_window</span>

    <span class="nd">@y_window</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_window</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_repr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span><span class="p">],</span>
                                 <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x_domain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span><span class="p">,</span>
                                         <span class="s1">&#39;y_domain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span><span class="p">,</span>
                                         <span class="s1">&#39;x_window&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span><span class="p">,</span>
                                         <span class="s1">&#39;y_window&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span><span class="p">},</span>
                                 <span class="n">defaults</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_str</span><span class="p">(</span>
            <span class="p">[(</span><span class="s1">&#39;X_Degree&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Y_Degree&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;X_Domain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Y_Domain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;X_Window&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Y_Window&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span><span class="p">)],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">)</span>

<div class="viewcode-block" id="OrthoPolynomialBase.get_num_coeff"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.OrthoPolynomialBase.html#astropy.modeling.polynomial.OrthoPolynomialBase.get_num_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine how many coefficients are needed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numc : int</span>
<span class="sd">            number of coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Degree of polynomial must be positive or null&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_invlex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO: This is a very slow way to do this; fix it and related methods</span>
        <span class="c1"># like _alpha</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">yvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">yvar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xvar</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<div class="viewcode-block" id="OrthoPolynomialBase.invlex_coeff"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.OrthoPolynomialBase.html#astropy.modeling.polynomial.OrthoPolynomialBase.invlex_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">invlex_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="n">invlex_coeffs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">yvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">yvar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xvar</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">coeff</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
                <span class="n">invlex_coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">invlex_coeffs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">invlexdeg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invlex</span><span class="p">()</span>
        <span class="n">invlexdeg</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">invlexdeg</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ny</span> <span class="o">+</span> <span class="n">nx</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invlexdeg</span><span class="p">)):</span>
            <span class="n">alpha</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">invlexdeg</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">alpha</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">alpha</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">nx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">alpha</span>

<div class="viewcode-block" id="OrthoPolynomialBase.imhorner"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.OrthoPolynomialBase.html#astropy.modeling.polynomial.OrthoPolynomialBase.imhorner">[docs]</a>    <span class="k">def</span> <span class="nf">imhorner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
        <span class="n">_coeff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
        <span class="n">_coeff</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">()</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nalpha</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

        <span class="n">karr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">kfunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fcache</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">x_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">y_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nterms</span> <span class="o">=</span> <span class="n">x_terms</span> <span class="o">+</span> <span class="n">y_terms</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nterms</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nalpha</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">karr</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">rsum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">rsum</span> <span class="o">=</span> <span class="n">rsum</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r0</span> <span class="o">+</span> <span class="n">rsum</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="n">_coeff</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">r0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nterms</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="nf">_generate_coeff_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fcache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computation and store the individual functions.</span>

<span class="sd">        To be implemented by subclasses&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Subclasses should implement this&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="OrthoPolynomialBase.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.OrthoPolynomialBase.html#astropy.modeling.polynomial.OrthoPolynomialBase.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span><span class="p">)</span>
        <span class="n">invcoeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invlex_coeff</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imhorner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">invcoeff</span><span class="p">)</span></div>

<div class="viewcode-block" id="OrthoPolynomialBase.prepare_inputs"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.OrthoPolynomialBase.html#astropy.modeling.polynomial.OrthoPolynomialBase.prepare_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">broadcasted_shapes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">inputs</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected input arrays to have the same shape&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">broadcasted_shapes</span></div></div>


<div class="viewcode-block" id="Chebyshev1D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev1D.html#astropy.modeling.polynomial.Chebyshev1D">[docs]</a><span class="k">class</span> <span class="nc">Chebyshev1D</span><span class="p">(</span><span class="n">_PolyDomainWindow1D</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate Chebyshev series.</span>

<span class="sd">    It is defined as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        P(x) = \sum_{i=0}^{i=n}C_{i} * T_{i}(x)</span>

<span class="sd">    where ``T_i(x)`` is the corresponding Chebyshev polynomial of the 1st kind.</span>

<span class="sd">    For explanation of ```domain``, and ``window`` see</span>
<span class="sd">    :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    degree : int</span>
<span class="sd">        degree of the series</span>
<span class="sd">    domain : tuple or None, optional</span>
<span class="sd">    window : tuple or None, optional</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window.</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword : value pairs, representing parameter_name: value</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This model does not support the use of units/quantities, because each term</span>
<span class="sd">    in the sum of Chebyshev polynomials is a polynomial in x - since the</span>
<span class="sd">    coefficients within each Chebyshev polynomial are fixed, we can&#39;t use</span>
<span class="sd">    quantities for x since the units would not be compatible. For example, the</span>
<span class="sd">    third Chebyshev polynomial (T2) is 2x^2-1, but if x was specified with</span>
<span class="sd">    units, 2x^2 and -1 would have incompatible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
                         <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="Chebyshev1D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev1D.html#astropy.modeling.polynomial.Chebyshev1D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Vandermonde matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>

<div class="viewcode-block" id="Chebyshev1D.prepare_inputs"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev1D.html#astropy.modeling.polynomial.Chebyshev1D.prepare_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">broadcasted_shapes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">broadcasted_shapes</span></div>

<div class="viewcode-block" id="Chebyshev1D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev1D.html#astropy.modeling.polynomial.Chebyshev1D.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clenshaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Chebyshev1D.clenshaw"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev1D.html#astropy.modeling.polynomial.Chebyshev1D.clenshaw">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clenshaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the polynomial using Clenshaw&#39;s algorithm.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">c0</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x2</span>
        <span class="k">return</span> <span class="n">c0</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x</span></div></div>


<div class="viewcode-block" id="Hermite1D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite1D.html#astropy.modeling.polynomial.Hermite1D">[docs]</a><span class="k">class</span> <span class="nc">Hermite1D</span><span class="p">(</span><span class="n">_PolyDomainWindow1D</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate Hermite series.</span>

<span class="sd">    It is defined as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        P(x) = \sum_{i=0}^{i=n}C_{i} * H_{i}(x)</span>

<span class="sd">    where ``H_i(x)`` is the corresponding Hermite polynomial (&quot;Physicist&#39;s kind&quot;).</span>

<span class="sd">    For explanation of ``domain``, and ``window`` see</span>
<span class="sd">    :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    degree : int</span>
<span class="sd">        degree of the series</span>
<span class="sd">    domain : tuple or None, optional</span>
<span class="sd">    window : tuple or None, optional</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword : value pairs, representing parameter_name: value</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This model does not support the use of units/quantities, because each term</span>
<span class="sd">    in the sum of Hermite polynomials is a polynomial in x - since the</span>
<span class="sd">    coefficients within each Hermite polynomial are fixed, we can&#39;t use</span>
<span class="sd">    quantities for x since the units would not be compatible. For example, the</span>
<span class="sd">    third Hermite polynomial (H2) is 4x^2-2, but if x was specified with units,</span>
<span class="sd">    4x^2 and -2 would have incompatible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
            <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="Hermite1D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite1D.html#astropy.modeling.polynomial.Hermite1D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Vandermonde matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hermite1D.prepare_inputs"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite1D.html#astropy.modeling.polynomial.Hermite1D.prepare_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">broadcasted_shapes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">broadcasted_shapes</span></div>

<div class="viewcode-block" id="Hermite1D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite1D.html#astropy.modeling.polynomial.Hermite1D.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clenshaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hermite1D.clenshaw"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite1D.html#astropy.modeling.polynomial.Hermite1D.clenshaw">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clenshaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">c0</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">nd</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">nd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x2</span>
        <span class="k">return</span> <span class="n">c0</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x2</span></div></div>


<div class="viewcode-block" id="Hermite2D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite2D.html#astropy.modeling.polynomial.Hermite2D">[docs]</a><span class="k">class</span> <span class="nc">Hermite2D</span><span class="p">(</span><span class="n">OrthoPolynomialBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bivariate Hermite series.</span>

<span class="sd">    It is defined as</span>

<span class="sd">    .. math:: P_{nm}(x,y) = \sum_{n,m=0}^{n=d,m=d}C_{nm} H_n(x) H_m(y)</span>

<span class="sd">    where ``H_n(x)`` and ``H_m(y)`` are Hermite polynomials.</span>

<span class="sd">    For explanation of ``x_domain``, ``y_domain``, ``x_window`` and ``y_window``</span>
<span class="sd">    see :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x_degree : int</span>
<span class="sd">        degree in x</span>
<span class="sd">    y_degree : int</span>
<span class="sd">        degree in y</span>
<span class="sd">    x_domain : tuple or None, optional</span>
<span class="sd">        domain of the x independent variable</span>
<span class="sd">    y_domain : tuple or None, optional</span>
<span class="sd">        domain of the y independent variable</span>
<span class="sd">    x_window : tuple or None, optional</span>
<span class="sd">        range of the x independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    y_window : tuple or None, optional</span>
<span class="sd">        range of the y independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword: value pairs, representing parameter_name: value</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This model does not support the use of units/quantities, because each term</span>
<span class="sd">    in the sum of Hermite polynomials is a polynomial in x and/or y - since the</span>
<span class="sd">    coefficients within each Hermite polynomial are fixed, we can&#39;t use</span>
<span class="sd">    quantities for x and/or y since the units would not be compatible. For</span>
<span class="sd">    example, the third Hermite polynomial (H2) is 4x^2-2, but if x was</span>
<span class="sd">    specified with units, 4x^2 and -2 would have incompatible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">y_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="o">=</span><span class="n">y_domain</span><span class="p">,</span>
            <span class="n">x_window</span><span class="o">=</span><span class="n">x_window</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="n">y_window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
            <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fcache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the individual Hermite functions once and store them in a</span>
<span class="sd">        dictionary to be reused.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">y_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">kfunc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="n">x_terms</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="n">x_terms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_terms</span><span class="p">):</span>
            <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_terms</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x_terms</span> <span class="o">+</span> <span class="n">y_terms</span><span class="p">):</span>
            <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">kfunc</span>

<div class="viewcode-block" id="Hermite2D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Hermite2D.html#astropy.modeling.polynomial.Hermite2D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivatives with respect to the coefficients.</span>

<span class="sd">        This is an array with Hermite polynomials:</span>

<span class="sd">        .. math::</span>

<span class="sd">            H_{x_0}H_{y_0}, H_{x_1}H_{y_0}...H_{x_n}H_{y_0}...H_{x_n}H_{y_m}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x and y must have the same shape&quot;</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">x_deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hermderiv1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y_deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hermderiv1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ij</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ij</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_deriv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_deriv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ij</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span></div>

    <span class="k">def</span> <span class="nf">_hermderiv1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">deg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivative of 1D Hermite series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>


<div class="viewcode-block" id="Legendre1D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre1D.html#astropy.modeling.polynomial.Legendre1D">[docs]</a><span class="k">class</span> <span class="nc">Legendre1D</span><span class="p">(</span><span class="n">_PolyDomainWindow1D</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate Legendre series.</span>

<span class="sd">    It is defined as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        P(x) = \sum_{i=0}^{i=n}C_{i} * L_{i}(x)</span>

<span class="sd">    where ``L_i(x)`` is the corresponding Legendre polynomial.</span>

<span class="sd">    For explanation of ``domain``, and ``window`` see</span>
<span class="sd">    :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    degree : int</span>
<span class="sd">        degree of the series</span>
<span class="sd">    domain : tuple or None, optional</span>
<span class="sd">    window : tuple or None, optional</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword: value pairs, representing parameter_name: value</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This model does not support the use of units/quantities, because each term</span>
<span class="sd">    in the sum of Legendre polynomials is a polynomial in x - since the</span>
<span class="sd">    coefficients within each Legendre polynomial are fixed, we can&#39;t use</span>
<span class="sd">    quantities for x since the units would not be compatible. For example, the</span>
<span class="sd">    third Legendre polynomial (P2) is 1.5x^2-0.5, but if x was specified with</span>
<span class="sd">    units, 1.5x^2 and -0.5 would have incompatible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
            <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="Legendre1D.prepare_inputs"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre1D.html#astropy.modeling.polynomial.Legendre1D.prepare_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">broadcasted_shapes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">broadcasted_shapes</span></div>

<div class="viewcode-block" id="Legendre1D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre1D.html#astropy.modeling.polynomial.Legendre1D.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clenshaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Legendre1D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre1D.html#astropy.modeling.polynomial.Legendre1D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Vandermonde matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>

<div class="viewcode-block" id="Legendre1D.clenshaw"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre1D.html#astropy.modeling.polynomial.Legendre1D.clenshaw">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clenshaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">c0</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">nd</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="p">(</span><span class="n">nd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">nd</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">nd</span>
        <span class="k">return</span> <span class="n">c0</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">x</span></div></div>


<div class="viewcode-block" id="Polynomial1D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial1D.html#astropy.modeling.polynomial.Polynomial1D">[docs]</a><span class="k">class</span> <span class="nc">Polynomial1D</span><span class="p">(</span><span class="n">_PolyDomainWindow1D</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1D Polynomial model.</span>

<span class="sd">    It is defined as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        P = \sum_{i=0}^{i=n}C_{i} * x^{i}</span>

<span class="sd">    For explanation of ``domain``, and ``window`` see</span>
<span class="sd">    :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    degree : int</span>
<span class="sd">        degree of the series</span>
<span class="sd">    domain : tuple or None, optional</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">    window : tuple or None, optional</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword: value pairs, representing parameter_name: value</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
            <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># Set domain separately because it&#39;s different from</span>
        <span class="c1"># the orthogonal polynomials.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                       <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                       <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Polynomial1D.prepare_inputs"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial1D.html#astropy.modeling.polynomial.Polynomial1D.prepare_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">broadcasted_shapes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">broadcasted_shapes</span></div>

<div class="viewcode-block" id="Polynomial1D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial1D.html#astropy.modeling.polynomial.Polynomial1D.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">horner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Polynomial1D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial1D.html#astropy.modeling.polynomial.Polynomial1D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Vandermonde matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>

<div class="viewcode-block" id="Polynomial1D.horner"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial1D.html#astropy.modeling.polynomial.Polynomial1D.horner">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">horner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">c0</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="o">.</span><span class="n">unit</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">par</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">mapping</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">**</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">mapping</span></div>


<div class="viewcode-block" id="Polynomial2D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial2D.html#astropy.modeling.polynomial.Polynomial2D">[docs]</a><span class="k">class</span> <span class="nc">Polynomial2D</span><span class="p">(</span><span class="n">PolynomialModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D Polynomial  model.</span>

<span class="sd">    Represents a general polynomial of degree n:</span>

<span class="sd">    .. math::</span>

<span class="sd">        P(x,y) = c_{00} + c_{10}x + ...+ c_{n0}x^n + c_{01}y + ...+ c_{0n}y^n</span>
<span class="sd">        + c_{11}xy + c_{12}xy^2 + ... + c_{1(n-1)}xy^{n-1}+ ... + c_{(n-1)1}x^{n-1}y</span>

<span class="sd">    For explanation of ``x_domain``, ``y_domain``, ``x_window`` and ``y_window``</span>
<span class="sd">    see :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    degree : int</span>
<span class="sd">        Polynomial degree: largest sum of exponents (:math:`i + j`) of</span>
<span class="sd">        variables in each monomial term of the form :math:`x^i y^j`. The</span>
<span class="sd">        number of terms in a 2D polynomial of degree ``n`` is given by binomial</span>
<span class="sd">        coefficient :math:`C(n + 2, 2) = (n + 2)! / (2!\,n!) = (n + 1)(n + 2) / 2`.</span>
<span class="sd">    x_domain : tuple or None, optional</span>
<span class="sd">        domain of the x independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">    y_domain : tuple or None, optional</span>
<span class="sd">        domain of the y independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">    x_window : tuple or None, optional</span>
<span class="sd">        range of the x independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the x_domain to x_window</span>
<span class="sd">    y_window : tuple or None, optional</span>
<span class="sd">        range of the y independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the y_domain to y_window</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword: value pairs, representing parameter_name: value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">x_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x_domain&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;y_domain&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;x_window&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;y_window&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span> <span class="o">=</span> <span class="n">x_domain</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;x_domain&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span> <span class="o">=</span> <span class="n">y_domain</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;y_domain&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span> <span class="o">=</span> <span class="n">x_window</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;x_window&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span> <span class="o">=</span> <span class="n">y_window</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">[</span><span class="s1">&#39;y_window&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Polynomial2D.prepare_inputs"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial2D.html#astropy.modeling.polynomial.Polynomial2D.prepare_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">inputs</span><span class="p">,</span> <span class="n">broadcasted_shapes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_inputs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">broadcasted_shapes</span></div>

<div class="viewcode-block" id="Polynomial2D.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial2D.html#astropy.modeling.polynomial.Polynomial2D.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">poly_map_domain</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span><span class="p">)</span>
        <span class="n">invcoeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invlex_coeff</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multivariate_horner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">invcoeff</span><span class="p">)</span>

        <span class="c1"># Special case for degree==0 to ensure that the shape of the output is</span>
        <span class="c1"># still as expected by the broadcasting rules, even though the x and y</span>
        <span class="c1"># inputs are not used in the evaluation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output_shape</span> <span class="o">=</span> <span class="n">check_broadcast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">output_shape</span><span class="p">:</span>
                <span class="n">new_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>
                <span class="n">new_result</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">new_result</span>

        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_repr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">],</span>
                                 <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x_domain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span><span class="p">,</span>
                                         <span class="s1">&#39;y_domain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span><span class="p">,</span>
                                         <span class="s1">&#39;x_window&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span><span class="p">,</span>
                                         <span class="s1">&#39;y_window&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span><span class="p">},</span>
                                 <span class="n">defaults</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_str</span><span class="p">([(</span><span class="s1">&#39;Degree&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;X_Domain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_domain</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;Y_Domain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_domain</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;X_Window&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_window</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;Y_Window&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_window</span><span class="p">)],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_default_domain_window</span><span class="p">)</span>

<div class="viewcode-block" id="Polynomial2D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial2D.html#astropy.modeling.polynomial.Polynomial2D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Vandermonde matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expected x and y to be of equal size&#39;</span><span class="p">)</span>

        <span class="n">designx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">designy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">designmixed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">:</span>
                    <span class="n">designmixed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">j</span><span class="p">))</span>
        <span class="n">designmixed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">designmixed</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">designmixed</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">designx</span><span class="p">,</span> <span class="n">designy</span><span class="p">,</span> <span class="n">designmixed</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">designx</span><span class="p">,</span> <span class="n">designy</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="Polynomial2D.invlex_coeff"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial2D.html#astropy.modeling.polynomial.Polynomial2D.invlex_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">invlex_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="n">invlex_coeffs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lencoeff</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lencoeff</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lencoeff</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
                    <span class="n">invlex_coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">invlex_coeffs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Polynomial2D.multivariate_horner"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Polynomial2D.html#astropy.modeling.polynomial.Polynomial2D.multivariate_horner">[docs]</a>    <span class="k">def</span> <span class="nf">multivariate_horner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multivariate Horner&#39;s scheme</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : array</span>
<span class="sd">        coeffs : array</span>
<span class="sd">            Coefficients in inverse lexical order.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invlex</span><span class="p">()</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="mf">0.0</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="mf">0.0</span>
        <span class="n">karr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">karr</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">karr</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">r2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">r0</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">)</span>
                <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">subok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">r0</span> <span class="o">+</span> <span class="n">r1</span><span class="p">)</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1_0</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">c0_1</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c0_0</span><span class="o">.</span><span class="n">unit</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1_0</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c0_0</span><span class="o">.</span><span class="n">unit</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">c0_1</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">par</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                     <span class="o">/</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">**</span> <span class="n">i</span>
                                     <span class="o">/</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mapping</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_domain</span>

    <span class="nd">@x_domain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_domain</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_domain</span>

    <span class="nd">@y_domain</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_domain</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_window</span>

    <span class="nd">@x_window</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_window</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_window</span>

    <span class="nd">@y_window</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_window</span> <span class="o">=</span> <span class="n">_validate_domain_window</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="Chebyshev2D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev2D.html#astropy.modeling.polynomial.Chebyshev2D">[docs]</a><span class="k">class</span> <span class="nc">Chebyshev2D</span><span class="p">(</span><span class="n">OrthoPolynomialBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bivariate Chebyshev series..</span>

<span class="sd">    It is defined as</span>

<span class="sd">    .. math:: P_{nm}(x,y) = \sum_{n,m=0}^{n=d,m=d}C_{nm}  T_n(x ) T_m(y)</span>

<span class="sd">    where ``T_n(x)`` and ``T_m(y)`` are Chebyshev polynomials of the first kind.</span>

<span class="sd">    For explanation of ``x_domain``, ``y_domain``, ``x_window`` and ``y_window``</span>
<span class="sd">    see :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x_degree : int</span>
<span class="sd">        degree in x</span>
<span class="sd">    y_degree : int</span>
<span class="sd">        degree in y</span>
<span class="sd">    x_domain : tuple or None, optional</span>
<span class="sd">        domain of the x independent variable</span>
<span class="sd">    y_domain : tuple or None, optional</span>
<span class="sd">        domain of the y independent variable</span>
<span class="sd">    x_window : tuple or None, optional</span>
<span class="sd">        range of the x independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    y_window : tuple or None, optional</span>
<span class="sd">        range of the y independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>

<span class="sd">    **params : dict</span>
<span class="sd">        keyword: value pairs, representing parameter_name: value</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This model does not support the use of units/quantities, because each term</span>
<span class="sd">    in the sum of Chebyshev polynomials is a polynomial in x and/or y - since</span>
<span class="sd">    the coefficients within each Chebyshev polynomial are fixed, we can&#39;t use</span>
<span class="sd">    quantities for x and/or y since the units would not be compatible. For</span>
<span class="sd">    example, the third Chebyshev polynomial (T2) is 2x^2-1, but if x was</span>
<span class="sd">    specified with units, 2x^2 and -1 would have incompatible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">y_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="o">=</span><span class="n">y_domain</span><span class="p">,</span>
            <span class="n">x_window</span><span class="o">=</span><span class="n">x_window</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="n">y_window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
            <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fcache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the individual Chebyshev functions once and store them in a</span>
<span class="sd">        dictionary to be reused.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">y_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">kfunc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="n">x_terms</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="n">x_terms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_terms</span><span class="p">):</span>
            <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_terms</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x_terms</span> <span class="o">+</span> <span class="n">y_terms</span><span class="p">):</span>
            <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">kfunc</span>

<div class="viewcode-block" id="Chebyshev2D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Chebyshev2D.html#astropy.modeling.polynomial.Chebyshev2D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivatives with respect to the coefficients.</span>

<span class="sd">        This is an array with Chebyshev polynomials:</span>

<span class="sd">        .. math::</span>

<span class="sd">            T_{x_0}T_{y_0}, T_{x_1}T_{y_0}...T_{x_n}T_{y_0}...T_{x_n}T_{y_m}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x and y must have the same shape&quot;</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">x_deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chebderiv1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y_deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chebderiv1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ij</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ij</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_deriv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_deriv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ij</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span></div>

    <span class="k">def</span> <span class="nf">_chebderiv1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">deg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivative of 1D Chebyshev series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>


<div class="viewcode-block" id="Legendre2D"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre2D.html#astropy.modeling.polynomial.Legendre2D">[docs]</a><span class="k">class</span> <span class="nc">Legendre2D</span><span class="p">(</span><span class="n">OrthoPolynomialBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bivariate Legendre series.</span>

<span class="sd">    Defined as:</span>

<span class="sd">    .. math:: P_{n_m}(x,y) = \sum_{n,m=0}^{n=d,m=d}C_{nm}  L_n(x ) L_m(y)</span>

<span class="sd">    where ``L_n(x)`` and ``L_m(y)`` are Legendre polynomials.</span>

<span class="sd">    For explanation of ``x_domain``, ``y_domain``, ``x_window`` and ``y_window``</span>
<span class="sd">    see :ref:`Notes regarding usage of domain and window &lt;domain-window-note&gt;`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x_degree : int</span>
<span class="sd">        degree in x</span>
<span class="sd">    y_degree : int</span>
<span class="sd">        degree in y</span>
<span class="sd">    x_domain : tuple or None, optional</span>
<span class="sd">        domain of the x independent variable</span>
<span class="sd">    y_domain : tuple or None, optional</span>
<span class="sd">        domain of the y independent variable</span>
<span class="sd">    x_window : tuple or None, optional</span>
<span class="sd">        range of the x independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    y_window : tuple or None, optional</span>
<span class="sd">        range of the y independent variable</span>
<span class="sd">        If None, it is set to (-1, 1)</span>
<span class="sd">        Fitters will remap the domain to this window</span>
<span class="sd">    **params : dict</span>
<span class="sd">        keyword: value pairs, representing parameter_name: value</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Model formula:</span>

<span class="sd">    .. math::</span>

<span class="sd">        P(x) = \sum_{i=0}^{i=n}C_{i} * L_{i}(x)</span>

<span class="sd">    where ``L_{i}`` is the corresponding Legendre polynomial.</span>

<span class="sd">    This model does not support the use of units/quantities, because each term</span>
<span class="sd">    in the sum of Legendre polynomials is a polynomial in x - since the</span>
<span class="sd">    coefficients within each Legendre polynomial are fixed, we can&#39;t use</span>
<span class="sd">    quantities for x since the units would not be compatible. For example, the</span>
<span class="sd">    third Legendre polynomial (P2) is 1.5x^2-0.5, but if x was specified with</span>
<span class="sd">    units, 1.5x^2 and -0.5 would have incompatible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">y_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">x_degree</span><span class="p">,</span> <span class="n">y_degree</span><span class="p">,</span> <span class="n">x_domain</span><span class="o">=</span><span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="o">=</span><span class="n">y_domain</span><span class="p">,</span>
            <span class="n">x_window</span><span class="o">=</span><span class="n">x_window</span><span class="p">,</span> <span class="n">y_window</span><span class="o">=</span><span class="n">y_window</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
            <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fcache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the individual Legendre functions once and store them in a</span>
<span class="sd">        dictionary to be reused.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">y_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">kfunc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="n">x_terms</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">kfunc</span><span class="p">[</span><span class="n">x_terms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_terms</span><span class="p">):</span>
            <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                         <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">y_terms</span><span class="p">):</span>
            <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">x_terms</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">x_terms</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                                  <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">kfunc</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">x_terms</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kfunc</span>

<div class="viewcode-block" id="Legendre2D.fit_deriv"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.Legendre2D.html#astropy.modeling.polynomial.Legendre2D.fit_deriv">[docs]</a>    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivatives with respect to the coefficients.</span>
<span class="sd">        This is an array with Legendre polynomials:</span>

<span class="sd">        Lx0Ly0  Lx1Ly0...LxnLy0...LxnLym</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            input</span>
<span class="sd">        *params</span>
<span class="sd">            throw-away parameter list returned by non-linear fitters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ndarray</span>
<span class="sd">            The Vandermonde matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x and y must have the same shape&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">x_deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_legendderiv1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y_deriv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_legendderiv1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ij</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ij</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_deriv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_deriv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ij</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span></div>

    <span class="k">def</span> <span class="nf">_legendderiv1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">deg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Derivative of 1D Legendre polynomial&quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_SIP1D</span><span class="p">(</span><span class="n">PolynomialBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This implements the Simple Imaging Polynomial Model (SIP) in 1D.</span>

<span class="sd">    It&#39;s unlikely it will be used in 1D so this class is private</span>
<span class="sd">    and SIP should be used instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">coeff_prefix</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coeff_prefix</span> <span class="o">=</span> <span class="n">coeff_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_coeff_names</span><span class="p">(</span><span class="n">coeff_prefix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_models</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model_set_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">model_set_axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">minshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">model_set_axis</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_models</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minshape</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">minshape</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_repr</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff_prefix</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_str</span><span class="p">(</span>
            <span class="p">[(</span><span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Coeff. Prefix&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff_prefix</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">):</span>
        <span class="c1"># TODO: Rewrite this so that it uses a simpler method of determining</span>
        <span class="c1"># the matrix based on the number of given coefficients.</span>
        <span class="n">mcoef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coeff_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeff_prefix</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_sip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mcoef</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_num_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of coefficients in one param set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Degree of polynomial must be 2&lt; deg &lt; 9&quot;</span><span class="p">)</span>

        <span class="n">nmixed</span> <span class="o">=</span> <span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
        <span class="c1"># remove 3 terms because SIP deg &gt;= 2</span>
        <span class="n">numc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">*</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">nmixed</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">numc</span>

    <span class="k">def</span> <span class="nf">_generate_coeff_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeff_prefix</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">coeff_prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">coeff_prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">coeff_prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_coeff_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeff_prefix</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">coeff_prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">attr</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">coeff_prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">attr</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">coeff_prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">attr</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">mat</span>

    <span class="k">def</span> <span class="nf">_eval_sip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coef</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff_prefix</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">j</span>
        <span class="k">return</span> <span class="n">result</span>


<div class="viewcode-block" id="SIP"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.SIP.html#astropy.modeling.polynomial.SIP">[docs]</a><span class="k">class</span> <span class="nc">SIP</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple Imaging Polynomial (SIP) model.</span>

<span class="sd">    The SIP convention is used to represent distortions in FITS image headers.</span>
<span class="sd">    See [1]_ for a description of the SIP convention.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    crpix : list or (2,) ndarray</span>
<span class="sd">        CRPIX values</span>
<span class="sd">    a_order : int</span>
<span class="sd">        SIP polynomial order for first axis</span>
<span class="sd">    b_order : int</span>
<span class="sd">        SIP order for second axis</span>
<span class="sd">    a_coeff : dict</span>
<span class="sd">        SIP coefficients for first axis</span>
<span class="sd">    b_coeff : dict</span>
<span class="sd">        SIP coefficients for the second axis</span>
<span class="sd">    ap_order : int</span>
<span class="sd">        order for the inverse transformation (AP coefficients)</span>
<span class="sd">    bp_order : int</span>
<span class="sd">        order for the inverse transformation (BP coefficients)</span>
<span class="sd">    ap_coeff : dict</span>
<span class="sd">        coefficients for the inverse transform</span>
<span class="sd">    bp_coeff : dict</span>
<span class="sd">        coefficients for the inverse transform</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] `David Shupe, et al, ADASS, ASP Conference Series, Vol. 347, 2005</span>
<span class="sd">        &lt;https://ui.adsabs.harvard.edu/abs/2005ASPC..347..491S&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crpix</span><span class="p">,</span> <span class="n">a_order</span><span class="p">,</span> <span class="n">b_order</span><span class="p">,</span> <span class="n">a_coeff</span><span class="o">=</span><span class="p">{},</span> <span class="n">b_coeff</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">ap_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bp_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ap_coeff</span><span class="o">=</span><span class="p">{},</span> <span class="n">bp_coeff</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crpix</span> <span class="o">=</span> <span class="n">crpix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a_order</span> <span class="o">=</span> <span class="n">a_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b_order</span> <span class="o">=</span> <span class="n">b_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a_coeff</span> <span class="o">=</span> <span class="n">a_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b_coeff</span> <span class="o">=</span> <span class="n">b_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ap_order</span> <span class="o">=</span> <span class="n">ap_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp_order</span> <span class="o">=</span> <span class="n">bp_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ap_coeff</span> <span class="o">=</span> <span class="n">ap_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp_coeff</span> <span class="o">=</span> <span class="n">bp_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_a</span> <span class="o">=</span> <span class="n">Shift</span><span class="p">(</span><span class="o">-</span><span class="n">crpix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_b</span> <span class="o">=</span> <span class="n">Shift</span><span class="p">(</span><span class="o">-</span><span class="n">crpix</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_a</span> <span class="o">=</span> <span class="n">_SIP1D</span><span class="p">(</span><span class="n">a_order</span><span class="p">,</span> <span class="n">coeff_prefix</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
                              <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="o">**</span><span class="n">a_coeff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_b</span> <span class="o">=</span> <span class="n">_SIP1D</span><span class="p">(</span><span class="n">b_order</span><span class="p">,</span> <span class="n">coeff_prefix</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span>
                              <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span> <span class="o">**</span><span class="n">b_coeff</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_b</span><span class="p">]</span><span class="si">!r}</span><span class="s2">)&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_b</span><span class="p">]:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ap_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bp_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">InverseSIP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ap_order</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bp_order</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_ap_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bp_coeff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;SIP inverse coefficients are not available.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SIP.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.SIP.html#astropy.modeling.polynomial.SIP.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_a</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_a</span><span class="o">.</span><span class="n">param_sets</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_b</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_b</span><span class="o">.</span><span class="n">param_sets</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_a</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sip1d_a</span><span class="o">.</span><span class="n">param_sets</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_b</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sip1d_b</span><span class="o">.</span><span class="n">param_sets</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span></div></div>


<div class="viewcode-block" id="InverseSIP"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.InverseSIP.html#astropy.modeling.polynomial.InverseSIP">[docs]</a><span class="k">class</span> <span class="nc">InverseSIP</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse Simple Imaging Polynomial</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ap_order : int</span>
<span class="sd">        order for the inverse transformation (AP coefficients)</span>
<span class="sd">    bp_order : int</span>
<span class="sd">        order for the inverse transformation (BP coefficients)</span>
<span class="sd">    ap_coeff : dict</span>
<span class="sd">        coefficients for the inverse transform</span>
<span class="sd">    bp_coeff : dict</span>
<span class="sd">        coefficients for the inverse transform</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">_separable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ap_order</span><span class="p">,</span> <span class="n">bp_order</span><span class="p">,</span> <span class="n">ap_coeff</span><span class="o">=</span><span class="p">{},</span> <span class="n">bp_coeff</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">n_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ap_order</span> <span class="o">=</span> <span class="n">ap_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp_order</span> <span class="o">=</span> <span class="n">bp_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ap_coeff</span> <span class="o">=</span> <span class="n">ap_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp_coeff</span> <span class="o">=</span> <span class="n">bp_coeff</span>

        <span class="c1"># define the 0th term in order to use Polynomial2D</span>
        <span class="n">ap_coeff</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;AP_0_0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">bp_coeff</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;BP_0_0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">ap_coeff_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;AP_&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ap_coeff</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">bp_coeff_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;BP_&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bp_coeff</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_ap</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">ap_order</span><span class="p">,</span>
                                     <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">ap_coeff_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_bp</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">bp_order</span><span class="p">,</span>
                                     <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">bp_coeff_params</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_models</span><span class="o">=</span><span class="n">n_models</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="n">model_set_axis</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sip1d_ap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_bp</span><span class="p">]</span><span class="si">!r}</span><span class="s1">)&gt;&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sip1d_ap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_bp</span><span class="p">]:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

<div class="viewcode-block" id="InverseSIP.evaluate"><a class="viewcode-back" href="../../../api/astropy.modeling.polynomial.InverseSIP.html#astropy.modeling.polynomial.InverseSIP.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_ap</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sip1d_ap</span><span class="o">.</span><span class="n">param_sets</span><span class="p">)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sip1d_bp</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sip1d_bp</span><span class="o">.</span><span class="n">param_sets</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>