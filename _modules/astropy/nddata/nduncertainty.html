


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>astropy.nddata.nduncertainty &#8212; Astropy v5.2.dev96+g04a0cf8bb</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">Astropy v5.2.dev96+g04a0cf8bb</a>
	 &#187;
      </li>
      <li><a href="../../index.html" >Module code</a> &#187;</li>
      <li><a href="../nddata.html" accesskey="U">astropy.nddata</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astropy.nddata.nduncertainty</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">weakref</span>


<span class="c1"># from astropy.utils.compat import ignored</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="kn">import</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">UnitConversionError</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MissingDataAssociationException&#39;</span><span class="p">,</span>
           <span class="s1">&#39;IncompatibleUncertaintiesException&#39;</span><span class="p">,</span> <span class="s1">&#39;NDUncertainty&#39;</span><span class="p">,</span>
           <span class="s1">&#39;StdDevUncertainty&#39;</span><span class="p">,</span> <span class="s1">&#39;UnknownUncertainty&#39;</span><span class="p">,</span>
           <span class="s1">&#39;VarianceUncertainty&#39;</span><span class="p">,</span> <span class="s1">&#39;InverseVariance&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="IncompatibleUncertaintiesException"><a class="viewcode-back" href="../../../api/astropy.nddata.IncompatibleUncertaintiesException.html#astropy.nddata.IncompatibleUncertaintiesException">[docs]</a><span class="k">class</span> <span class="nc">IncompatibleUncertaintiesException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This exception should be used to indicate cases in which uncertainties</span>
<span class="sd">    with two different classes can not be propagated.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="MissingDataAssociationException"><a class="viewcode-back" href="../../../api/astropy.nddata.MissingDataAssociationException.html#astropy.nddata.MissingDataAssociationException">[docs]</a><span class="k">class</span> <span class="nc">MissingDataAssociationException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This exception should be used to indicate that an uncertainty instance</span>
<span class="sd">    has not been associated with a parent `~astropy.nddata.NDData` object.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="NDUncertainty"><a class="viewcode-back" href="../../../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty">[docs]</a><span class="k">class</span> <span class="nc">NDUncertainty</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the metaclass for uncertainty classes used with `NDData`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : any type, optional</span>
<span class="sd">        The array or value (the parameter name is due to historical reasons) of</span>
<span class="sd">        the uncertainty. `numpy.ndarray`, `~astropy.units.Quantity` or</span>
<span class="sd">        `NDUncertainty` subclasses are recommended.</span>
<span class="sd">        If the `array` is `list`-like or `numpy.ndarray`-like it will be cast</span>
<span class="sd">        to a plain `numpy.ndarray`.</span>
<span class="sd">        Default is ``None``.</span>

<span class="sd">    unit : unit-like, optional</span>
<span class="sd">        Unit for the uncertainty ``array``. Strings that can be converted to a</span>
<span class="sd">        `~astropy.units.Unit` are allowed.</span>
<span class="sd">        Default is ``None``.</span>

<span class="sd">    copy : `bool`, optional</span>
<span class="sd">        Indicates whether to save the `array` as a copy. ``True`` copies it</span>
<span class="sd">        before saving, while ``False`` tries to save every parameter as</span>
<span class="sd">        reference. Note however that it is not always possible to save the</span>
<span class="sd">        input as reference.</span>
<span class="sd">        Default is ``True``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    IncompatibleUncertaintiesException</span>
<span class="sd">        If given another `NDUncertainty`-like class as ``array`` if their</span>
<span class="sd">        ``uncertainty_type`` is different.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">NDUncertainty</span><span class="p">):</span>
            <span class="c1"># Given an NDUncertainty class or subclass check that the type</span>
            <span class="c1"># is the same.</span>
            <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">uncertainty_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty_type</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">IncompatibleUncertaintiesException</span>
            <span class="c1"># Check if two units are given and take the explicit one then.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">unit</span> <span class="o">!=</span> <span class="n">array</span><span class="o">.</span><span class="n">_unit</span><span class="p">):</span>
                <span class="c1"># TODO : Clarify it (see NDData.init for same problem)?</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;overwriting Uncertainty&#39;s current &quot;</span>
                         <span class="s2">&quot;unit with specified unit.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">array</span><span class="o">.</span><span class="n">_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
            <span class="c1"># Check if two units are given and take the explicit one then.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">array</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">unit</span> <span class="o">!=</span> <span class="n">array</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;overwriting Quantity&#39;s current &quot;</span>
                         <span class="s2">&quot;unit with specified unit.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">array</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># no associated NDData - until it is set!</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`str` : Short description of the type of uncertainty.</span>

<span class="sd">        Defined as abstract property so subclasses *have* to override this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_correlated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`bool` : Supports uncertainty propagation with correlated \</span>
<span class="sd">                 uncertainties?</span>

<span class="sd">        .. versionadded:: 1.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`numpy.ndarray` : the uncertainty&#39;s value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array</span>

    <span class="nd">@array</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_array</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`~astropy.units.Unit` : The unit of the uncertainty, if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span>

    <span class="nd">@unit</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unit should be set to a value consistent with the parent NDData</span>
<span class="sd">        unit and the uncertainty type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Check the hidden attribute below, not the property. The property</span>
            <span class="c1"># raises an exception if there is no parent_nddata.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parent_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Check for consistency with the unit of the parent_nddata</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="n">parent_unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s2">&quot;Unit </span><span class="si">{}</span><span class="s2"> is incompatible &quot;</span>
                                              <span class="s2">&quot;with unit </span><span class="si">{}</span><span class="s2"> of parent &quot;</span>
                                              <span class="s2">&quot;nddata&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                              <span class="n">parent_unit</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This uncertainty as an `~astropy.units.Quantity` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent_nddata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`NDData` : reference to `NDData` instance with this uncertainty.</span>

<span class="sd">        In case the reference is not set uncertainty propagation will not be</span>
<span class="sd">        possible since propagation might need the uncertain data besides the</span>
<span class="sd">        uncertainty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">no_parent_message</span> <span class="o">=</span> <span class="s2">&quot;uncertainty is not associated with an NDData object&quot;</span>
        <span class="n">parent_lost_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;the associated NDData object was deleted and cannot be accessed &quot;</span>
            <span class="s2">&quot;anymore. You can prevent the NDData object from being deleted by &quot;</span>
            <span class="s2">&quot;assigning it to a variable. If this happened after unpickling &quot;</span>
            <span class="s2">&quot;make sure you pickle the parent not the uncertainty directly.&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingDataAssociationException</span><span class="p">(</span><span class="n">no_parent_message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MissingDataAssociationException</span><span class="p">(</span><span class="n">no_parent_message</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The NDData is saved as weak reference so we must call it</span>
                <span class="c1"># to get the object the reference points to. However because</span>
                <span class="c1"># we have a weak reference here it&#39;s possible that the parent</span>
                <span class="c1"># was deleted because its reference count dropped to zero.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">):</span>
                    <span class="n">resolved_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">resolved_parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">parent_lost_message</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">resolved_parent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;parent_nddata should be a weakref to an NDData &quot;</span>
                             <span class="s2">&quot;object.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span>

    <span class="nd">@parent_nddata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parent_nddata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">):</span>
            <span class="c1"># Save a weak reference on the uncertainty that points to this</span>
            <span class="c1"># instance of NDData. Direct references should NOT be used:</span>
            <span class="c1"># https://github.com/astropy/astropy/pull/4799#discussion_r61236832</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># Set _parent_nddata here and access below with the property because value</span>
        <span class="c1"># is a weakref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># set uncertainty unit to that of the parent if it was not already set, unless initializing</span>
        <span class="c1"># with empty parent (Value=None)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Set the uncertainty&#39;s unit to the appropriate value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="n">parent_unit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check that units of uncertainty are compatible with those of</span>
                <span class="c1"># the parent. If they are, no need to change units of the</span>
                <span class="c1"># uncertainty or the data. If they are not, let the user know.</span>
                <span class="n">unit_from_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="n">parent_unit</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">unit_from_data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s2">&quot;Unit </span><span class="si">{}</span><span class="s2"> of uncertainty &quot;</span>
                                              <span class="s2">&quot;incompatible with unit </span><span class="si">{}</span><span class="s2"> of &quot;</span>
                                              <span class="s2">&quot;data&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
                                                            <span class="n">parent_unit</span><span class="p">))</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses must override this property. It should take in a data unit</span>
<span class="sd">        and return the correct unit for the uncertainty given the uncertainty</span>
<span class="sd">        type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># In case it wasn&#39;t possible to use array2string</span>
            <span class="n">body</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">prefix</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Because of the weak reference the class wouldn&#39;t be picklable.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span>
        <span class="k">except</span> <span class="n">MissingDataAssociationException</span><span class="p">:</span>
            <span class="c1"># In case there&#39;s no parent</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The state should contain 3 items.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_array</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_nddata</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Normal slicing on the array, keep the unit and return a reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="NDUncertainty.propagate"><a class="viewcode-back" href="../../../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty.propagate">[docs]</a>    <span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">other_nddata</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the resulting uncertainty given an operation on the data.</span>

<span class="sd">        .. versionadded:: 1.2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : callable</span>
<span class="sd">            The operation that is performed on the `NDData`. Supported are</span>
<span class="sd">            `numpy.add`, `numpy.subtract`, `numpy.multiply` and</span>
<span class="sd">            `numpy.true_divide` (or `numpy.divide`).</span>

<span class="sd">        other_nddata : `NDData` instance</span>
<span class="sd">            The second operand in the arithmetic operation.</span>

<span class="sd">        result_data : `~astropy.units.Quantity` or ndarray</span>
<span class="sd">            The result of the arithmetic operations on the data.</span>

<span class="sd">        correlation : `numpy.ndarray` or number</span>
<span class="sd">            The correlation (rho) is defined between the uncertainties in</span>
<span class="sd">            sigma_AB = sigma_A * sigma_B * rho. A value of ``0`` means</span>
<span class="sd">            uncorrelated operands.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        resulting_uncertainty : `NDUncertainty` instance</span>
<span class="sd">            Another instance of the same `NDUncertainty` subclass containing</span>
<span class="sd">            the uncertainty of the result.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the ``operation`` is not supported or if correlation is not zero</span>
<span class="sd">            but the subclass does not support correlated uncertainties.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        First this method checks if a correlation is given and the subclass</span>
<span class="sd">        implements propagation with correlated uncertainties.</span>
<span class="sd">        Then the second uncertainty is converted (or an Exception is raised)</span>
<span class="sd">        to the same class in order to do the propagation.</span>
<span class="sd">        Then the appropriate propagation method is invoked and the result is</span>
<span class="sd">        returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the subclass supports correlation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_correlated</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">correlation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">correlation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> does not support uncertainty propagation&quot;</span>
                                 <span class="s2">&quot; with correlation.&quot;</span>
                                 <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="c1"># Get the other uncertainty (and convert it to a matching one)</span>
        <span class="n">other_uncert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_uncertainty</span><span class="p">(</span><span class="n">other_nddata</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_add</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                         <span class="n">correlation</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;subtract&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_subtract</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                              <span class="n">correlation</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;multiply&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_multiply</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                              <span class="n">correlation</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true_divide&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagate_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                            <span class="n">correlation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unsupported operation&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_convert_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the uncertainties are compatible for propagation.</span>

<span class="sd">        Checks if the other uncertainty is `NDUncertainty`-like and if so</span>
<span class="sd">        verify that the uncertainty_type is equal. If the latter is not the</span>
<span class="sd">        case try returning ``self.__class__(other_uncert)``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other_uncert : `NDUncertainty` subclass</span>
<span class="sd">            The other uncertainty.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        other_uncert : `NDUncertainty` subclass</span>
<span class="sd">            but converted to a compatible `NDUncertainty` subclass if</span>
<span class="sd">            possible and necessary.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IncompatibleUncertaintiesException:</span>
<span class="sd">            If the other uncertainty cannot be converted to a compatible</span>
<span class="sd">            `NDUncertainty` subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">NDUncertainty</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty_type</span> <span class="o">==</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">uncertainty_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">other_uncert</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IncompatibleUncertaintiesException</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="NDUncertainty.represent_as"><a class="viewcode-back" href="../../../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty.represent_as">[docs]</a>    <span class="k">def</span> <span class="nf">represent_as</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert this uncertainty to a different uncertainty type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other_uncert : `NDUncertainty` subclass</span>
<span class="sd">            The `NDUncertainty` subclass to convert to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        resulting_uncertainty : `NDUncertainty` instance</span>
<span class="sd">            An instance of ``other_uncert`` subclass containing the uncertainty</span>
<span class="sd">            converted to the new uncertainty type.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If either the initial or final subclasses do not support</span>
<span class="sd">            conversion, a `TypeError` is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">as_variance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_convert_to_variance&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_variance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not support conversion to another &quot;</span>
                <span class="s2">&quot;uncertainty type.&quot;</span>
            <span class="p">)</span>
        <span class="n">from_variance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="s2">&quot;_convert_from_variance&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">from_variance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">other_uncert</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not support conversion from &quot;</span>
                <span class="s2">&quot;another uncertainty type.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">from_variance</span><span class="p">(</span><span class="n">as_variance</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="UnknownUncertainty"><a class="viewcode-back" href="../../../api/astropy.nddata.UnknownUncertainty.html#astropy.nddata.UnknownUncertainty">[docs]</a><span class="k">class</span> <span class="nc">UnknownUncertainty</span><span class="p">(</span><span class="n">NDUncertainty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class implements any unknown uncertainty type.</span>

<span class="sd">    The main purpose of having an unknown uncertainty class is to prevent</span>
<span class="sd">    uncertainty propagation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args, kwargs :</span>
<span class="sd">        see `NDUncertainty`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_correlated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`False` : Uncertainty propagation is *not* possible for this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``&quot;unknown&quot;`` : `UnknownUncertainty` implements any unknown \</span>
<span class="sd">                           uncertainty type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;unknown&#39;</span>

    <span class="k">def</span> <span class="nf">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        No way to convert if uncertainty is unknown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_convert_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise an Exception because unknown uncertainty types cannot</span>
<span class="sd">        implement propagation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Uncertainties of unknown type cannot be propagated.&quot;</span>
        <span class="k">raise</span> <span class="n">IncompatibleUncertaintiesException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not possible for unknown uncertainty types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="k">class</span> <span class="nc">_VariancePropagationMixin</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagation of uncertainties for variances, also used to perform error</span>
<span class="sd">    propagation for variance-like uncertainties (standard deviation and inverse</span>
<span class="sd">    variance).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_propagate_add_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                           <span class="n">subtract</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">to_variance</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">from_variance</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error propagation for addition or subtraction of variance or</span>
<span class="sd">        variance-like uncertainties. Uncertainties are calculated using the</span>
<span class="sd">        formulae for variance but can be used for uncertainty convertible to</span>
<span class="sd">        a variance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        other_uncert : `~astropy.nddata.NDUncertainty` instance</span>
<span class="sd">            The uncertainty, if any, of the other operand.</span>

<span class="sd">        result_data : `~astropy.nddata.NDData` instance</span>
<span class="sd">            The results of the operation on the data.</span>

<span class="sd">        correlation : float or array-like</span>
<span class="sd">            Correlation of the uncertainties.</span>

<span class="sd">        subtract : bool, optional</span>
<span class="sd">            If ``True``, propagate for subtraction, otherwise propagate for</span>
<span class="sd">            addition.</span>

<span class="sd">        to_variance : function, optional</span>
<span class="sd">            Function that will transform the input uncertainties to variance.</span>
<span class="sd">            The default assumes the uncertainty is the variance.</span>

<span class="sd">        from_variance : function, optional</span>
<span class="sd">            Function that will convert from variance to the input uncertainty.</span>
<span class="sd">            The default assumes the uncertainty is the variance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">subtract</span><span class="p">:</span>
            <span class="n">correlation_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">correlation_sign</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result_unit_sq</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">unit</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">result_unit_sq</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Formula: sigma**2 = dB</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">result_unit_sq</span> <span class="o">!=</span> <span class="n">to_variance</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">unit</span><span class="p">)):</span>
                <span class="c1"># If the other uncertainty has a unit and this unit differs</span>
                <span class="c1"># from the unit of the result convert it to the results unit</span>
                <span class="n">other</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span> <span class="o">&lt;&lt;</span>
                                    <span class="n">other_uncert</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">result_unit_sq</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Formula: sigma**2 = dA</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">to_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1"># If the uncertainty has a different unit than the result we</span>
                <span class="c1"># need to convert it to the results unit.</span>
                <span class="n">this</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">result_unit_sq</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Formula: sigma**2 = dA + dB +/- 2*cor*sqrt(dA*dB)</span>
        <span class="c1"># Formula: sigma**2 = sigma_other + sigma_self +/- 2*cor*sqrt(dA*dB)</span>
        <span class="c1">#     (sign depends on whether addition or subtraction)</span>

        <span class="c1"># Determine the result depending on the correlation</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">correlation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">correlation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">correlation</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">this</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">this</span> <span class="o">+</span> <span class="n">other</span> <span class="o">+</span> <span class="n">correlation_sign</span> <span class="o">*</span> <span class="n">corr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">this</span> <span class="o">+</span> <span class="n">other</span>

        <span class="k">return</span> <span class="n">from_variance</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_multiply_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                   <span class="n">correlation</span><span class="p">,</span>
                                   <span class="n">divide</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">to_variance</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                                   <span class="n">from_variance</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error propagation for multiplication or division of variance or</span>
<span class="sd">        variance-like uncertainties. Uncertainties are calculated using the</span>
<span class="sd">        formulae for variance but can be used for uncertainty convertible to</span>
<span class="sd">        a variance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        other_uncert : `~astropy.nddata.NDUncertainty` instance</span>
<span class="sd">            The uncertainty, if any, of the other operand.</span>

<span class="sd">        result_data : `~astropy.nddata.NDData` instance</span>
<span class="sd">            The results of the operation on the data.</span>

<span class="sd">        correlation : float or array-like</span>
<span class="sd">            Correlation of the uncertainties.</span>

<span class="sd">        divide : bool, optional</span>
<span class="sd">            If ``True``, propagate for division, otherwise propagate for</span>
<span class="sd">            multiplication.</span>

<span class="sd">        to_variance : function, optional</span>
<span class="sd">            Function that will transform the input uncertainties to variance.</span>
<span class="sd">            The default assumes the uncertainty is the variance.</span>

<span class="sd">        from_variance : function, optional</span>
<span class="sd">            Function that will convert from variance to the input uncertainty.</span>
<span class="sd">            The default assumes the uncertainty is the variance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For multiplication we don&#39;t need the result as quantity</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_data</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
            <span class="n">result_data</span> <span class="o">=</span> <span class="n">result_data</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">divide</span><span class="p">:</span>
            <span class="n">correlation_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">correlation_sign</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># We want the result to have a unit consistent with the parent, so</span>
            <span class="c1"># we only need to convert the unit of the other uncertainty if it</span>
            <span class="c1"># is different from its data&#39;s unit.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">unit</span> <span class="ow">and</span>
                <span class="n">to_variance</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">!=</span>
                    <span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                <span class="n">d_b</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span> <span class="o">&lt;&lt;</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_b</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="c1"># Formula: sigma**2 = |A|**2 * d_b</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">data</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d_b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Just the reversed case</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">and</span>
                <span class="n">to_variance</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">!=</span>
                    <span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                <span class="n">d_a</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d_a</span> <span class="o">=</span> <span class="n">to_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="c1"># Formula: sigma**2 = |B|**2 * d_a</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">data</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d_a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Multiplication</span>
        <span class="c1">#</span>
        <span class="c1"># The fundamental formula is:</span>
        <span class="c1">#   sigma**2 = |AB|**2*(d_a/A**2+d_b/B**2+2*sqrt(d_a)/A*sqrt(d_b)/B*cor)</span>
        <span class="c1">#</span>
        <span class="c1"># This formula is not very handy since it generates NaNs for every</span>
        <span class="c1"># zero in A and B. So we rewrite it:</span>
        <span class="c1">#</span>
        <span class="c1"># Multiplication Formula:</span>
        <span class="c1">#   sigma**2 = (d_a*B**2 + d_b*A**2 + (2 * cor * ABsqrt(dAdB)))</span>
        <span class="c1">#   sigma**2 = (left + right + (2 * cor * ABsqrt(dAdB)))</span>
        <span class="c1">#</span>
        <span class="c1"># Division</span>
        <span class="c1">#</span>
        <span class="c1"># The fundamental formula for division is:</span>
        <span class="c1">#   sigma**2 = |A/B|**2*(d_a/A**2+d_b/B**2-2*sqrt(d_a)/A*sqrt(d_b)/B*cor)</span>
        <span class="c1">#</span>
        <span class="c1"># As with multiplication, it is convenient to rewrite this to avoid</span>
        <span class="c1"># nans where A is zero.</span>
        <span class="c1">#</span>
        <span class="c1"># Division formula (rewritten):</span>
        <span class="c1">#   sigma**2 = d_a/B**2 + (A/B)**2 * d_b/B**2</span>
        <span class="c1">#                   - 2 * cor * A *sqrt(dAdB) / B**3</span>
        <span class="c1">#   sigma**2 = d_a/B**2 + (A/B)**2 * d_b/B**2</span>
        <span class="c1">#                   - 2*cor * sqrt(d_a)/B**2  * sqrt(d_b) * A / B</span>
        <span class="c1">#   sigma**2 = multiplication formula/B**4 (and sign change in</span>
        <span class="c1">#               the correlation)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">correlation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">correlation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">correlation</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_a</span> <span class="o">*</span> <span class="n">d_b</span><span class="p">)</span> <span class="o">*</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span>
                    <span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">divide</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">from_variance</span><span class="p">((</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="n">correlation_sign</span> <span class="o">*</span> <span class="n">corr</span><span class="p">)</span> <span class="o">/</span>
                                 <span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="o">.</span><span class="n">data</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">from_variance</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="n">correlation_sign</span> <span class="o">*</span> <span class="n">corr</span><span class="p">)</span>


<div class="viewcode-block" id="StdDevUncertainty"><a class="viewcode-back" href="../../../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty">[docs]</a><span class="k">class</span> <span class="nc">StdDevUncertainty</span><span class="p">(</span><span class="n">_VariancePropagationMixin</span><span class="p">,</span> <span class="n">NDUncertainty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Standard deviation uncertainty assuming first order gaussian error</span>
<span class="sd">    propagation.</span>

<span class="sd">    This class implements uncertainty propagation for ``addition``,</span>
<span class="sd">    ``subtraction``, ``multiplication`` and ``division`` with other instances</span>
<span class="sd">    of `StdDevUncertainty`. The class can handle if the uncertainty has a</span>
<span class="sd">    unit that differs from (but is convertible to) the parents `NDData` unit.</span>
<span class="sd">    The unit of the resulting uncertainty will have the same unit as the</span>
<span class="sd">    resulting data. Also support for correlation is possible but requires the</span>
<span class="sd">    correlation as input. It cannot handle correlation determination itself.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args, kwargs :</span>
<span class="sd">        see `NDUncertainty`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    `StdDevUncertainty` should always be associated with an `NDData`-like</span>
<span class="sd">    instance, either by creating it during initialization::</span>

<span class="sd">        &gt;&gt;&gt; from astropy.nddata import NDData, StdDevUncertainty</span>
<span class="sd">        &gt;&gt;&gt; ndd = NDData([1,2,3], unit=&#39;m&#39;,</span>
<span class="sd">        ...              uncertainty=StdDevUncertainty([0.1, 0.1, 0.1]))</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty  # doctest: +FLOAT_CMP</span>
<span class="sd">        StdDevUncertainty([0.1, 0.1, 0.1])</span>

<span class="sd">    or by setting it manually on the `NDData` instance::</span>

<span class="sd">        &gt;&gt;&gt; ndd.uncertainty = StdDevUncertainty([0.2], unit=&#39;m&#39;, copy=True)</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty  # doctest: +FLOAT_CMP</span>
<span class="sd">        StdDevUncertainty([0.2])</span>

<span class="sd">    the uncertainty ``array`` can also be set directly::</span>

<span class="sd">        &gt;&gt;&gt; ndd.uncertainty.array = 2</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty</span>
<span class="sd">        StdDevUncertainty(2)</span>

<span class="sd">    .. note::</span>
<span class="sd">        The unit will not be displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_correlated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`True` : `StdDevUncertainty` allows to propagate correlated \</span>
<span class="sd">                    uncertainties.</span>

<span class="sd">        ``correlation`` must be given, this class does not implement computing</span>
<span class="sd">        it by itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``&quot;std&quot;`` : `StdDevUncertainty` implements standard deviation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;std&#39;</span>

    <span class="k">def</span> <span class="nf">_convert_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">StdDevUncertainty</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other_uncert</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IncompatibleUncertaintiesException</span>

    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_add_sub</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                          <span class="n">correlation</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">to_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                                          <span class="n">from_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_add_sub</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                          <span class="n">correlation</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">to_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                                          <span class="n">from_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_multiply_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span>
                                                  <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                                                  <span class="n">divide</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">to_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                                                  <span class="n">from_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_multiply_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span>
                                                  <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                                                  <span class="n">divide</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">to_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                                                  <span class="n">from_variance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_convert_to_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">new_unit</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">VarianceUncertainty</span><span class="p">(</span><span class="n">new_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">new_unit</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_convert_from_variance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">var_uncert</span><span class="p">):</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">array</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">new_unit</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">unit</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">new_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">new_unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="VarianceUncertainty"><a class="viewcode-back" href="../../../api/astropy.nddata.VarianceUncertainty.html#astropy.nddata.VarianceUncertainty">[docs]</a><span class="k">class</span> <span class="nc">VarianceUncertainty</span><span class="p">(</span><span class="n">_VariancePropagationMixin</span><span class="p">,</span> <span class="n">NDUncertainty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variance uncertainty assuming first order Gaussian error</span>
<span class="sd">    propagation.</span>

<span class="sd">    This class implements uncertainty propagation for ``addition``,</span>
<span class="sd">    ``subtraction``, ``multiplication`` and ``division`` with other instances</span>
<span class="sd">    of `VarianceUncertainty`. The class can handle if the uncertainty has a</span>
<span class="sd">    unit that differs from (but is convertible to) the parents `NDData` unit.</span>
<span class="sd">    The unit of the resulting uncertainty will be the square of the unit of the</span>
<span class="sd">    resulting data. Also support for correlation is possible but requires the</span>
<span class="sd">    correlation as input. It cannot handle correlation determination itself.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args, kwargs :</span>
<span class="sd">        see `NDUncertainty`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Compare this example to that in `StdDevUncertainty`; the uncertainties</span>
<span class="sd">    in the examples below are equivalent to the uncertainties in</span>
<span class="sd">    `StdDevUncertainty`.</span>

<span class="sd">    `VarianceUncertainty` should always be associated with an `NDData`-like</span>
<span class="sd">    instance, either by creating it during initialization::</span>

<span class="sd">        &gt;&gt;&gt; from astropy.nddata import NDData, VarianceUncertainty</span>
<span class="sd">        &gt;&gt;&gt; ndd = NDData([1,2,3], unit=&#39;m&#39;,</span>
<span class="sd">        ...              uncertainty=VarianceUncertainty([0.01, 0.01, 0.01]))</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty  # doctest: +FLOAT_CMP</span>
<span class="sd">        VarianceUncertainty([0.01, 0.01, 0.01])</span>

<span class="sd">    or by setting it manually on the `NDData` instance::</span>

<span class="sd">        &gt;&gt;&gt; ndd.uncertainty = VarianceUncertainty([0.04], unit=&#39;m^2&#39;, copy=True)</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty  # doctest: +FLOAT_CMP</span>
<span class="sd">        VarianceUncertainty([0.04])</span>

<span class="sd">    the uncertainty ``array`` can also be set directly::</span>

<span class="sd">        &gt;&gt;&gt; ndd.uncertainty.array = 4</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty</span>
<span class="sd">        VarianceUncertainty(4)</span>

<span class="sd">    .. note::</span>
<span class="sd">        The unit will not be displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``&quot;var&quot;`` : `VarianceUncertainty` implements variance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;var&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_correlated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`True` : `VarianceUncertainty` allows to propagate correlated \</span>
<span class="sd">                    uncertainties.</span>

<span class="sd">        ``correlation`` must be given, this class does not implement computing</span>
<span class="sd">        it by itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_add_sub</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                          <span class="n">correlation</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_add_sub</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                          <span class="n">correlation</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_multiply_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span>
                                                  <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                                                  <span class="n">divide</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_multiply_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span>
                                                  <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                                                  <span class="n">divide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_convert_to_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_convert_from_variance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">var_uncert</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var_uncert</span></div>


<span class="k">def</span> <span class="nf">_inverse</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Just a simple inverse for use in the InverseVariance&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">x</span>


<div class="viewcode-block" id="InverseVariance"><a class="viewcode-back" href="../../../api/astropy.nddata.InverseVariance.html#astropy.nddata.InverseVariance">[docs]</a><span class="k">class</span> <span class="nc">InverseVariance</span><span class="p">(</span><span class="n">_VariancePropagationMixin</span><span class="p">,</span> <span class="n">NDUncertainty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse variance uncertainty assuming first order Gaussian error</span>
<span class="sd">    propagation.</span>

<span class="sd">    This class implements uncertainty propagation for ``addition``,</span>
<span class="sd">    ``subtraction``, ``multiplication`` and ``division`` with other instances</span>
<span class="sd">    of `InverseVariance`. The class can handle if the uncertainty has a unit</span>
<span class="sd">    that differs from (but is convertible to) the parents `NDData` unit. The</span>
<span class="sd">    unit of the resulting uncertainty will the inverse square of the unit of</span>
<span class="sd">    the resulting data. Also support for correlation is possible but requires</span>
<span class="sd">    the correlation as input. It cannot handle correlation determination</span>
<span class="sd">    itself.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args, kwargs :</span>
<span class="sd">        see `NDUncertainty`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Compare this example to that in `StdDevUncertainty`; the uncertainties</span>
<span class="sd">    in the examples below are equivalent to the uncertainties in</span>
<span class="sd">    `StdDevUncertainty`.</span>

<span class="sd">    `InverseVariance` should always be associated with an `NDData`-like</span>
<span class="sd">    instance, either by creating it during initialization::</span>

<span class="sd">        &gt;&gt;&gt; from astropy.nddata import NDData, InverseVariance</span>
<span class="sd">        &gt;&gt;&gt; ndd = NDData([1,2,3], unit=&#39;m&#39;,</span>
<span class="sd">        ...              uncertainty=InverseVariance([100, 100, 100]))</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty  # doctest: +FLOAT_CMP</span>
<span class="sd">        InverseVariance([100, 100, 100])</span>

<span class="sd">    or by setting it manually on the `NDData` instance::</span>

<span class="sd">        &gt;&gt;&gt; ndd.uncertainty = InverseVariance([25], unit=&#39;1/m^2&#39;, copy=True)</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty  # doctest: +FLOAT_CMP</span>
<span class="sd">        InverseVariance([25])</span>

<span class="sd">    the uncertainty ``array`` can also be set directly::</span>

<span class="sd">        &gt;&gt;&gt; ndd.uncertainty.array = 0.25</span>
<span class="sd">        &gt;&gt;&gt; ndd.uncertainty</span>
<span class="sd">        InverseVariance(0.25)</span>

<span class="sd">    .. note::</span>
<span class="sd">        The unit will not be displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``&quot;ivar&quot;`` : `InverseVariance` implements inverse variance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;ivar&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_correlated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`True` : `InverseVariance` allows to propagate correlated \</span>
<span class="sd">                    uncertainties.</span>

<span class="sd">        ``correlation`` must be given, this class does not implement computing</span>
<span class="sd">        it by itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_add_sub</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                          <span class="n">correlation</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">to_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">,</span>
                                          <span class="n">from_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_add_sub</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span>
                                          <span class="n">correlation</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">to_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">,</span>
                                          <span class="n">from_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_multiply_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span>
                                                  <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                                                  <span class="n">divide</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">to_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">,</span>
                                                  <span class="n">from_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_multiply_divide</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span>
                                                  <span class="n">result_data</span><span class="p">,</span> <span class="n">correlation</span><span class="p">,</span>
                                                  <span class="n">divide</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">to_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">,</span>
                                                  <span class="n">from_variance</span><span class="o">=</span><span class="n">_inverse</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">value</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_convert_to_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
        <span class="n">new_unit</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">return</span> <span class="n">VarianceUncertainty</span><span class="p">(</span><span class="n">new_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">new_unit</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_convert_from_variance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">var_uncert</span><span class="p">):</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">array</span>
        <span class="n">new_unit</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">var_uncert</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">new_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">new_unit</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 20112022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>