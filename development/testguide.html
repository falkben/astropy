


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing Guidelines &#8212; Astropy v5.2.dev104+gcdd6a1f81.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Astropy Testing Tools" href="../testhelpers.html" />
    <link rel="prev" title="Astropy Narrative Style Guide: A Writing Resource for Contributors" href="style-guide.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../testhelpers.html" title="Astropy Testing Tools">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="style-guide.html" title="Astropy Narrative Style Guide: A Writing Resource for Contributors">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev104+gcdd6a1f81.d20220509</a>
	 &#187;
      </li>
      
      <li>Testing Guidelines</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing-guidelines">
<span id="id1"></span><h1>Testing Guidelines<a class="headerlink" href="#testing-guidelines" title="Permalink to this headline">¶</a></h1>
<p>This section describes the testing framework and format standards for tests in
Astropy core and coordinated packages, and also serves as recommendations for
affiliated packages.</p>
<div class="section" id="testing-framework">
<h2>Testing Framework<a class="headerlink" href="#testing-framework" title="Permalink to this headline">¶</a></h2>
<p>The testing framework used by astropy (and packages using the <a class="reference internal" href="astropy-package-template.html"><span class="doc">Astropy
package template</span></a>) is the <a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a> framework.</p>
</div>
<div class="section" id="testing-dependencies">
<span id="id2"></span><h2>Testing Dependencies<a class="headerlink" href="#testing-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The dependencies used by the Astropy test runner are provided by a separate
package called <a class="reference external" href="https://github.com/astropy/pytest-astropy">pytest-astropy</a>. This package provides the <code class="docutils literal notranslate"><span class="pre">pytest</span></code>
dependency itself, in addition to several <code class="docutils literal notranslate"><span class="pre">pytest</span></code> plugins that are used by
Astropy, and will also be of general use to other packages.</p>
<p>Since the testing dependencies are not actually required to install or use
Astropy, they are not included in <code class="docutils literal notranslate"><span class="pre">install_requires</span></code> in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>.
Instead, they are listed in an <code class="docutils literal notranslate"><span class="pre">extras_require</span></code> section called <code class="docutils literal notranslate"><span class="pre">test</span></code> in
<code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>. Developers who want to run the test suite will need to either
install pytest-astropy directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span><span class="o">-</span><span class="n">astropy</span>
</pre></div>
</div>
<p>or install the core package in ‘editable’ mode specifying the <code class="docutils literal notranslate"><span class="pre">[test]</span></code>
option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>
</pre></div>
</div>
<p>A detailed description of the plugins can be found in the <a class="reference internal" href="#pytest-plugins"><span class="std std-ref">Pytest Plugins</span></a>
section.</p>
</div>
<div class="section" id="running-tests">
<span id="id3"></span><h2>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>There are currently three different ways to invoke Astropy tests. Each
method invokes <a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a> to run the tests but offers different options when
calling. To run the tests, you will need to make sure you have the <a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a>
package installed.</p>
<p>In addition to running the Astropy tests, these methods can also be called
so that they check Python source code for <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8 compliance</a>. All of the PEP8 testing
options require the <a class="reference external" href="https://pypi.org/project/pytest-pep8">pytest-pep8 plugin</a>, which must be installed
separately.</p>
<div class="section" id="tox">
<h3>tox<a class="headerlink" href="#tox" title="Permalink to this headline">¶</a></h3>
<p>The most robust way to run the tests (which can also be the slowest) is
to make use of <a class="reference external" href="https://tox.readthedocs.io/en/latest/">Tox</a>, which is a
general purpose tool for automating Python testing. One of the benefits of tox
is that it first creates a source distribution of the package being tested, and
installs it into a new virtual environment, along with any dependencies that are
declared in the package, before running the tests. This can therefore catch
issues related to undeclared package data, or missing dependencies. Since we use
tox to run many of the tests on continuous integration services, it can also be
used in many cases to reproduce issues seen on those services.</p>
<p>To run the tests with tox, first make sure that tox is installed, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">tox</span>
</pre></div>
</div>
<p>then run the basic test suite with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">test</span>
</pre></div>
</div>
<p>or run the test suite with all optional dependencies with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">test</span><span class="o">-</span><span class="n">alldeps</span>
</pre></div>
</div>
<p>You can see a list of available test environments with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>which will also explain what each of them does.</p>
<p>You can also run checks or commands not directly related to tests - for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">codestyle</span>
</pre></div>
</div>
<p>will run checks using the flake8 tool.</p>
<p>Is is possible to pass options to pytest when running tox - to do this, add a
<code class="docutils literal notranslate"><span class="pre">--</span></code> after the regular tox command, and anything after this will be passed to
pytest, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">test</span> <span class="o">--</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">pdb</span>
</pre></div>
</div>
<p>This can be used in conjunction with the <code class="docutils literal notranslate"><span class="pre">-P</span></code> option provided by the
<a class="reference external" href="https://github.com/astropy/pytest-filter-subpackage">pytest-filter-subpackage</a>
plugin to run just part of the test suite.</p>
</div>
<div class="section" id="pytest">
<span id="running-pytest"></span><h3>pytest<a class="headerlink" href="#pytest" title="Permalink to this headline">¶</a></h3>
<p>The test suite can also be run directly from the native <code class="docutils literal notranslate"><span class="pre">pytest</span></code> command,
which is generally faster than using tox for iterative development. In
this case, it is important for developers to be aware that they must manually
rebuild any extensions by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>
</pre></div>
</div>
<p>before running the test with pytest with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span>
</pre></div>
</div>
<p>Instead of calling <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.[test]</span></code>, you can also build the
extensions with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build_ext</span> <span class="o">--</span><span class="n">inplace</span>
</pre></div>
</div>
<p>which avoids also installing the developer version of astropy into your current
environment - however note that the <code class="docutils literal notranslate"><span class="pre">pip</span></code> command is required if you need to
test parts of the package that rely on certain <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#entry-points">entry points</a>
being installed.</p>
<p>It is possible to run only the tests for a particular subpackage or set of
subpackages.  For example, to run only the <code class="docutils literal notranslate"><span class="pre">wcs</span></code> tests from the
commandline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">-</span><span class="n">P</span> <span class="n">wcs</span>
</pre></div>
</div>
<p>Or, to run only the <code class="docutils literal notranslate"><span class="pre">wcs</span></code> and <code class="docutils literal notranslate"><span class="pre">utils</span></code> tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">-</span><span class="n">P</span> <span class="n">wcs</span><span class="p">,</span><span class="n">utils</span>
</pre></div>
</div>
<p>You can also specify a single directory or file to test from the commandline,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">astropy</span><span class="o">/</span><span class="n">modeling</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">astropy</span><span class="o">/</span><span class="n">wcs</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_wcs</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>and this works for <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">astropy</span><span class="o">/</span><span class="n">wcs</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">rst</span>
</pre></div>
</div>
</div>
<div class="section" id="astropy-test">
<span id="id4"></span><h3>astropy.test()<a class="headerlink" href="#astropy-test" title="Permalink to this headline">¶</a></h3>
<p>Tests can be run from an installed version of Astropy with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">astropy</span>
<span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>This will run all the default tests for Astropy (but will not run the
documentation tests in the <code class="docutils literal notranslate"><span class="pre">.rst</span></code> documentation since those files are
not installed).</p>
<p>Tests for a specific package can be run by specifying the package in the call
to the <code class="docutils literal notranslate"><span class="pre">test()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;io.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This method works only with package names that can be mapped to Astropy
directories. As an alternative you can test a specific directory or file
with the <code class="docutils literal notranslate"><span class="pre">test_path</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test_path</span><span class="o">=</span><span class="s1">&#39;wcs/tests/test_wcs.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">test_path</span></code> must be specified either relative to the working directory
or absolutely.</p>
<p>By default <a class="reference internal" href="#astropy-test">astropy.test()</a> will skip tests which retrieve data from the
internet. To turn these tests on use the <code class="docutils literal notranslate"><span class="pre">remote_data</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;io.fits&#39;</span><span class="p">,</span> <span class="n">remote_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">test</span></code> function supports any of the options that can be
passed to <a class="reference external" href="https://docs.pytest.org/en/stable/how-to/usage.html#pytest-main-usage" title="(in pytest v7.1.2)"><span class="xref std std-ref">pytest.main()</span></a>
and convenience options <code class="docutils literal notranslate"><span class="pre">verbose=</span></code> and <code class="docutils literal notranslate"><span class="pre">pastebin=</span></code>.</p>
<p>Enable PEP8 compliance testing with <code class="docutils literal notranslate"><span class="pre">pep8=True</span></code> in the call to
<code class="docutils literal notranslate"><span class="pre">astropy.test</span></code>. This will enable PEP8 checking and disable regular tests.</p>
<div class="section" id="astropy-test-function">
<h4>Astropy Test Function<a class="headerlink" href="#astropy-test-function" title="Permalink to this headline">¶</a></h4>
<dl class="py function">
<dt id="astropy.test">
<code class="sig-prename descclassname"><span class="pre">astropy.</span></code><code class="sig-name descname"><span class="pre">test</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#astropy.test" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the tests for the package.</p>
<p>This method builds arguments for and then calls <code class="docutils literal notranslate"><span class="pre">pytest.main</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>package</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, optional</span></dt><dd><p>The name of a specific package to test, e.g. ‘io.fits’ or
‘utils’. Accepts comma separated string to specify multiple
packages. If nothing is specified all default tests are run.</p>
</dd>
<dt><strong>args</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, optional</span></dt><dd><p>Additional arguments to be passed to <code class="docutils literal notranslate"><span class="pre">pytest.main</span></code> in the <code class="docutils literal notranslate"><span class="pre">args</span></code>
keyword argument.</p>
</dd>
<dt><strong>docs_path</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, optional</span></dt><dd><p>The path to the documentation .rst files.</p>
</dd>
<dt><strong>open_files</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Fail when any tests leave files open.  Off by default, because
this adds extra run time to the test suite.  Requires the
<code class="docutils literal notranslate"><span class="pre">psutil</span></code> package.</p>
</dd>
<dt><strong>parallel</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">int</span></code></a> or ‘auto’, optional</span></dt><dd><p>When provided, run the tests in parallel on the specified
number of CPUs.  If parallel is <code class="docutils literal notranslate"><span class="pre">'auto'</span></code>, it will use the all
the cores on the machine.  Requires the <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code> plugin.</p>
</dd>
<dt><strong>pastebin</strong><span class="classifier">(‘failed’, ‘all’, <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a>), optional</span></dt><dd><p>Convenience option for turning on pytest pastebin output. Set to
‘failed’ to upload info for failed tests, or ‘all’ to upload info
for all tests.</p>
</dd>
<dt><strong>pdb</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Turn on PDB post-mortem analysis for failing tests. Same as
specifying <code class="docutils literal notranslate"><span class="pre">--pdb</span></code> in <code class="docutils literal notranslate"><span class="pre">args</span></code>.</p>
</dd>
<dt><strong>pep8</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Turn on PEP8 checking via the pytest-pep8 plugin and disable normal
tests. Same as specifying <code class="docutils literal notranslate"><span class="pre">--pep8</span> <span class="pre">-k</span> <span class="pre">pep8</span></code> in <code class="docutils literal notranslate"><span class="pre">args</span></code>.</p>
</dd>
<dt><strong>plugins</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">list</span></code></a>, optional</span></dt><dd><p>Plugins to be passed to <code class="docutils literal notranslate"><span class="pre">pytest.main</span></code> in the <code class="docutils literal notranslate"><span class="pre">plugins</span></code> keyword
argument.</p>
</dd>
<dt><strong>remote_data</strong><span class="classifier">{‘none’, ‘astropy’, ‘any’}, optional</span></dt><dd><p>Controls whether to run tests marked with &#64;pytest.mark.remote_data. This can be
set to run no tests with remote data (<code class="docutils literal notranslate"><span class="pre">none</span></code>), only ones that use
data from <a class="reference external" href="http://data.astropy.org">http://data.astropy.org</a> (<code class="docutils literal notranslate"><span class="pre">astropy</span></code>), or all tests that
use remote data (<code class="docutils literal notranslate"><span class="pre">any</span></code>). The default is <code class="docutils literal notranslate"><span class="pre">none</span></code>.</p>
</dd>
<dt><strong>repeat</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>, optional</span></dt><dd><p>If set, specifies how many times each test should be run. This is
useful for diagnosing sporadic failures.</p>
</dd>
<dt><strong>skip_docs</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>, optional</span></dt><dd><p>When <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, skips running the doctests in the .rst files.</p>
</dd>
<dt><strong>test_path</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, optional</span></dt><dd><p>Specify location to test by path. May be a single file or
directory. Must be specified absolutely or relative to the
calling directory.</p>
</dd>
<dt><strong>verbose</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Convenience option to turn on verbose output from pytest. Passing
True is the same as specifying <code class="docutils literal notranslate"><span class="pre">-v</span></code> in <code class="docutils literal notranslate"><span class="pre">args</span></code>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="test-running-options">
<h3>Test-running options<a class="headerlink" href="#test-running-options" title="Permalink to this headline">¶</a></h3>
<div class="section" id="testing-for-open-files">
<span id="open-files"></span><h4>Testing for open files<a class="headerlink" href="#testing-for-open-files" title="Permalink to this headline">¶</a></h4>
<p>Using the <a class="reference internal" href="#openfiles-plugin"><span class="std std-ref">pytest-openfiles</span></a> plugin (which is installed automatically
when installing pytest-astropy),  we can test whether any of the unit tests
inadvertently leave any files open.  Since this greatly slows down the time it
takes to run the tests, it is turned off by default.</p>
<p>To use it from the commandline, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">--</span><span class="nb">open</span><span class="o">-</span><span class="n">files</span>
</pre></div>
</div>
<p>To use it from Python, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">astropy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">open_files</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">pytest-openfiles</span></code> plugin see
<a class="reference internal" href="#openfiles-plugin"><span class="std std-ref">pytest-openfiles</span></a></p>
</div>
<div class="section" id="test-coverage-reports">
<h4>Test coverage reports<a class="headerlink" href="#test-coverage-reports" title="Permalink to this headline">¶</a></h4>
<p>Coverage reports can be generated using the <a class="reference external" href="https://pypi.org/project/pytest-cov/">pytest-cov</a> plugin (which is installed
automatically when installing pytest-astropy) by using e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">--</span><span class="n">cov</span> <span class="n">astropy</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span> <span class="n">html</span>
</pre></div>
</div>
<p>There is some configuration inside the <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file that
defines files to omit as well as lines to exclude.</p>
</div>
<div class="section" id="running-tests-in-parallel">
<h4>Running tests in parallel<a class="headerlink" href="#running-tests-in-parallel" title="Permalink to this headline">¶</a></h4>
<p>It is possible to speed up astropy’s tests using the <a class="reference external" href="https://pypi.org/project/pytest-xdist">pytest-xdist</a> plugin.</p>
<p>Once installed, tests can be run in parallel using the <code class="docutils literal notranslate"><span class="pre">'-n'</span></code>
commandline option. For example, to use 4 processes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Pass <code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">auto</span></code> to create the same number of processes as cores
on your machine.</p>
<p>Similarly, this feature can be invoked from <code class="docutils literal notranslate"><span class="pre">astropy.test</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">astropy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="writing-tests">
<span id="id5"></span><h2>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> has the following test discovery rules:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test_*.py</span></code> or <code class="docutils literal notranslate"><span class="pre">*_test.py</span></code> files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Test</span></code> prefixed classes (without an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_</span></code> prefixed functions and methods</p></li>
</ul>
</div></blockquote>
<p>Consult the <a class="reference external" href="https://docs.pytest.org/en/stable/explanation/goodpractices.html#python-test-discovery" title="(in pytest v7.1.2)"><span class="xref std std-ref">test discovery rules</span></a>
for detailed information on how to name files and tests so that they are
automatically discovered by <a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a>.</p>
<div class="section" id="simple-example">
<h3>Simple example<a class="headerlink" href="#simple-example" title="Permalink to this headline">¶</a></h3>
<p>The following example shows a simple function and a test to test this
function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add one to the argument.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">test_answer</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check the return value of func() for an example argument.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
<p>If we place this in a <code class="docutils literal notranslate"><span class="pre">test.py</span></code> file and then run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The result is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=============================</span> <span class="n">test</span> <span class="n">session</span> <span class="n">starts</span> <span class="o">==============================</span>
<span class="n">python</span><span class="p">:</span> <span class="n">platform</span> <span class="n">darwin</span> <span class="o">--</span> <span class="n">Python</span> <span class="mf">3.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="o">--</span> <span class="n">pytest</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span>
<span class="n">test</span> <span class="nb">object</span> <span class="mi">1</span><span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">py</span>

<span class="n">test</span><span class="o">.</span><span class="n">py</span> <span class="n">F</span>

<span class="o">===================================</span> <span class="n">FAILURES</span> <span class="o">===================================</span>
<span class="n">_________________________________</span> <span class="n">test_answer</span> <span class="n">__________________________________</span>

    <span class="k">def</span> <span class="nf">test_answer</span><span class="p">():</span>
<span class="o">&gt;</span>       <span class="k">assert</span> <span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
<span class="n">E</span>       <span class="k">assert</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">5</span>
<span class="n">E</span>        <span class="o">+</span>  <span class="n">where</span> <span class="mi">4</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span> <span class="ne">AssertionError</span>
<span class="o">===========================</span> <span class="mi">1</span> <span class="n">failed</span> <span class="ow">in</span> <span class="mf">0.07</span> <span class="n">seconds</span> <span class="o">===========================</span>
</pre></div>
</div>
</div>
<div class="section" id="where-to-put-tests">
<h3>Where to put tests<a class="headerlink" href="#where-to-put-tests" title="Permalink to this headline">¶</a></h3>
<div class="section" id="package-specific-tests">
<h4>Package-specific tests<a class="headerlink" href="#package-specific-tests" title="Permalink to this headline">¶</a></h4>
<p>Each package should include a suite of unit tests, covering as many of
the public methods/functions as possible. These tests should be
included inside each sub-package, e.g:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">astropy</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">fits</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tests</span></code> directories should contain an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file so that
the tests can be imported and so that they can use relative imports.</p>
</div>
<div class="section" id="interoperability-tests">
<h4>Interoperability tests<a class="headerlink" href="#interoperability-tests" title="Permalink to this headline">¶</a></h4>
<p>Tests involving two or more sub-packages should be included in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">astropy</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="regression-tests">
<h3>Regression tests<a class="headerlink" href="#regression-tests" title="Permalink to this headline">¶</a></h3>
<p>Any time a bug is fixed, and wherever possible, one or more regression tests
should be added to ensure that the bug is not introduced in future. Regression
tests should include the ticket URL where the bug was reported.</p>
</div>
<div class="section" id="working-with-data-files">
<span id="data-files"></span><h3>Working with data files<a class="headerlink" href="#working-with-data-files" title="Permalink to this headline">¶</a></h3>
<p>Tests that need to make use of a data file should use the
<a class="reference internal" href="../api/astropy.utils.data.get_pkg_data_fileobj.html#astropy.utils.data.get_pkg_data_fileobj" title="astropy.utils.data.get_pkg_data_fileobj"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_pkg_data_fileobj</span></code></a> or
<a class="reference internal" href="../api/astropy.utils.data.get_pkg_data_filename.html#astropy.utils.data.get_pkg_data_filename" title="astropy.utils.data.get_pkg_data_filename"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_pkg_data_filename</span></code></a> functions.  These functions
search locally first, and then on the astropy data server or an arbitrary
URL, and return a file-like object or a local filename, respectively.  They
automatically cache the data locally if remote data is obtained, and from
then on the local copy will be used transparently.  See the next section for
note specific to dealing with the cache in tests.</p>
<p>They also support the use of an MD5 hash to get a specific version of a data
file.  This hash can be obtained prior to submitting a file to the astropy
data server by using the <a class="reference internal" href="../api/astropy.utils.data.compute_hash.html#astropy.utils.data.compute_hash" title="astropy.utils.data.compute_hash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_hash</span></code></a> function on a
local copy of the file.</p>
<p>Tests that may retrieve remote data should be marked with the
<code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.remote_data</span></code> decorator, or, if a doctest, flagged with the
<code class="docutils literal notranslate"><span class="pre">REMOTE_DATA</span></code> flag.  Tests marked in this way will be skipped by default by
<code class="docutils literal notranslate"><span class="pre">astropy.test()</span></code> to prevent test runs from taking too long. These tests can
be run by <code class="docutils literal notranslate"><span class="pre">astropy.test()</span></code> by adding the <code class="docutils literal notranslate"><span class="pre">remote_data='any'</span></code> flag.  Turn on
the remote data tests at the command line with <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--remote-data=any</span></code>.</p>
<p>It is possible to mark tests using
<code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.remote_data(source='astropy')</span></code>, which can be used to indicate
that the only required data is from the <a class="reference external" href="http://data.astropy.org">http://data.astropy.org</a> server. To
enable just these tests, you can run the
tests with <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--remote-data=astropy</span></code>.</p>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">pytest-remotedata</span></code> plugin, see
<a class="reference internal" href="#remotedata-plugin"><span class="std std-ref">pytest-remotedata</span></a>.</p>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">...config</span> <span class="kn">import</span> <span class="n">get_data_filename</span>

<span class="k">def</span> <span class="nf">test_1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test version using a local file.&quot;&quot;&quot;</span>
    <span class="c1">#if filename.fits is a local file in the source distribution</span>
    <span class="n">datafile</span> <span class="o">=</span> <span class="n">get_data_filename</span><span class="p">(</span><span class="s1">&#39;filename.fits&#39;</span><span class="p">)</span>
    <span class="c1"># do the test</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">remote_data</span>
<span class="k">def</span> <span class="nf">test_2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test version using a remote file.&quot;&quot;&quot;</span>
    <span class="c1">#this is the hash for a particular version of a file stored on the</span>
    <span class="c1">#astropy data server.</span>
    <span class="n">datafile</span> <span class="o">=</span> <span class="n">get_data_filename</span><span class="p">(</span><span class="s1">&#39;hash/94935ac31d585f68041c08f87d1a19d4&#39;</span><span class="p">)</span>
    <span class="c1"># do the test</span>

<span class="k">def</span> <span class="nf">doctest_example</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; datafile = get_data_filename(&#39;hash/94935&#39;)  # doctest: +REMOTE_DATA</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_remote_test_data</span></code> will place the files in a temporary directory
indicated by the <code class="docutils literal notranslate"><span class="pre">tempfile</span></code> module, so that the test files will eventually
get removed by the system. In the long term, once test data files become too
large, we will need to design a mechanism for removing test data immediately.</p>
</div>
<div class="section" id="tests-that-use-the-file-cache">
<h4>Tests that use the file cache<a class="headerlink" href="#tests-that-use-the-file-cache" title="Permalink to this headline">¶</a></h4>
<p>By default, the Astropy test runner sets up a clean file cache in a temporary
directory that is used only for that test run and then destroyed.  This is to
ensure consistency between test runs, as well as to not clutter users’ caches
(i.e. the cache directory returned by <a class="reference internal" href="../api/astropy.config.get_cache_dir.html#astropy.config.get_cache_dir" title="astropy.config.get_cache_dir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_cache_dir</span></code></a>) with
test files.</p>
<p>However, some test authors (especially for affiliated packages) may find it
desirable to cache files downloaded during a test run in a more permanent
location (e.g. for large data sets).  To this end the
<a class="reference internal" href="../api/astropy.config.set_temp_cache.html#astropy.config.set_temp_cache" title="astropy.config.set_temp_cache"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_temp_cache</span></code></a> helper may be used.  It can be used either as
a context manager within a test to temporarily set the cache to a custom
location, or as a <em>decorator</em> that takes effect for an entire test function
(not including setup or teardown, which would have to be decorated separately).</p>
<p>Furthermore, it is possible to change the location of the cache directory
for the duration of the test run by setting the <code class="docutils literal notranslate"><span class="pre">XDG_CACHE_HOME</span></code>
environment variable.</p>
</div>
</div>
<div class="section" id="tests-that-create-files">
<h3>Tests that create files<a class="headerlink" href="#tests-that-create-files" title="Permalink to this headline">¶</a></h3>
<p>Tests may often be run from directories where users do not have write
permissions so tests which create files should always do so in
temporary directories. This can be done with the
<a class="reference external" href="https://docs.pytest.org/en/stable/how-to/tmp_path.html#tmpdir" title="(in pytest v7.1.2)"><span class="xref std std-ref">pytest ‘tmpdir’ fixture</span></a> or with
Python’s built-in <a class="reference external" href="https://docs.python.org/3/library/tempfile.html#tempfile-examples" title="(in Python v3.10)"><span class="xref std std-ref">tempfile module</span></a>.</p>
</div>
<div class="section" id="setting-up-tearing-down-tests">
<h3>Setting up/Tearing down tests<a class="headerlink" href="#setting-up-tearing-down-tests" title="Permalink to this headline">¶</a></h3>
<p>In some cases, it can be useful to run a series of tests requiring something
to be set up first. There are four ways to do this:</p>
<div class="section" id="module-level-setup-teardown">
<h4>Module-level setup/teardown<a class="headerlink" href="#module-level-setup-teardown" title="Permalink to this headline">¶</a></h4>
<p>If the <code class="docutils literal notranslate"><span class="pre">setup_module</span></code> and <code class="docutils literal notranslate"><span class="pre">teardown_module</span></code> functions are specified in a
file, they are called before and after all the tests in the file respectively.
These functions take one argument, which is the module itself, which makes it
very easy to set module-wide variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup_module</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize the value of NUM.&quot;&quot;&quot;</span>
    <span class="n">module</span><span class="o">.</span><span class="n">NUM</span> <span class="o">=</span> <span class="mi">11</span>

<span class="k">def</span> <span class="nf">add_num</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add pre-defined NUM to the argument.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">NUM</span>

<span class="k">def</span> <span class="nf">test_42</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Ensure that add_num() adds the correct NUM to its argument.&quot;&quot;&quot;</span>
    <span class="n">added</span> <span class="o">=</span> <span class="n">add_num</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">added</span> <span class="o">==</span> <span class="mi">53</span>
</pre></div>
</div>
<p>We can use this for example to download a remote test data file and have all
the functions in the file access it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">setup_module</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store a copy of the remote test file.&quot;&quot;&quot;</span>
    <span class="n">module</span><span class="o">.</span><span class="n">DATAFILE</span> <span class="o">=</span> <span class="n">get_remote_test_data</span><span class="p">(</span><span class="s1">&#39;94935ac31d585f68041c08f87d1a19d4&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Perform test using cached remote input file.&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DATAFILE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="c1"># do the test</span>

<span class="k">def</span> <span class="nf">teardown_module</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clean up remote test file copy.&quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">DATAFILE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="class-level-setup-teardown">
<h4>Class-level setup/teardown<a class="headerlink" href="#class-level-setup-teardown" title="Permalink to this headline">¶</a></h4>
<p>Tests can be organized into classes that have their own setup/teardown
functions. In the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_nums</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add two numbers.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">class</span> <span class="nc">TestAdd42</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test for add_nums with y=42.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NUM</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test behavior for a specific input value.&quot;&quot;&quot;</span>
        <span class="n">added</span> <span class="o">=</span> <span class="n">add_nums</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">added</span> <span class="o">==</span> <span class="mi">53</span>

    <span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test behavior for another input value.&quot;&quot;&quot;</span>
        <span class="n">added</span> <span class="o">=</span> <span class="n">add_nums</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">added</span> <span class="o">==</span> <span class="mi">55</span>

    <span class="k">def</span> <span class="nf">teardown_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>In the above example, the <code class="docutils literal notranslate"><span class="pre">setup_class</span></code> method is called first, then all the
tests in the class, and finally the <code class="docutils literal notranslate"><span class="pre">teardown_class</span></code> is called.</p>
</div>
<div class="section" id="method-level-setup-teardown">
<h4>Method-level setup/teardown<a class="headerlink" href="#method-level-setup-teardown" title="Permalink to this headline">¶</a></h4>
<p>There are cases where one might want setup and teardown methods to be run
before and after <em>each</em> test. For this, use the <code class="docutils literal notranslate"><span class="pre">setup_method</span></code> and
<code class="docutils literal notranslate"><span class="pre">teardown_method</span></code> methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_nums</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add two numbers.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">class</span> <span class="nc">TestAdd42</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test for add_nums with y=42.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NUM</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test behavior for a specific input value.&quot;&quot;&quot;</span>
        <span class="n">added</span> <span class="o">=</span> <span class="n">add_nums</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">added</span> <span class="o">==</span> <span class="mi">53</span>

    <span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test behavior for another input value.&quot;&quot;&quot;</span>
        <span class="n">added</span> <span class="o">=</span> <span class="n">add_nums</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">added</span> <span class="o">==</span> <span class="mi">55</span>

    <span class="k">def</span> <span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="function-level-setup-teardown">
<h4>Function-level setup/teardown<a class="headerlink" href="#function-level-setup-teardown" title="Permalink to this headline">¶</a></h4>
<p>Finally, one can use <code class="docutils literal notranslate"><span class="pre">setup_function</span></code> and <code class="docutils literal notranslate"><span class="pre">teardown_function</span></code> to define a
setup/teardown mechanism to be run before and after each function in a module.
These take one argument, which is the function being tested:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup_function</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;First test.&quot;&quot;&quot;</span>
    <span class="c1"># do test</span>

<span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Second test.&quot;&quot;&quot;</span>
    <span class="c1"># do test</span>

<span class="k">def</span> <span class="nf">teardown_function</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="property-based-tests">
<h3>Property-based tests<a class="headerlink" href="#property-based-tests" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://increment.com/testing/in-praise-of-property-based-testing/">Property-based testing</a>
lets you focus on the parts of your test that matter, by making more
general claims - “works for any two numbers” instead of “works for 1 + 2”.
Imagine if random testing gave you minimal, non-flaky failing examples,
and a clean way to describe even the most complicated data - that’s
property-based testing!</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-astropy</span></code> includes a dependency on <a class="reference external" href="https://hypothesis.readthedocs.io/">Hypothesis</a>, so installation is easy -
you can just read the docs or <a class="reference external" href="https://github.com/Zac-HD/escape-from-automanual-testing/">work through the tutorial</a>
and start writing tests like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="nd">@given</span><span class="p">(</span>
    <span class="n">st</span><span class="o">.</span><span class="n">builds</span><span class="p">(</span><span class="n">SkyCoord</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">),</span> <span class="n">dec</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_coordinate_transform</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test that sky coord can be translated from ICRS to Galactic and back.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">coord</span> <span class="o">==</span> <span class="n">coord</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">icrs</span>  <span class="c1"># floating-point precision alert!</span>
</pre></div>
</div>
<p>Other properties that you could test include:</p>
<ul class="simple">
<li><p>Round-tripping from image to sky coordinates and back should be lossless
for distortion-free mappings, and otherwise always below 10^-5 px.</p></li>
<li><p>Take a moment in time, round-trip it through various frames, and check it
hasn’t changed or lost precision. (or at least not by more than a nanosecond)</p></li>
<li><p>IO routines losslessly round-trip data that they are expected to handle</p></li>
<li><p>Optimised routines calculate the same result as unoptimised, within tolerances</p></li>
</ul>
<p>This is a great way to start contributing to Astropy, and has already found
bugs in time handling.  See issue #9017 and pull request #9532 for details!</p>
<p>(and if you find Hypothesis useful in your research,
<a class="reference external" href="https://doi.org/10.21105/joss.01891">please cite it</a>!)</p>
</div>
<div class="section" id="parametrizing-tests">
<h3>Parametrizing tests<a class="headerlink" href="#parametrizing-tests" title="Permalink to this headline">¶</a></h3>
<p>If you want to run a test several times for slightly different values,
you can use <code class="docutils literal notranslate"><span class="pre">pytest</span></code> to avoid writing separate tests.
For example, instead of writing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test1</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span>

<span class="k">def</span> <span class="nf">test2</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span>

<span class="k">def</span> <span class="nf">test3</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> decorator to concisely
create a test function for each input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">((</span><span class="s1">&#39;letter&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">letter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that the input is a string.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span>
</pre></div>
</div>
<p>As a guideline, use <code class="docutils literal notranslate"><span class="pre">parametrize</span></code> if you can enumerate all possible
test cases and each failure would be a distinct issue, and Hypothesis
when there are many possible inputs or you only want a single simple
failure to be reported.</p>
</div>
<div class="section" id="tests-requiring-optional-dependencies">
<h3>Tests requiring optional dependencies<a class="headerlink" href="#tests-requiring-optional-dependencies" title="Permalink to this headline">¶</a></h3>
<p>For tests that test functions or methods that require optional dependencies
(e.g., Scipy), pytest should be instructed to skip the test if the dependencies
are not present, as the <code class="docutils literal notranslate"><span class="pre">astropy</span></code> tests should succeed even if an optional
dependency is not present. <code class="docutils literal notranslate"><span class="pre">astropy</span></code> provides a list of boolean flags that
test whether optional dependencies are installed (at import time). For example,
to load the corresponding flag for Scipy and mark a test to skip if Scipy is not
present, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">astropy.utils.compat.optional_deps</span> <span class="kn">import</span> <span class="n">HAS_SCIPY</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">HAS_SCIPY</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;scipy is required&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_that_uses_scipy</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>These variables should exist for all of Astropy’s optional dependencies; a
complete list of supported flags can be found in
<code class="docutils literal notranslate"><span class="pre">astropy.utils.compat.optional_deps</span></code>.</p>
<p>Any new optional dependencies should be added to that file, as well as to
relevant entries in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> under <code class="docutils literal notranslate"><span class="pre">options.extras_require</span></code>:
typically, under <code class="docutils literal notranslate"><span class="pre">all</span></code> for dependencies used in user-facing code
(e.g., <code class="docutils literal notranslate"><span class="pre">h5py</span></code>, which is used to write tables to HDF5 format),
and in <code class="docutils literal notranslate"><span class="pre">test_all</span></code> for dependencies only used in tests (e.g.,
<code class="docutils literal notranslate"><span class="pre">skyfield</span></code>, which is used to cross-check the accuracy of coordinate
transforms).</p>
</div>
<div class="section" id="using-pytest-helper-functions">
<h3>Using pytest helper functions<a class="headerlink" href="#using-pytest-helper-functions" title="Permalink to this headline">¶</a></h3>
<p>If your tests need to use <a class="reference external" href="https://docs.pytest.org/en/latest/reference/reference.html#functions">pytest helper functions</a>, such as
<code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code>, import <code class="docutils literal notranslate"><span class="pre">pytest</span></code> into your test module like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-warnings">
<h3>Testing warnings<a class="headerlink" href="#testing-warnings" title="Permalink to this headline">¶</a></h3>
<p>In order to test that warnings are triggered as expected in certain
situations,
<a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a> provides its own context manager
<a class="reference external" href="https://docs.pytest.org/en/stable/how-to/capture-warnings.html#warns" title="(in pytest v7.1.2)"><span class="xref std std-ref">pytest.warns</span></a> that, completely
analogously to <code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code> (see below) allows to probe explicitly
for specific warning classes and, through the optional <code class="docutils literal notranslate"><span class="pre">match</span></code> argument,
messages. Note that when no warning of the specified type is
triggered, this will make the test fail. When checking for optional,
but not mandatory warnings, <code class="docutils literal notranslate"><span class="pre">pytest.warns()</span></code> can be used to catch and
inspect them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With <a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a> there is also the option of using the
<a class="reference external" href="https://docs.pytest.org/en/stable/how-to/capture-warnings.html#recwarn" title="(in pytest v7.1.2)"><span class="xref std std-ref">recwarn</span></a> function argument to test that
warnings are triggered within the entire embedding function.
This method has been found to be problematic in at least one case
(<a class="reference external" href="https://github.com/astropy/astropy/pull/1174#issuecomment-20249309">pull request 1174</a>).</p>
</div>
</div>
<div class="section" id="testing-exceptions">
<h3>Testing exceptions<a class="headerlink" href="#testing-exceptions" title="Permalink to this headline">¶</a></h3>
<p>Just like the handling of warnings described above, tests that are
designed to trigger certain errors should verify that an exception of
the expected type is raised in the expected place.  This is efficiently
done by running the tested code inside the
<a class="reference external" href="https://docs.pytest.org/en/stable/how-to/assert.html#assertraises" title="(in pytest v7.1.2)"><span class="xref std std-ref">pytest.raises</span></a>
context manager.  Its optional <code class="docutils literal notranslate"><span class="pre">match</span></code> argument allows to check the
error message for any patterns using <code class="docutils literal notranslate"><span class="pre">regex</span></code> syntax.  For example the
matches <code class="docutils literal notranslate"><span class="pre">pytest.raises(OSError,</span> <span class="pre">match=r'^No</span> <span class="pre">such</span> <span class="pre">file')</span></code> and
<code class="docutils literal notranslate"><span class="pre">pytest.raises(OSError,</span> <span class="pre">match=r'or</span> <span class="pre">directory$')</span></code> would be equivalent
to <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">str(err).startswith(No</span> <span class="pre">such</span> <span class="pre">file)</span></code> and <code class="docutils literal notranslate"><span class="pre">assert</span>
<span class="pre">str(err).endswith(or</span> <span class="pre">directory)</span></code>, respectively, on the raised error
message <code class="docutils literal notranslate"><span class="pre">err</span></code>.
For matching multi-line messages you need to pass the <code class="docutils literal notranslate"><span class="pre">(?s)</span></code>
<a class="reference external" href="https://docs.python.org/3/library/re.html#re-syntax" title="(in Python v3.10)"><span class="xref std std-ref">flag</span></a>
to the underlying <code class="docutils literal notranslate"><span class="pre">re.search</span></code>, as in the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">VerifyError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(?s)not upper.+ Illegal key&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">excinfo</span><span class="p">:</span>
    <span class="n">hdu</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;fix+exception&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">excinfo</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;Card&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</div>
<p>This invocation also illustrates how to get an <code class="docutils literal notranslate"><span class="pre">ExceptionInfo</span></code> object
returned to perform additional diagnostics on the info.</p>
</div>
<div class="section" id="testing-configuration-parameters">
<h3>Testing configuration parameters<a class="headerlink" href="#testing-configuration-parameters" title="Permalink to this headline">¶</a></h3>
<p>In order to ensure reproducibility of tests, all configuration items
are reset to their default values when the test runner starts up.</p>
<p>Sometimes you’ll want to test the behavior of code when a certain
configuration item is set to a particular value.  In that case, you
can use the <a class="reference internal" href="../api/astropy.config.ConfigItem.html#astropy.config.ConfigItem.set_temp" title="astropy.config.ConfigItem.set_temp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.config.ConfigItem.set_temp</span></code></a> context manager to
temporarily set a configuration item to that value, test within that
context, and have it automatically return to its original value.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_pprint</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">conf</span>
    <span class="k">with</span> <span class="n">conf</span><span class="o">.</span><span class="n">set_temp</span><span class="p">(</span><span class="s1">&#39;max_lines&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="marking-blocks-of-code-to-exclude-from-coverage">
<h3>Marking blocks of code to exclude from coverage<a class="headerlink" href="#marking-blocks-of-code-to-exclude-from-coverage" title="Permalink to this headline">¶</a></h3>
<p>Blocks of code may be ignored by the coverage testing by adding a
comment containing the phrase <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">cover</span></code> to the start of the
block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">this_rarely_happens</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="n">this_call_is_ignored</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="image-tests-with-pytest-mpl">
<span id="image-tests"></span><h3>Image tests with pytest-mpl<a class="headerlink" href="#image-tests-with-pytest-mpl" title="Permalink to this headline">¶</a></h3>
<div class="section" id="running-image-tests">
<h4>Running image tests<a class="headerlink" href="#running-image-tests" title="Permalink to this headline">¶</a></h4>
<p>We make use of the <a class="reference external" href="https://pypi.org/project/pytest-mpl">pytest-mpl</a>
plugin to write tests where we can compare the output of plotting commands
with reference files on a pixel-by-pixel basis (this is used for instance in
<a class="reference internal" href="../visualization/wcsaxes/index.html#wcsaxes"><span class="std std-ref">astropy.visualization.wcsaxes</span></a>).</p>
<p>To run the Astropy tests with the image comparison, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">--</span><span class="n">mpl</span> <span class="o">--</span><span class="n">remote</span><span class="o">-</span><span class="n">data</span><span class="o">=</span><span class="n">astropy</span>
</pre></div>
</div>
<p>However, note that the output can be very sensitive to the version of Matplotlib
as well as all its dependencies (e.g., freetype), so we recommend running the
image tests inside a <a class="reference external" href="https://www.docker.com/">Docker</a> container which has a
frozen set of package versions (Docker containers can be thought of as mini
virtual machines). See our <code class="docutils literal notranslate"><span class="pre">.circleci/config.yml</span></code> for reference.</p>
</div>
<div class="section" id="writing-image-tests">
<h4>Writing image tests<a class="headerlink" href="#writing-image-tests" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="https://github.com/matplotlib/pytest-mpl/blob/master/README.rst">README.rst</a>
for the plugin contains information on writing tests with this plugin. The only
key addition compared to those instructions is that you should set
<code class="docutils literal notranslate"><span class="pre">baseline_dir</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.tests.image_tests</span> <span class="kn">import</span> <span class="n">IMAGE_REFERENCE_DIR</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">mpl_image_compare</span><span class="p">(</span><span class="n">baseline_dir</span><span class="o">=</span><span class="n">IMAGE_REFERENCE_DIR</span><span class="p">)</span>
</pre></div>
</div>
<p>This is because since the reference image files would contribute significantly
to the repository size, we instead store them on the <a class="reference external" href="http://data.astropy.org">http://data.astropy.org</a>
site. The downside is that it is a little more complicated to create or
re-generate reference files, but we describe the process here.</p>
</div>
<div class="section" id="generating-reference-images">
<h4>Generating reference images<a class="headerlink" href="#generating-reference-images" title="Permalink to this headline">¶</a></h4>
<p>Any failed test on CircleCI would provide you with the old and the new reference
images, along with the difference image. After you have determined that the
new reference image is acceptable, you could download it from the “artifacts”
tab on the CircleCI dashboard.</p>
</div>
<div class="section" id="uploading-the-reference-images">
<h4>Uploading the reference images<a class="headerlink" href="#uploading-the-reference-images" title="Permalink to this headline">¶</a></h4>
<p>Next, we need to add these images to the <a class="reference external" href="http://data.astropy.org">http://data.astropy.org</a> server. To do
this, open a pull request to <a class="reference external" href="https://github.com/astropy/astropy-data">this</a>
repository. The reference images for Astropy tests should go inside the
<a class="reference external" href="https://github.com/astropy/astropy-data/tree/gh-pages/testing/astropy">testing/astropy</a>
directory. In that directory are folders named as timestamps. If you are simply
adding new tests, add the reference files to the most recent directory.</p>
<p>If you are re-generating baseline images due to changes in Astropy, make a new
timestamp directory by copying one the most recent one, then replace any
baseline images that have changed. Note that due to changes between Matplotlib
versions, we need to add the whole set of reference images for each major
Matplotlib version. Therefore, in each timestamp folder, there are folders named
e.g. <code class="docutils literal notranslate"><span class="pre">1.4.x</span></code> and <code class="docutils literal notranslate"><span class="pre">1.5.x</span></code>.</p>
<p>Once the reference images are merged in and available on
<a class="reference external" href="http://data.astropy.org">http://data.astropy.org</a>, update the timestamp in the <code class="docutils literal notranslate"><span class="pre">IMAGE_REFERENCE_DIR</span></code>
variable in the <code class="docutils literal notranslate"><span class="pre">astropy.tests.image_tests</span></code> sub-module. Because the timestamp
is hard-coded, adding a new timestamp directory will not mess with testing for
released versions of Astropy, so you can easily add and tweak a new timestamp
directory while still working on a pull request to Astropy.</p>
</div>
</div>
</div>
<div class="section" id="writing-doctests">
<span id="doctests"></span><h2>Writing doctests<a class="headerlink" href="#writing-doctests" title="Permalink to this headline">¶</a></h2>
<p>A doctest in Python is a special kind of test that is embedded in a
function, class, or module’s docstring, or in the narrative Sphinx
documentation, and is formatted to look like a Python interactive
session–that is, they show lines of Python code entered at a <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>
prompt followed by the output that would be expected (if any) when
running that code in an interactive session.</p>
<p>The idea is to write usage examples in docstrings that users can enter
verbatim and check their output against the expected output to confirm that
they are using the interface properly.</p>
<p>Furthermore, Python includes a <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> module that can detect these
doctests and execute them as part of a project’s automated test suite.  This
way we can automatically ensure that all doctest-like examples in our
docstrings are correct.</p>
<p>The Astropy test suite automatically detects and runs any doctests in the
astropy source code or documentation, or in packages using the Astropy test
running framework. For example doctests and detailed documentation on how to
write them, see the full <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> documentation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the narrative Sphinx documentation is not installed alongside the
astropy source code, it can only be tested by running <code class="docutils literal notranslate"><span class="pre">pytest</span></code> directly (or
via tox), not by <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">astropy;</span> <span class="pre">astropy.test()</span></code>.</p>
</div>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">pytest-doctestplus</span></code> plugin used by Astropy, see
<a class="reference internal" href="#doctestplus-plugin"><span class="std std-ref">pytest-doctestplus</span></a>.</p>
<div class="section" id="skipping-doctests">
<span id="id6"></span><h3>Skipping doctests<a class="headerlink" href="#skipping-doctests" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is necessary to write examples that look like doctests but that
are not actually executable verbatim. An example may depend on some external
conditions being fulfilled, for example. In these cases there are a few ways to
skip a doctest:</p>
<ol class="arabic">
<li><p>Next to the example add a comment like: <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">doctest:</span> <span class="pre">+SKIP</span></code>.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import os
&gt;&gt;&gt; os.listdir(&#39;.&#39;)  # doctest: +SKIP
</pre></div>
</div>
<p>In the above example we want to direct the user to run <code class="docutils literal notranslate"><span class="pre">os.listdir('.')</span></code>
but we don’t want that line to be executed as part of the doctest.</p>
<p>To skip tests that require fetching remote data, use the <code class="docutils literal notranslate"><span class="pre">REMOTE_DATA</span></code>
flag instead.  This way they can be turned on using the
<code class="docutils literal notranslate"><span class="pre">--remote-data</span></code> flag when running the tests:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; datafile = get_data_filename(&#39;hash/94935&#39;)  # doctest: +REMOTE_DATA
</pre></div>
</div>
</li>
<li><p>Astropy’s test framework adds support for a special <code class="docutils literal notranslate"><span class="pre">__doctest_skip__</span></code>
variable that can be placed at the module level of any module to list
functions, classes, and methods in that module whose doctests should not
be run.  That is, if it doesn’t make sense to run a function’s example
usage as a doctest, the entire function can be skipped in the doctest
collection phase.</p>
<p>The value of <code class="docutils literal notranslate"><span class="pre">__doctest_skip__</span></code> should be a list of wildcard patterns
for all functions/classes whose doctests should be skipped.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__doctest_skip__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;myfunction&#39;</span><span class="p">,</span> <span class="s1">&#39;MyClass&#39;</span><span class="p">,</span> <span class="s1">&#39;MyClass.*&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>skips the doctests in a function called <code class="docutils literal notranslate"><span class="pre">myfunction</span></code>, the doctest for a
class called <code class="docutils literal notranslate"><span class="pre">MyClass</span></code>, and all <em>methods</em> of <code class="docutils literal notranslate"><span class="pre">MyClass</span></code>.</p>
<p>Module docstrings may contain doctests as well.  To skip the module-level
doctests include the string <code class="docutils literal notranslate"><span class="pre">'.'</span></code> in <code class="docutils literal notranslate"><span class="pre">__doctest_skip__</span></code>.</p>
<p>To skip all doctests in a module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__doctest_skip__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>In the Sphinx documentation, a doctest section can be skipped by
making it part of a <code class="docutils literal notranslate"><span class="pre">doctest-skip</span></code> directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">doctest</span><span class="o">-</span><span class="n">skip</span><span class="p">::</span>

    <span class="o">&gt;&gt;&gt;</span> <span class="c1"># This is a doctest that will appear in the documentation,</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="c1"># but will not be executed by the testing framework.</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>  <span class="c1"># Divide by zero, ouch!</span>
</pre></div>
</div>
<p>It is also possible to skip all doctests below a certain line using
a <code class="docutils literal notranslate"><span class="pre">doctest-skip-all</span></code> comment.  Note the lack of <code class="docutils literal notranslate"><span class="pre">::</span></code> at the end
of the line here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">doctest</span><span class="o">-</span><span class="n">skip</span><span class="o">-</span><span class="nb">all</span>

<span class="n">All</span> <span class="n">doctests</span> <span class="n">below</span> <span class="n">here</span> <span class="n">are</span> <span class="n">skipped</span><span class="o">...</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">__doctest_requires__</span></code> is a way to list dependencies for specific
doctests.  It should be a dictionary mapping wildcard patterns (in the same
format as <code class="docutils literal notranslate"><span class="pre">__doctest_skip__</span></code>) to a list of one or more modules that should
be <em>importable</em> in order for the tests to run.  For example, if some tests
require the scipy module to work they will be skipped unless <code class="docutils literal notranslate"><span class="pre">import</span>
<span class="pre">scipy</span></code> is possible.  It is also possible to use a tuple of wildcard
patterns as a key in this dict:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__doctest_requires__</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;func1&#39;</span><span class="p">,</span> <span class="s1">&#39;func2&#39;</span><span class="p">):</span> <span class="p">[</span><span class="s1">&#39;scipy&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<p>Having this module-level variable will require <code class="docutils literal notranslate"><span class="pre">scipy</span></code> to be importable
in order to run the doctests for functions <code class="docutils literal notranslate"><span class="pre">func1</span></code> and <code class="docutils literal notranslate"><span class="pre">func2</span></code> in that
module.</p>
<p>In the Sphinx documentation, a doctest requirement can be notated with the
<code class="docutils literal notranslate"><span class="pre">doctest-requires</span></code> directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">doctest</span><span class="o">-</span><span class="n">requires</span><span class="p">::</span> <span class="n">scipy</span>

    <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">scipy</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">scipy</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="skipping-output">
<h3>Skipping output<a class="headerlink" href="#skipping-output" title="Permalink to this headline">¶</a></h3>
<p>One of the important aspects of writing doctests is that the example output
can be accurately compared to the actual output produced when running the
test.</p>
<p>The doctest system compares the actual output to the example output verbatim
by default, but this not always feasible.  For example the example output may
contain the <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> of an object which displays its id (which will change
on each run), or a test that expects an exception may output a traceback.</p>
<p>The simplest way to generalize the example output is to use the ellipses
<code class="docutils literal notranslate"><span class="pre">...</span></code>.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ZeroDivisionError</span>: <span class="n">integer division or modulo by zero</span>
</pre></div>
</div>
<p>This doctest expects an exception with a traceback, but the text of the
traceback is skipped in the example output–only the first and last lines
of the output are checked.  See the <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> documentation for
more examples of skipping output.</p>
<div class="section" id="ignoring-all-output">
<h4>Ignoring all output<a class="headerlink" href="#ignoring-all-output" title="Permalink to this headline">¶</a></h4>
<p>Another possibility for ignoring output is to use the
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">doctest:</span> <span class="pre">+IGNORE_OUTPUT</span></code> flag.  This allows a doctest to execute (and
check that the code executes without errors), but allows the entire output
to be ignored in cases where we don’t care what the output is.  This differs
from using ellipses in that we can still provide complete example output, just
without the test checking that it is exactly right.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello world&#39;</span><span class="p">)</span>  
<span class="go">We don&#39;t really care what the output is as long as there were no errors...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="handling-float-output">
<span id="id7"></span><h3>Handling float output<a class="headerlink" href="#handling-float-output" title="Permalink to this headline">¶</a></h3>
<p>Some doctests may produce output that contains string representations of
floating point values.  Floating point representations are often not exact and
contain roundoffs in their least significant digits.  Depending on the platform
the tests are being run on (different Python versions, different OS, etc.) the
exact number of digits shown can differ.  Because doctests work by comparing
strings this can cause such tests to fail.</p>
<p>To address this issue, the <code class="docutils literal notranslate"><span class="pre">pytest-doctestplus</span></code> plugin provides support for a
<code class="docutils literal notranslate"><span class="pre">FLOAT_CMP</span></code> flag that can be used with doctests.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; 1.0 / 3.0  # doctest: +FLOAT_CMP
0.333333333333333311
</pre></div>
</div>
<p>When this flag is used, the expected and actual outputs are both parsed to find
any floating point values in the strings.  Those are then converted to actual
Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> objects and compared numerically.  This means that small
differences in representation of roundoff digits will be ignored by the
doctest.  The values are otherwise compared exactly, so more significant
(albeit possibly small) differences will still be caught by these tests.</p>
</div>
</div>
<div class="section" id="continuous-integration">
<h2>Continuous integration<a class="headerlink" href="#continuous-integration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Astropy uses the following continuous integration (CI) services:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/astropy/astropy/actions">GitHub Actions</a> for
Linux, OS X, and Windows setups
(Note: GitHub Actions does not have “allowed failures” yet, so you might
see a fail job reported for your PR with “(Allowed Failure)” in its name.
Still, some failures might be real and related to your changes, so check
it anyway!)</p></li>
<li><p><a class="reference external" href="https://circleci.com">CircleCI</a> for visualization tests</p></li>
</ul>
<p>These continuously test the package for each commit and pull request that is
pushed to GitHub to notice when something breaks.</p>
<p>In some cases, you may see failures on continuous integration services that
you do not see locally, for example because the operating system is different,
or because the failure happens with only 32-bit Python.</p>
</div>
</div>
<div class="section" id="pytest-plugins">
<span id="id8"></span><h2>Pytest Plugins<a class="headerlink" href="#pytest-plugins" title="Permalink to this headline">¶</a></h2>
<p>The following <code class="docutils literal notranslate"><span class="pre">pytest</span></code> plugins are maintained and used by Astropy. They are
included as dependencies to the <code class="docutils literal notranslate"><span class="pre">pytest-astropy</span></code> package, which is now
required for testing Astropy. More information on all of the  plugins provided
by the <code class="docutils literal notranslate"><span class="pre">pytest-astropy</span></code> package (including dependencies not maintained by
Astropy) can be found <a class="reference external" href="https://github.com/astropy/pytest-astropy">here</a>.</p>
<div class="section" id="pytest-remotedata">
<span id="remotedata-plugin"></span><h3>pytest-remotedata<a class="headerlink" href="#pytest-remotedata" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/astropy/pytest-remotedata">pytest-remotedata</a> plugin allows developers to control whether to run
tests that access data from the internet. The plugin provides two decorators
that can be used to mark individual test functions or entire test classes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.remote_data</span></code> for tests that require data from the internet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.internet_off</span></code> for tests that should run only when there is no
internet access. This is useful for testing local data caches or fallbacks
for when no network access is available.</p></li>
</ul>
<p>The plugin also adds the <code class="docutils literal notranslate"><span class="pre">--remote-data</span></code> option to the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> command
(which is also made available through the Astropy test runner).</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">--remote-data</span></code> option is not provided when running the test suite, or
if <code class="docutils literal notranslate"><span class="pre">--remote-data=none</span></code> is provided, all tests that are marked with
<code class="docutils literal notranslate"><span class="pre">remote_data</span></code> will be skipped. All tests that are marked with
<code class="docutils literal notranslate"><span class="pre">internet_off</span></code> will be executed. Any test that attempts to access the
internet but is not marked with <code class="docutils literal notranslate"><span class="pre">remote_data</span></code> will result in a failure.</p>
<p>Providing either the <code class="docutils literal notranslate"><span class="pre">--remote-data</span></code> option, or <code class="docutils literal notranslate"><span class="pre">--remote-data=any</span></code>, will
cause all tests marked with <code class="docutils literal notranslate"><span class="pre">remote_data</span></code> to be executed. Any tests that are
marked with <code class="docutils literal notranslate"><span class="pre">internet_off</span></code> will be skipped.</p>
<p>Running the tests with <code class="docutils literal notranslate"><span class="pre">--remote-data=astropy</span></code> will cause only tests that
receive remote data from Astropy data sources to be run. Tests with any other
data sources will be skipped. This is indicated in the test code by marking
test functions with <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.remote_data(source='astropy')</span></code>. Tests
marked with <code class="docutils literal notranslate"><span class="pre">internet_off</span></code> will also be skipped in this case.</p>
<p>Also see <a class="reference internal" href="#data-files"><span class="std std-ref">Working with data files</span></a>.</p>
</div>
<div class="section" id="pytest-doctestplus">
<span id="doctestplus-plugin"></span><h3>pytest-doctestplus<a class="headerlink" href="#pytest-doctestplus" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/astropy/pytest-doctestplus">pytest-doctestplus</a> plugin provides advanced doctest features, including:</p>
<ul class="simple">
<li><p>handling doctests that use remote data in conjunction with the
<code class="docutils literal notranslate"><span class="pre">pytest-remotedata</span></code> plugin above (see <a class="reference internal" href="#data-files"><span class="std std-ref">Working with data files</span></a>)</p></li>
<li><p>approximate floating point comparison for doctests that produce floating
point results (see <a class="reference internal" href="#handling-float-output"><span class="std std-ref">Handling float output</span></a>)</p></li>
<li><p>skipping particular classes, methods, and functions when running doctests
(see <a class="reference internal" href="#skipping-doctests"><span class="std std-ref">Skipping doctests</span></a>)</p></li>
<li><p>optional inclusion of <code class="docutils literal notranslate"><span class="pre">*.rst</span></code> files for doctests</p></li>
</ul>
<p>This plugin provides two command line options: <code class="docutils literal notranslate"><span class="pre">--doctest-plus</span></code> for enabling
the advanced features mentioned above, and <code class="docutils literal notranslate"><span class="pre">--doctest-rst</span></code> for including
<code class="docutils literal notranslate"><span class="pre">*.rst</span></code> files in doctest collection.</p>
<p>The Astropy test runner enables both of these options by default. When running
the test suite directly from <code class="docutils literal notranslate"><span class="pre">pytest</span></code> (instead of through the Astropy test
runner), it is necessary to explicitly provide these options when they are
needed.</p>
</div>
<div class="section" id="pytest-openfiles">
<span id="openfiles-plugin"></span><h3>pytest-openfiles<a class="headerlink" href="#pytest-openfiles" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/astropy/pytest-openfiles">pytest-openfiles</a> plugin allows for the detection of open I/O resources
at the end of unit tests. This plugin adds the <code class="docutils literal notranslate"><span class="pre">--open-files</span></code> option to the
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> command (which is also exposed through the Astropy test runner).</p>
<p>When running tests with <code class="docutils literal notranslate"><span class="pre">--open-files</span></code>, if a file is opened during the course
of a unit test but that file  not closed before the test finishes, the test
will fail. This is particularly useful for testing code that manipulates file
handles or other I/O resources. It allows developers to ensure that this kind
of code properly cleans up I/O resources when they are no longer needed.</p>
<p>Also see <a class="reference internal" href="#open-files"><span class="std std-ref">Testing for open files</span></a>.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Testing Guidelines</a><ul>
<li><a class="reference internal" href="#testing-framework">Testing Framework</a></li>
<li><a class="reference internal" href="#testing-dependencies">Testing Dependencies</a></li>
<li><a class="reference internal" href="#running-tests">Running Tests</a><ul>
<li><a class="reference internal" href="#tox">tox</a></li>
<li><a class="reference internal" href="#pytest">pytest</a></li>
<li><a class="reference internal" href="#astropy-test">astropy.test()</a><ul>
<li><a class="reference internal" href="#astropy-test-function">Astropy Test Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-running-options">Test-running options</a><ul>
<li><a class="reference internal" href="#testing-for-open-files">Testing for open files</a></li>
<li><a class="reference internal" href="#test-coverage-reports">Test coverage reports</a></li>
<li><a class="reference internal" href="#running-tests-in-parallel">Running tests in parallel</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#writing-tests">Writing tests</a><ul>
<li><a class="reference internal" href="#simple-example">Simple example</a></li>
<li><a class="reference internal" href="#where-to-put-tests">Where to put tests</a><ul>
<li><a class="reference internal" href="#package-specific-tests">Package-specific tests</a></li>
<li><a class="reference internal" href="#interoperability-tests">Interoperability tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regression-tests">Regression tests</a></li>
<li><a class="reference internal" href="#working-with-data-files">Working with data files</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#tests-that-use-the-file-cache">Tests that use the file cache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tests-that-create-files">Tests that create files</a></li>
<li><a class="reference internal" href="#setting-up-tearing-down-tests">Setting up/Tearing down tests</a><ul>
<li><a class="reference internal" href="#module-level-setup-teardown">Module-level setup/teardown</a></li>
<li><a class="reference internal" href="#class-level-setup-teardown">Class-level setup/teardown</a></li>
<li><a class="reference internal" href="#method-level-setup-teardown">Method-level setup/teardown</a></li>
<li><a class="reference internal" href="#function-level-setup-teardown">Function-level setup/teardown</a></li>
</ul>
</li>
<li><a class="reference internal" href="#property-based-tests">Property-based tests</a></li>
<li><a class="reference internal" href="#parametrizing-tests">Parametrizing tests</a></li>
<li><a class="reference internal" href="#tests-requiring-optional-dependencies">Tests requiring optional dependencies</a></li>
<li><a class="reference internal" href="#using-pytest-helper-functions">Using pytest helper functions</a></li>
<li><a class="reference internal" href="#testing-warnings">Testing warnings</a></li>
<li><a class="reference internal" href="#testing-exceptions">Testing exceptions</a></li>
<li><a class="reference internal" href="#testing-configuration-parameters">Testing configuration parameters</a></li>
<li><a class="reference internal" href="#marking-blocks-of-code-to-exclude-from-coverage">Marking blocks of code to exclude from coverage</a></li>
<li><a class="reference internal" href="#image-tests-with-pytest-mpl">Image tests with pytest-mpl</a><ul>
<li><a class="reference internal" href="#running-image-tests">Running image tests</a></li>
<li><a class="reference internal" href="#writing-image-tests">Writing image tests</a></li>
<li><a class="reference internal" href="#generating-reference-images">Generating reference images</a></li>
<li><a class="reference internal" href="#uploading-the-reference-images">Uploading the reference images</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#writing-doctests">Writing doctests</a><ul>
<li><a class="reference internal" href="#skipping-doctests">Skipping doctests</a></li>
<li><a class="reference internal" href="#skipping-output">Skipping output</a><ul>
<li><a class="reference internal" href="#ignoring-all-output">Ignoring all output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-float-output">Handling float output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#continuous-integration">Continuous integration</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pytest-plugins">Pytest Plugins</a><ul>
<li><a class="reference internal" href="#pytest-remotedata">pytest-remotedata</a></li>
<li><a class="reference internal" href="#pytest-doctestplus">pytest-doctestplus</a></li>
<li><a class="reference internal" href="#pytest-openfiles">pytest-openfiles</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/development/testguide.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>