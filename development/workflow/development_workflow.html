


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>How to make a code contribution &#8212; Astropy v5.2.dev96+g04a0cf8bb</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Try the development version" href="get_devel_version.html" />
    <link rel="prev" title="Astropy Glossary" href="../../glossary.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="get_devel_version.html" title="Try the development version">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../../glossary.html" title="Astropy Glossary">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">Astropy v5.2.dev96+g04a0cf8bb</a>
	 &#187;
      </li>
      
      <li>How to make a code contribution</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-make-a-code-contribution">
<span id="development-workflow"></span><h1>How to make a code contribution<a class="headerlink" href="#how-to-make-a-code-contribution" title="Permalink to this headline">¶</a></h1>
<p>This document outlines the process for contributing code to the Astropy
project.</p>
<p><strong>Already experienced with git? Contributed before?</strong> Jump right to
<a class="reference internal" href="#astropy-git"><span class="std std-ref">Astropy Guidelines for git</span></a>.</p>
<div class="section" id="pre-requisites">
<h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h2>
<p>Before following the steps in this document you need:</p>
<ul class="simple">
<li><p>an account on <a class="reference external" href="https://github.com/">GitHub</a></p></li>
<li><p>a local copy of the astropy source. Instructions for doing that, including the
basics you need for setting up git and GitHub, are at <a class="reference internal" href="get_devel_version.html#get-devel"><span class="std std-ref">Try the development version</span></a>.</p></li>
</ul>
</div>
<div class="section" id="strongly-recommended-but-not-required">
<h2>Strongly Recommended, but not required<a class="headerlink" href="#strongly-recommended-but-not-required" title="Permalink to this headline">¶</a></h2>
<p>You cannot easily work on the development version of astropy in a python
environment in which you also use the stable version. It can be done —
but can only be done <em>successfully</em> if you always remember whether the
development version or stable version is the active one.</p>
<p><a class="reference internal" href="virtual_pythons.html#virtual-envs"><span class="std std-ref">Python virtual environments</span></a> offer a better solution and take only a few minutes to set
up. It is well worth your time.</p>
<p>Not sure what your first contribution should be? Take a look at the <a class="reference external" href="https://github.com/astropy/astropy/issues">Astropy
issue list</a> and grab one labeled <a class="reference external" href="https://github.com/astropy/astropy/issues?q=is%3Aissue+is%3Aopen+label%3Apackage-novice">“package-novice”</a>.
These issues are the most accessible ones if you are not familiar with the
Astropy source code. Issues labeled as <a class="reference external" href="https://github.com/astropy/astropy/issues?q=is%3Aissue+is%3Aopen+label%3Aeffort-low">“effort-low”</a>
are expected to take a few hours (at most) to address, while the
<a class="reference external" href="https://github.com/astropy/astropy/issues?q=is%3Aissue+is%3Aopen+label%3Aeffort-medium">“effort-medium”</a>
ones may take a few days. The developers are friendly and want you to help, so
don’t be shy about asking questions on the <a class="reference external" href="http://groups.google.com/group/astropy-dev">astropy-dev mailing list</a>.</p>
</div>
<div class="section" id="new-to-git">
<h2>New to <a class="reference external" href="https://git-scm.com/">git</a>?<a class="headerlink" href="#new-to-git" title="Permalink to this headline">¶</a></h2>
<div class="section" id="some-git-resources">
<h3>Some <a class="reference external" href="https://git-scm.com/">git</a> resources<a class="headerlink" href="#some-git-resources" title="Permalink to this headline">¶</a></h3>
<p>If you have never used git or have limited experience with it, take a few
minutes to look at these resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://lab.github.com/">Interactive tutorial</a> that runs in a browser</p></li>
<li><p><a class="reference external" href="https://git-scm.com/book/en/Getting-Started-Git-Basics">Git Basics</a>, part of a much longer <a class="reference external" href="https://git-scm.com/book/">git book</a>.</p></li>
</ul>
<p>In practice, you need only a handful of <a class="reference external" href="https://git-scm.com/">git</a> commands to make contributions
to Astropy. There is a more extensive list of <a class="reference internal" href="git_resources.html#git-resources"><span class="std std-ref">Git resources</span></a> if you
want more background.</p>
</div>
<div class="section" id="double-check-your-setup">
<h3>Double check your setup<a class="headerlink" href="#double-check-your-setup" title="Permalink to this headline">¶</a></h3>
<p>Before going further, make sure you have set up astropy as described in
<a class="reference internal" href="get_devel_version.html#get-devel"><span class="std std-ref">Try the development version</span></a>.</p>
<p>In a terminal window, change directory to the one containing your clone of
Astropy. Then, run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span></code>; the output should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">github</span><span class="o">-</span><span class="n">username</span>
<span class="n">astropy</span>
</pre></div>
</div>
<p>If that works, also run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span> <span class="pre">--all</span></code>. If it runs without errors then
your installation is working and you have a complete list of all branches in
your clone, <code class="docutils literal notranslate"><span class="pre">your-github-username</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy</span></code>.</p>
</div>
<div class="section" id="about-names-in-git">
<h3>About names in <a class="reference external" href="https://git-scm.com/">git</a><a class="headerlink" href="#about-names-in-git" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://git-scm.com/">git</a> is designed to be a <em>distributed</em> version control system. Each clone of
a repository is, itself, a repository. That can lead to some confusion,
especially for the branch called <code class="docutils literal notranslate"><span class="pre">main</span></code>. If you list all of the branches
your clone of git knows about with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">branch</span> <span class="pre">-a</span></code> you will see there are
<em>three</em> different branches called <code class="docutils literal notranslate"><span class="pre">main</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">main</span>                              <span class="c1"># this is main in your local repo</span>
<span class="n">remotes</span><span class="o">/</span><span class="n">your</span><span class="o">-</span><span class="n">github</span><span class="o">-</span><span class="n">username</span><span class="o">/</span><span class="n">main</span>   <span class="c1"># main on your fork of Astropy on GitHub</span>
<span class="n">remotes</span><span class="o">/</span><span class="n">astropy</span><span class="o">/</span><span class="n">main</span>                <span class="c1"># the official development branch of Astropy</span>
</pre></div>
</div>
<p>The naming scheme used by <a class="reference external" href="https://git-scm.com/">git</a> will also be used here. A plain branch name,
like <code class="docutils literal notranslate"><span class="pre">main</span></code> means a branch in your local copy of Astropy. A branch on a
remote, like <code class="docutils literal notranslate"><span class="pre">astropy</span></code> , is labeled by that remote, <code class="docutils literal notranslate"><span class="pre">astropy/main</span></code>.</p>
<p>This duplication of names can get very confusing when working with pull
requests, especially when the official main branch, <code class="docutils literal notranslate"><span class="pre">astropy/main</span></code>,
changes due to other contributions before your contributions are merged in.
As a result, you should never do any work in your main
branch, <code class="docutils literal notranslate"><span class="pre">main</span></code>. Always work on a branch instead.</p>
</div>
<div class="section" id="essential-git-commands">
<h3>Essential <a class="reference external" href="https://git-scm.com/">git</a> commands<a class="headerlink" href="#essential-git-commands" title="Permalink to this headline">¶</a></h3>
<p>A full <a class="reference external" href="https://git-scm.com/">git</a> tutorial is beyond the scope of this document but this list
describes the few <code class="docutils literal notranslate"><span class="pre">git</span></code> commands you are likely to encounter in contributing
to Astropy:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> gets the latest development version of Astropy, which you will
use as the basis for making your changes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">branch</span></code> makes a logically separate copy of Astropy to keep track of
your changes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> stages files you have changed or created for addition to <a class="reference external" href="https://git-scm.com/">git</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> adds your staged changes to the repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> copies the changes you committed to GitHub</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span></code> to see a list of files that have been modified or created.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A good graphical interface to git makes some of these steps much
easier. Some options are described in <a class="reference internal" href="git_install.html#git-gui-options"><span class="std std-ref">Get a git GUI (optional)</span></a>.</p>
</div>
</div>
<div class="section" id="if-something-goes-wrong">
<h3>If something goes wrong<a class="headerlink" href="#if-something-goes-wrong" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://git-scm.com/">git</a> provides a number of ways to recover from errors. If you end up making a
<a class="reference external" href="https://git-scm.com/">git</a> mistake, do not hesitate to ask for help. An additional resource that
walks you through recovering from <a class="reference external" href="https://git-scm.com/">git</a> mistakes is the
<a class="reference external" href="http://sethrobertson.github.io/GitFixUm/fixup.html">git choose-your-own-adventure</a>.</p>
</div>
</div>
<div class="section" id="astropy-guidelines-for-git">
<span id="astropy-git"></span><h2>Astropy Guidelines for <a class="reference external" href="https://git-scm.com/">git</a><a class="headerlink" href="#astropy-guidelines-for-git" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Don’t use your <code class="docutils literal notranslate"><span class="pre">main</span></code> branch for anything. Consider <a class="reference internal" href="#delete-main"><span class="std std-ref">Deleting your main branch</span></a>.</p></li>
<li><p>Make a new branch, called a <em>feature branch</em>, for each separable set of
changes: “one task, one branch” (<a class="reference external" href="https://mail.python.org/pipermail/ipython-dev/2010-October/005632.html">ipython git workflow</a>).</p></li>
<li><p>Start that new <em>feature branch</em> from the most current development version
of astropy (instructions are below).</p></li>
<li><p>Name your branch for the purpose of the changes, for example
<code class="docutils literal notranslate"><span class="pre">bugfix-for-issue-14</span></code> or <code class="docutils literal notranslate"><span class="pre">refactor-database-code</span></code>.</p></li>
<li><p>Make frequent commits, and always include a commit message. Each commit
should represent one logical set of changes.</p></li>
<li><p>Ask on the <a class="reference external" href="http://groups.google.com/group/astropy-dev">astropy-dev mailing list</a> if you get stuck.</p></li>
<li><p>Never merge changes from <code class="docutils literal notranslate"><span class="pre">astropy/main</span></code> into your feature branch. If
changes in the development version require changes to our code you can
<a class="reference internal" href="#rebase"><span class="std std-ref">Rebase, but only if asked</span></a>.</p></li>
</ul>
<p>In addition there are a couple of <a class="reference external" href="https://git-scm.com/">git</a> naming conventions used in this
document:</p>
<ul class="simple">
<li><p>Change the name of the remote <code class="docutils literal notranslate"><span class="pre">origin</span></code> to <code class="docutils literal notranslate"><span class="pre">your-github-username</span></code>.</p></li>
<li><p>Name the remote that is the primary Astropy repository
<code class="docutils literal notranslate"><span class="pre">astropy</span></code>; in prior versions of this documentation it was referred to as
<code class="docutils literal notranslate"><span class="pre">upstream</span></code>.</p></li>
</ul>
</div>
<div class="section" id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<p>These, conceptually, are the steps you will follow in contributing to Astropy:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#fetch-latest"><span class="std std-ref">Fetch the latest Astropy</span></a></p></li>
<li><p><a class="reference internal" href="#make-feature-branch"><span class="std std-ref">Make a new feature branch</span></a>; you will make your changes on this branch.</p></li>
<li><p><a class="reference internal" href="#install-branch"><span class="std std-ref">Install your branch</span></a></p></li>
<li><p>Follow <a class="reference internal" href="#edit-flow"><span class="std std-ref">The editing workflow</span></a> to write/edit/document/test code - make
frequent, small commits.</p></li>
<li><p><a class="reference internal" href="#add-changelog"><span class="std std-ref">Add a changelog entry</span></a></p></li>
<li><p><a class="reference internal" href="#push-to-github"><span class="std std-ref">Copy your changes to GitHub</span></a></p></li>
<li><p>From GitHub, <a class="reference internal" href="#pull-request"><span class="std std-ref">Ask for your changes to be reviewed</span></a> to let the Astropy maintainers know
you have contributions to review.</p></li>
<li><p><a class="reference internal" href="#revise-and-push"><span class="std std-ref">Revise and push as necessary</span></a> in response to comments on the pull
request. Pushing those changes to GitHub automatically updates the
pull request.</p></li>
</ol>
<p>This way of working helps to keep work well organized, with readable history.
This in turn makes it easier for project maintainers (that might be you) to
see what you’ve done, and why you did it.</p>
<p>A worked example that follows these steps for fixing an Astropy issue is at
<a class="reference internal" href="git_edit_workflow_examples.html#astropy-fix-example"><span class="std std-ref">Contributing code to Astropy, a worked example</span></a>.</p>
<p>Some additional topics related to <a class="reference external" href="https://git-scm.com/">git</a> are in <a class="reference internal" href="additional_git_topics.html#additional-git"><span class="std std-ref">Some other things you might want to do</span></a>.</p>
<div class="section" id="deleting-your-main-branch">
<span id="delete-main"></span><h3>Deleting your main branch<a class="headerlink" href="#deleting-your-main-branch" title="Permalink to this headline">¶</a></h3>
<p>It may sound strange, but deleting your own <code class="docutils literal notranslate"><span class="pre">main</span></code> branch can help reduce
confusion about which branch you are on.  See <a class="reference external" href="http://matthew-brett.github.io/pydagogue/gh_delete_master.html">deleting main on github</a> for
details.</p>
</div>
</div>
<div class="section" id="fetch-the-latest-astropy">
<span id="fetch-latest"></span><h2>Fetch the latest Astropy<a class="headerlink" href="#fetch-the-latest-astropy" title="Permalink to this headline">¶</a></h2>
<p>From time to time you should fetch the development version (i.e. Astropy
<code class="docutils literal notranslate"><span class="pre">astropy/main</span></code>) changes from GitHub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">fetch</span> <span class="n">astropy</span> <span class="o">--</span><span class="n">tags</span>
</pre></div>
</div>
<p>This will pull down any commits you don’t have, and set the remote branches to
point to the latest commit. For example, ‘trunk’ is the branch referred to by
<code class="docutils literal notranslate"><span class="pre">astropy/main</span></code>, and if there have been commits since
you last checked, <code class="docutils literal notranslate"><span class="pre">astropy/main</span></code> will change after you do the fetch.</p>
</div>
<div class="section" id="make-a-new-feature-branch">
<span id="make-feature-branch"></span><h2>Make a new feature branch<a class="headerlink" href="#make-a-new-feature-branch" title="Permalink to this headline">¶</a></h2>
<div class="section" id="make-the-new-branch">
<h3>Make the new branch<a class="headerlink" href="#make-the-new-branch" title="Permalink to this headline">¶</a></h3>
<p>When you are ready to make some changes to the code, you should start a new
branch. Branches that are for a collection of related edits are often called
‘feature branches’.</p>
<p>Making a new branch for each set of related changes will make it easier for
someone reviewing your branch to see what you are doing.</p>
<p>Choose an informative name for the branch to remind yourself and the rest of us
what the changes in the branch are for. Branch names like <code class="docutils literal notranslate"><span class="pre">add-ability-to-fly</span></code>
or <code class="docutils literal notranslate"><span class="pre">buxfix-for-issue-42</span></code> clearly describe the purpose of the branch.</p>
<p>Always make your branch from <code class="docutils literal notranslate"><span class="pre">astropy/main</span></code> so that you are basing your
changes on the latest version of Astropy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update the mirror of trunk</span>
<span class="n">git</span> <span class="n">fetch</span> <span class="n">astropy</span> <span class="o">--</span><span class="n">tags</span>

<span class="c1"># Make new feature branch starting at astropy/main</span>
<span class="n">git</span> <span class="n">branch</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span> <span class="n">astropy</span><span class="o">/</span><span class="n">main</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span>
</pre></div>
</div>
</div>
<div class="section" id="connect-the-branch-to-github">
<h3>Connect the branch to GitHub<a class="headerlink" href="#connect-the-branch-to-github" title="Permalink to this headline">¶</a></h3>
<p>At this point you have made and checked out a new branch, but <a class="reference external" href="https://git-scm.com/">git</a> does not
know it should be connected to your fork on GitHub. You need that connection
for your proposed changes to be managed by the Astropy maintainers on GitHub.</p>
<p>The most convenient way for connecting your local branch to GitHub is to <a class="reference external" href="http://schacon.github.io/git/git-push.html">git
push</a> this new branch up to your GitHub repo with the <code class="docutils literal notranslate"><span class="pre">--set-upstream</span></code>
option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="nb">set</span><span class="o">-</span><span class="n">upstream</span> <span class="n">your</span><span class="o">-</span><span class="n">github</span><span class="o">-</span><span class="n">username</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span>
</pre></div>
</div>
<p>From now on git will know that <code class="docutils literal notranslate"><span class="pre">my-new-feature</span></code> is related to the
<code class="docutils literal notranslate"><span class="pre">your-github-username/my-new-feature</span></code> branch in your GitHub fork of Astropy.</p>
<p>You will still need to <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> your changes to GitHub periodically. The
setup in this section will make that easier because any following pushes of
this branch can be performed without having to write out the remote and branch
names.</p>
</div>
</div>
<div class="section" id="install-your-branch">
<span id="install-branch"></span><h2>Install your branch<a class="headerlink" href="#install-your-branch" title="Permalink to this headline">¶</a></h2>
<p>Ideally you should set up a Python virtual environment just for this fix;
instructions for doing to are at <a class="reference internal" href="virtual_pythons.html#virtual-envs"><span class="std std-ref">Python virtual environments</span></a>. Doing so ensures you
will not corrupt your main <code class="docutils literal notranslate"><span class="pre">astropy</span></code> install and makes it very easy to recover
from mistakes.</p>
<p>Once you have activated that environment, you need to install the version of
<code class="docutils literal notranslate"><span class="pre">astropy</span></code> you are working on. Do that with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -e .
</pre></div>
</div>
<p>For more details on building <code class="docutils literal notranslate"><span class="pre">astropy</span></code> from source, see
<a class="reference internal" href="../building.html#dev-build-astropy-subpkg"><span class="std std-ref">Building Astropy and its Subpackages</span></a>.</p>
</div>
<div class="section" id="the-editing-workflow">
<span id="edit-flow"></span><h2>The editing workflow<a class="headerlink" href="#the-editing-workflow" title="Permalink to this headline">¶</a></h2>
<p>Conceptually, you will:</p>
<ol class="arabic simple">
<li><p>Make changes to one or more files and/or add a new file.</p></li>
<li><p>Check that your changes do not break existing code.</p></li>
<li><p>Add documentation to your code and, as appropriate, to the Astropy
documentation.</p></li>
<li><p>Ideally, also make sure your changes do not break the documentation.</p></li>
<li><p>Add tests of the code you contribute.</p></li>
<li><p>Commit your changes in <a class="reference external" href="https://git-scm.com/">git</a></p></li>
<li><p>Repeat as necessary.</p></li>
</ol>
<div class="section" id="in-more-detail">
<h3>In more detail<a class="headerlink" href="#in-more-detail" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Make some changes to one or more files. You should follow the Astropy
<a class="reference internal" href="../codeguide.html#code-guide"><span class="std std-ref">Coding Guidelines</span></a>. Each logical set of changes should be treated as one
commit. For example, if you are fixing a known bug in Astropy and notice
a different bug while implementing your fix, implement the fix to that new
bug as a different set of changes.</p></li>
<li><p>Test that your changes do not lead to <em>regressions</em>, i.e. that your
changes do not break existing code, by running the Astropy tests. You can
run all of the Astropy tests from ipython with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">astropy</span>
<span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>If your change involves only a small part of Astropy, e.g. Time, you can
run just those tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">astropy</span>
<span class="n">astropy</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Tests can also be run from the command line while in the package
root directory, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span>
</pre></div>
</div>
<p>To run the tests in only a single package, e.g. Time, you can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">-</span><span class="n">P</span> <span class="n">time</span>
</pre></div>
</div>
<p>For more details on running tests, please see <a class="reference internal" href="../testguide.html#testing-guidelines"><span class="std std-ref">Testing Guidelines</span></a>.</p>
</li>
<li><p>Make sure your code includes appropriate docstrings, in the
<a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html">Numpydoc format</a>.
If appropriate, as when you are adding a new feature,
you should update the appropriate documentation in the <code class="docutils literal notranslate"><span class="pre">docs</span></code> directory;
a detailed description is in <a class="reference internal" href="../docguide.html#documentation-guidelines"><span class="std std-ref">Writing Documentation</span></a>.</p></li>
<li><p>If you have sphinx installed, you can also check that
the documentation builds and looks correct by running, from the
<code class="docutils literal notranslate"><span class="pre">astropy</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">docs</span>
<span class="n">make</span> <span class="n">html</span>
</pre></div>
</div>
<p>The last line should just state <code class="docutils literal notranslate"><span class="pre">build</span> <span class="pre">succeeded</span></code>, and should not mention
any warnings.  (For more details, see <a class="reference internal" href="../docguide.html#documentation-guidelines"><span class="std std-ref">Writing Documentation</span></a>.)</p>
</li>
<li><p>Add tests of your new code, if appropriate. Some changes (e.g. to
documentation) do not need tests. Detailed instructions are at
<a class="reference internal" href="../testguide.html#writing-tests"><span class="std std-ref">Writing tests</span></a>, but if you have no experience writing tests or
with the <a class="reference external" href="https://pytest.org/en/latest/index.html">pytest</a> testing framework submit your changes without adding
tests, but mention in the pull request that you have not written tests.
An example of writing a test is in
<a class="reference internal" href="git_edit_workflow_examples.html#astropy-fix-add-tests"><span class="std std-ref">Stop and think: Any more tests or other changes?</span></a>.</p></li>
<li><p>Stage your changes using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> and commit them using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>.
An example of doing that, based on the fix for an actual Astropy issue, is
at <a class="reference internal" href="git_edit_workflow_examples.html#astropy-fix-example"><span class="std std-ref">Contributing code to Astropy, a worked example</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make your <a class="reference external" href="https://git-scm.com/">git</a> commit messages short and descriptive. If a commit
fixes an issue, include, on the second or later line of the commit
message, the issue number in the commit message, like this:
<code class="docutils literal notranslate"><span class="pre">Closes</span> <span class="pre">#123</span></code>. Doing so will automatically close the issue when the
pull request is accepted.</p>
</div>
</li>
<li><p>Some modifications require more than one commit; if in doubt, break
your changes into a few, smaller, commits rather than one large commit
that does many things at once. Repeat the steps above as necessary!</p></li>
</ol>
</div>
</div>
<div class="section" id="add-a-changelog-entry">
<span id="add-changelog"></span><h2>Add a changelog entry<a class="headerlink" href="#add-a-changelog-entry" title="Permalink to this headline">¶</a></h2>
<p>Add a changelog fragment briefly describing the change you made by creating
a new file in <code class="docutils literal notranslate"><span class="pre">docs/changes/&lt;sub-package&gt;/</span></code>. The file should be named like
<code class="docutils literal notranslate"><span class="pre">&lt;PULL</span> <span class="pre">REQUEST&gt;.&lt;TYPE&gt;.rst</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;PULL</span> <span class="pre">REQUEST&gt;</span></code> is a pull request
number, and <code class="docutils literal notranslate"><span class="pre">&lt;TYPE&gt;</span></code> is one of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">feature</span></code>: New feature.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">api</span></code>: API change.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bugfix</span></code>: Bug fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">other</span></code>: Other changes and additions.</p></li>
</ul>
<p>An example entry, for the changes in <a class="reference external" href="https://github.com/astropy/astropy/pull/1845">PR 1845</a>, the file would be
<code class="docutils literal notranslate"><span class="pre">docs/changes/wcs/1845.bugfix.rst</span></code> and would contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>``astropy.wcs.Wcs.printwcs`` will no longer warn that ``cdelt`` is
being ignored when none was present in the FITS file.
</pre></div>
</div>
<p>If you are opening a new pull request, you may not know its number yet, but you
can add it <em>after</em> you make the pull request. If you’re not sure where to
put the changelog entry, wait at least until a maintainer has reviewed your
PR and assigned it to a milestone.</p>
<p>When writing changelog entries, do not attempt to make API reference links
by using single-backticks.  This is because the changelog (in its current
format) runs for the history of the project, and API references you make today
may not be valid in a future version of Astropy.  However, use of
double-backticks for monospace rendering of module/class/function/argument
names and the like is encouraged.</p>
</div>
<div class="section" id="copy-your-changes-to-github">
<span id="push-to-github"></span><h2>Copy your changes to GitHub<a class="headerlink" href="#copy-your-changes-to-github" title="Permalink to this headline">¶</a></h2>
<p>If you followed the instructions to <a class="reference internal" href="#connect-the-branch-to-github">Connect the branch to GitHub</a> then you
can simply use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span>
</pre></div>
</div>
<p>If you skipped that step then you need to write out the remote and branch
names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">your</span><span class="o">-</span><span class="n">github</span><span class="o">-</span><span class="n">username</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span>
</pre></div>
</div>
</div>
<div class="section" id="ask-for-your-changes-to-be-reviewed">
<span id="pull-request"></span><h2>Ask for your changes to be reviewed<a class="headerlink" href="#ask-for-your-changes-to-be-reviewed" title="Permalink to this headline">¶</a></h2>
<p>A <em>pull request</em> on GitHub is a request to merge the changes you have made into
another repository.</p>
<p>When you are ready to ask for someone to review your code and consider merging
it into Astropy:</p>
<ol class="arabic">
<li><p>Go to the URL of your fork of Astropy, e.g.,
<code class="docutils literal notranslate"><span class="pre">https://github.com/your-user-name/astropy</span></code>.</p></li>
<li><p>Use the ‘Switch Branches’ dropdown menu to select the branch with your
changes:</p>
<img alt="../../_images/branch_dropdown.png" src="../../_images/branch_dropdown.png" />
</li>
<li><p>Click on the ‘Pull request’ button:</p>
<img alt="../../_images/pull_button.png" src="../../_images/pull_button.png" />
<p>Enter a title for the set of changes, and some explanation of what you’ve
done. If there is anything you’d like particular attention for, like a
complicated change or some code you are not happy with, add the details
here.</p>
<p>If you don’t think your request is ready to be merged, just say so in your
pull request message.  This is still a good way to start a preliminary
code review.</p>
<p>You may also opt to open a work-in-progress pull request.
If you do so, instead of clicking “Create pull request”, click on the small
down arrow next to it and select “Create draft pull request”. This will let
the maintainers know that your work is not ready for a full review nor to be
merged yet. In addition, if your commits are not ready for CI testing, you
should also use <code class="docutils literal notranslate"><span class="pre">[ci</span> <span class="pre">skip]</span></code> or <code class="docutils literal notranslate"><span class="pre">[skip</span> <span class="pre">ci]</span></code> directive in your commit message.</p>
</li>
</ol>
</div>
<div class="section" id="revise-and-push-as-necessary">
<span id="revise-and-push"></span><h2>Revise and push as necessary<a class="headerlink" href="#revise-and-push-as-necessary" title="Permalink to this headline">¶</a></h2>
<p>You may be asked to make changes in the discussion of the pull request. Make
those changes in your local copy, commit them to your local repo and push them
to GitHub. GitHub will automatically update your pull request.</p>
</div>
<div class="section" id="do-not-create-a-merge-commit">
<span id="no-git-pull"></span><h2>Do Not Create a Merge Commit<a class="headerlink" href="#do-not-create-a-merge-commit" title="Permalink to this headline">¶</a></h2>
<p>If your branch associated with the pull request falls behind the <code class="docutils literal notranslate"><span class="pre">main</span></code>
branch of <a class="reference external" href="https://github.com/astropy/astropy">https://github.com/astropy/astropy</a>, GitHub might offer you the option
to catch up or resolve conflicts via its web interface, but do not use this. Using
the web interface might create a “merge commit” in your commit history, which is
undesirable, as a “merge commit” can introduce maintenance overhead for the
release manager as well as undesirable branch structure complexity. Do not use the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code> command either.</p>
<p>Instead, in your local checkout, do a <code class="docutils literal notranslate"><span class="pre">fetch</span></code> and then a <code class="docutils literal notranslate"><span class="pre">rebase</span></code>, and
resolve conflicts as necessary. See <a class="reference internal" href="#rebase"><span class="std std-ref">Rebase, but only if asked</span></a> and <a class="reference internal" href="#howto-rebase"><span class="std std-ref">How to rebase</span></a>
for further information.</p>
</div>
<div class="section" id="rebase-but-only-if-asked">
<span id="rebase"></span><h2>Rebase, but only if asked<a class="headerlink" href="#rebase-but-only-if-asked" title="Permalink to this headline">¶</a></h2>
<p>Sometimes the maintainers of Astropy may ask a pull request to be <em>rebased</em>
or <em>squashed</em> in the process of reviewing a pull request for merging into
the main Astropy <em>main</em> repository.</p>
<p>The decisions of when to request a <em>squash</em> or <em>rebase</em> are left to
individual maintainers.  These may be requested to reduce the number of
visible commits saved in the repository history, or because of code changes
in Astropy in the meantime.  A rebase may be necessary to allow the Continuous
Integration tests to run.  Both involve rewriting the <a class="reference external" href="https://git-scm.com/">git</a> history, meaning
that commit hashes will change, which is why you should do it only if asked.</p>
<p>Conceptually, rebasing means taking your changes and applying them to the latest
version of the development branch of the official Astropy as though that was the
version you had originally branched from. Each individual commit remains
visible, but with new metadata/commit hashes. Squashing commits changes the
metadata/commit hash, and also removes separate visibility of individual
commits; a new commit and commit message will only contain a textual
list of the earlier commits.</p>
<p>It is easier to make mistakes rebasing than other areas of <a class="reference external" href="https://git-scm.com/">git</a>, so before you
start make a branch to serve as a backup copy of your work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">branch</span> <span class="n">tmp</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span> <span class="c1"># make temporary branch--will be deleted later</span>
</pre></div>
</div>
<p>After altering the history, e.g. with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span></code>, a normal <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code>
is prevented, and a <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">--force</span></code> will be required.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not update your branch with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code>. Pulling changes from
<code class="docutils literal notranslate"><span class="pre">astropy/main</span></code> includes merging the branches, which combines them in a
way that preserves the commit history of both. The purpose of rebasing is
rewriting the commit history of your branch, not preserving it.</p>
</div>
</div>
<div class="section" id="how-to-rebase">
<span id="howto-rebase"></span><h2>How to rebase<a class="headerlink" href="#how-to-rebase" title="Permalink to this headline">¶</a></h2>
<p>Behind the scenes, <a class="reference external" href="https://git-scm.com/">git</a> is deleting the changes and branch you made, making the
changes others made to the development branch of Astropy, then re-making your
branch from the development branch and applying your changes to your branch.</p>
<p>The actual rebasing is usually easy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">fetch</span> <span class="n">astropy</span> <span class="n">main</span> <span class="c1"># get the latest development astropy</span>
<span class="n">git</span> <span class="n">rebase</span> <span class="n">astropy</span><span class="o">/</span><span class="n">main</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span>
</pre></div>
</div>
<p>You are more likely to run into <em>conflicts</em> here — places where the changes you
made conflict with changes that someone else made — than anywhere else. Ask for
help if you need it. Instructions are available on how to
<a class="reference external" href="https://help.github.com/en/articles/resolving-merge-conflicts-after-a-git-rebase">resolve merge conflicts after a Git rebase</a>.</p>
</div>
<div class="section" id="how-to-squash">
<span id="howto-squash"></span><h2>How to squash<a class="headerlink" href="#how-to-squash" title="Permalink to this headline">¶</a></h2>
<p>Typically we ask to <em>squash</em> when there was a fair amount of trial
and error, but the final patch remains quite small, or when files were added
and removed (especially binary files or files that should not remain in the
repository) or if the number of commits in the history is disproportionate
compared to the work being carried out (for example 30 commits gradually
refining a final 10-line change).  Conceptually this is equivalent to
exporting the final diff from a feature branch, then starting a new branch and
applying only that patch.</p>
<p>Many of us find that is it actually easiest to squash using rebase. In particular,
you can rebase and squash within the existing branch using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">fetch</span> <span class="n">astropy</span>
<span class="n">git</span> <span class="n">rebase</span> <span class="o">-</span><span class="n">i</span> <span class="n">astropy</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
<p>The last command will open an editor with all your commits, allowing you to
squash several commits together, rename them, etc. Helpfully, the file you are
editing has the instructions on what to do.</p>
</div>
<div class="section" id="how-to-push">
<span id="howto-push-force"></span><h2>How to push<a class="headerlink" href="#how-to-push" title="Permalink to this headline">¶</a></h2>
<p>After using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span></code> you will still need to push your changes to
GitHub so that they are visible to others and the pull request can be
updated.  Use of a simple <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> will be prevented because of the
changed history, and will need to be manually overridden using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="n">force</span>
</pre></div>
</div>
<p>If you run into any problems, do not hesitate to ask. A more detailed conceptual
discussing of rebasing is at <a class="reference internal" href="additional_git_topics.html#rebase-on-trunk"><span class="std std-ref">Rebasing on trunk</span></a>.</p>
<p>Once the modifications and new git history are successfully pushed to GitHub you
can delete any backup branches that may have been created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">branch</span> <span class="o">-</span><span class="n">D</span> <span class="n">tmp</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">How to make a code contribution</a><ul>
<li><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="reference internal" href="#strongly-recommended-but-not-required">Strongly Recommended, but not required</a></li>
<li><a class="reference internal" href="#new-to-git">New to git?</a><ul>
<li><a class="reference internal" href="#some-git-resources">Some git resources</a></li>
<li><a class="reference internal" href="#double-check-your-setup">Double check your setup</a></li>
<li><a class="reference internal" href="#about-names-in-git">About names in git</a></li>
<li><a class="reference internal" href="#essential-git-commands">Essential git commands</a></li>
<li><a class="reference internal" href="#if-something-goes-wrong">If something goes wrong</a></li>
</ul>
</li>
<li><a class="reference internal" href="#astropy-guidelines-for-git">Astropy Guidelines for git</a></li>
<li><a class="reference internal" href="#workflow">Workflow</a><ul>
<li><a class="reference internal" href="#deleting-your-main-branch">Deleting your main branch</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fetch-the-latest-astropy">Fetch the latest Astropy</a></li>
<li><a class="reference internal" href="#make-a-new-feature-branch">Make a new feature branch</a><ul>
<li><a class="reference internal" href="#make-the-new-branch">Make the new branch</a></li>
<li><a class="reference internal" href="#connect-the-branch-to-github">Connect the branch to GitHub</a></li>
</ul>
</li>
<li><a class="reference internal" href="#install-your-branch">Install your branch</a></li>
<li><a class="reference internal" href="#the-editing-workflow">The editing workflow</a><ul>
<li><a class="reference internal" href="#in-more-detail">In more detail</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-a-changelog-entry">Add a changelog entry</a></li>
<li><a class="reference internal" href="#copy-your-changes-to-github">Copy your changes to GitHub</a></li>
<li><a class="reference internal" href="#ask-for-your-changes-to-be-reviewed">Ask for your changes to be reviewed</a></li>
<li><a class="reference internal" href="#revise-and-push-as-necessary">Revise and push as necessary</a></li>
<li><a class="reference internal" href="#do-not-create-a-merge-commit">Do Not Create a Merge Commit</a></li>
<li><a class="reference internal" href="#rebase-but-only-if-asked">Rebase, but only if asked</a></li>
<li><a class="reference internal" href="#how-to-rebase">How to rebase</a></li>
<li><a class="reference internal" href="#how-to-squash">How to squash</a></li>
<li><a class="reference internal" href="#how-to-push">How to push</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../_sources/development/workflow/development_workflow.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>