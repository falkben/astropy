


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Workflow for Maintainers &#8212; Astropy v5.2.dev94+gb1133d712.d20220509</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to create and maintain a Python package using the Astropy template" href="../astropy-package-template.html" />
    <link rel="prev" title="Release procedure for the astropy core package" href="../releasing.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../astropy-package-template.html" title="How to create and maintain a Python package using the Astropy template">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../releasing.html" title="Release procedure for the astropy core package">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">Astropy v5.2.dev94+gb1133d712.d20220509</a>
	 &#187;
      </li>
      
      <li>Workflow for Maintainers</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="workflow-for-maintainers">
<span id="maintainer-workflow"></span><h1>Workflow for Maintainers<a class="headerlink" href="#workflow-for-maintainers" title="Permalink to this headline">¶</a></h1>
<p>This page is for maintainers — those of us who merge our own or other
peoples’ changes into the upstream repository.</p>
<p>Being as how you’re a maintainer, you are completely on top of the basic stuff
in <a class="reference internal" href="development_workflow.html#development-workflow"><span class="std std-ref">How to make a code contribution</span></a>.</p>
<div class="section" id="integrating-changes-via-the-web-interface-recommended">
<h2>Integrating changes via the web interface (recommended)<a class="headerlink" href="#integrating-changes-via-the-web-interface-recommended" title="Permalink to this headline">¶</a></h2>
<p>Whenever possible, merge pull requests automatically via the pull request manager on GitHub. Merging should only be done manually if there is a really good reason to do this!</p>
<p>Make sure that pull requests do not contain a messy history with merges, etc. If this is the case, then follow the manual instructions, and make sure the fork is rebased to tidy the history before committing.</p>
</div>
<div class="section" id="integrating-changes-manually">
<h2>Integrating changes manually<a class="headerlink" href="#integrating-changes-manually" title="Permalink to this headline">¶</a></h2>
<p>First, check out the <code class="docutils literal notranslate"><span class="pre">astropy</span></code> repository. The instructions in <a class="reference internal" href="get_devel_version.html#set-upstream-main"><span class="std std-ref">Tell git where to look for changes in the development version of Astropy</span></a> add a remote that has read-only
access to the upstream repo.  Being a maintainer, you’ve got read-write access.</p>
<p>It’s good to have your upstream remote have a scary name, to remind you that
it’s a read-write remote:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">astropy</span><span class="o">/</span><span class="n">astropy</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">fetch</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span> <span class="o">--</span><span class="n">tags</span>
</pre></div>
</div>
<p>Let’s say you have some changes that need to go into trunk
(<code class="docutils literal notranslate"><span class="pre">upstream-rw/main</span></code>).</p>
<p>The changes are in some branch that you are currently on. For example, you are
looking at someone’s changes like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">someone</span> <span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">someone</span><span class="o">/</span><span class="n">astropy</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">fetch</span> <span class="n">someone</span>
<span class="n">git</span> <span class="n">branch</span> <span class="n">cool</span><span class="o">-</span><span class="n">feature</span> <span class="o">--</span><span class="n">track</span> <span class="n">someone</span><span class="o">/</span><span class="n">cool</span><span class="o">-</span><span class="n">feature</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="n">cool</span><span class="o">-</span><span class="n">feature</span>
</pre></div>
</div>
<p>So now you are on the branch with the changes to be incorporated upstream. The
rest of this section assumes you are on this branch.</p>
<div class="section" id="a-few-commits">
<h3>A few commits<a class="headerlink" href="#a-few-commits" title="Permalink to this headline">¶</a></h3>
<p>If there are only a few commits, consider rebasing to upstream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch upstream changes</span>
<span class="n">git</span> <span class="n">fetch</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span>

<span class="c1"># Rebase</span>
<span class="n">git</span> <span class="n">rebase</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
<p>Remember that, if you do a rebase, and push that, you’ll have to close any
github pull requests manually, because github will not be able to detect the
changes have already been merged.</p>
</div>
<div class="section" id="a-long-series-of-commits">
<h3>A long series of commits<a class="headerlink" href="#a-long-series-of-commits" title="Permalink to this headline">¶</a></h3>
<p>If there are a longer series of related commits, consider a merge instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">fetch</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span>
<span class="n">git</span> <span class="n">merge</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ff</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span><span class="o">/</span><span class="n">main</span>
</pre></div>
</div>
<p>The merge will be detected by github, and should close any related pull
requests automatically.</p>
<p>Note the <code class="docutils literal notranslate"><span class="pre">--no-ff</span></code> above. This forces git to make a merge commit, rather
than doing a fast-forward, so that these set of commits branch off trunk then
rejoin the main history with a merge, rather than appearing to have been made
directly on top of trunk.</p>
</div>
<div class="section" id="check-the-history">
<h3>Check the history<a class="headerlink" href="#check-the-history" title="Permalink to this headline">¶</a></h3>
<p>Now, in either case, you should check that the history is sensible and you
have the right commits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">oneline</span> <span class="o">--</span><span class="n">graph</span>
<span class="n">git</span> <span class="n">log</span> <span class="o">-</span><span class="n">p</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span><span class="o">/</span><span class="n">main</span><span class="o">..</span>
</pre></div>
</div>
<p>The first line above just shows the history in a compact way, with a text
representation of the history graph. The second line shows the log of commits
excluding those that can be reached from trunk (<code class="docutils literal notranslate"><span class="pre">upstream-rw/main</span></code>), and
including those that can be reached from current HEAD (implied with the <code class="docutils literal notranslate"><span class="pre">..</span></code>
at the end). So, it shows the commits unique to this branch compared to trunk.
The <code class="docutils literal notranslate"><span class="pre">-p</span></code> option shows the diff for these commits in patch form.</p>
</div>
<div class="section" id="push-to-trunk">
<h3>Push to trunk<a class="headerlink" href="#push-to-trunk" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">upstream</span><span class="o">-</span><span class="n">rw</span> <span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">feature</span><span class="p">:</span><span class="n">main</span>
</pre></div>
</div>
<p>This pushes the <code class="docutils literal notranslate"><span class="pre">my-new-feature</span></code> branch in this repository to the <code class="docutils literal notranslate"><span class="pre">main</span></code>
branch in the <code class="docutils literal notranslate"><span class="pre">upstream-rw</span></code> repository.</p>
</div>
</div>
<div class="section" id="using-milestones-and-labels">
<span id="milestones-and-labels"></span><h2>Using Milestones and Labels<a class="headerlink" href="#using-milestones-and-labels" title="Permalink to this headline">¶</a></h2>
<p>General guidelines for milestones:</p>
<ul class="simple">
<li><p>100% of pull requests should have a milestone</p></li>
<li><p>Issues are not milestoned unless they block a given release</p></li>
<li><p>Only the following criteria should result in a pull request being closed without a milestone:</p>
<ul>
<li><p>Invalid (user error, etc.)</p></li>
<li><p>Duplicate of an existing pull request</p></li>
<li><p>A pull request superseded by a new pull request providing an alternate implementation</p></li>
</ul>
</li>
<li><p>In general there should be the following open milestones:</p>
<ul>
<li><p>The next bug fix releases for any still-supported version lines; for example if 0.4 is in development and
0.2.x and 0.3.x are still supported there should be milestones for the next 0.2.x and 0.3.x releases.</p></li>
<li><p>The next X.Y release, i.e. the next minor release; this is generally the next release that all development in
main is aimed toward.</p></li>
<li><p>The next X.Y release +1; for example if 0.3 is the next release, there should also be a milestone for 0.4 for
issues that are important, but that we know won’t be resolved in the next release.</p></li>
</ul>
</li>
<li><p>We have <a class="reference external" href="https://github.com/astropy/astropy/issues/9018">Rolling reminder: update wcslib and cfitsio and leap second/IERS B table to the latest version</a>.
The milestone for this issue should be updated as part of the release
procedures.</p></li>
</ul>
<p>General guidelines for labels:</p>
<ul class="simple">
<li><p>Issues: Maintainer should be proactive in labeling issues as they come in.
At the very least, label the subpackage(s) involved and whether the issue
is a bug.</p></li>
<li><p>Pull requests: We have GitHub Actions to automatically apply labels using
some simple rules when a pull request is opened. Once that is done, a
maintainer can then manually apply any other labels that apply.</p></li>
</ul>
</div>
<div class="section" id="updating-and-maintaining-the-changelog">
<span id="changelog-format"></span><h2>Updating and Maintaining the Changelog<a class="headerlink" href="#updating-and-maintaining-the-changelog" title="Permalink to this headline">¶</a></h2>
<p>The Astropy “changelog” is managed with
<a class="reference external" href="https://pypi.org/project/towncrier/">towncrier</a>, which is used to generate
the <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code> file at the root of the repository. The changelog fragment
files should be added with each PR as described in
<a class="reference external" href="https://github.com/astropy/astropy/blob/main/docs/changes/README.rst">docs/changes/README.rst</a>.
The purpose of this file is to give a technical, but still user (and developer)
oriented overview of what changes were made to Astropy between each public
release.  The idea is that it’s a little more to the point and easier to follow
than trying to read through full git log.  It lists all new features added
between versions, so that a user can easily find out from reading the changelog
when a feature was added.  Likewise it lists any features or APIs that were
changed (and how they were changed) or removed.  It also lists all bug fixes.
Affiliated packages are encouraged to maintain a similar changelog.</p>
</div>
<div class="section" id="stale-policies">
<span id="id1"></span><h2>Stale Policies<a class="headerlink" href="#stale-policies" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">astropy</span></code> GitHub repository has the following stale policies, which are
enforced by <a class="reference external" href="https://github.com/pllim/action-astropy-stalebot/">action-astropy-stalebot</a>
in <a class="reference external" href="https://github.com/astropy/astropy/blob/main/.github/workflows/stalebot.yml">.github/workflows/stalebot.yml</a>
that runs on a schedule. Hereafter, we refer to this automated enforcer as stale-bot.</p>
<p>All the timing mentioned depends on a successful stale-bot run. GitHub API limits,
spam protection, or server maintenance could affect the run. The former might
especially be relevant when there is a significant backlog of stale issues and
pull requests accumulated.</p>
<p>If you notice unintended stale-bot behaviors, please report them to the Astropy
maintainers.</p>
<div class="section" id="issues">
<h3>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h3>
<p>A maintainer applies the “Closed?” label to mark an issue as stale, otherwise it
stays open until someone manually closes it. Once marked as stale, a warning will
be issued.</p>
<p>A maintainer can apply “keep-open” label or remove “Closed?” label to remove the
stale status. Otherwise, stale-bot will close the issue after about a week and
apply a “closed-by-bot” label.</p>
<p>When both “keep-open” and “Close?” labels exist, the former will take precedence
and the latter will be removed from the issue.</p>
</div>
<div class="section" id="pull-requests">
<h3>Pull Requests<a class="headerlink" href="#pull-requests" title="Permalink to this headline">¶</a></h3>
<p>A pull request becomes stale after about 4-5 months since the last commit (stale-bot
counts in seconds and naively assumes 30 days per month). When this happens, stale-bot
applies the “Close?” label to it. A maintainer can also fast-track its staleness by
manually applying the “Close?” label. Once marked as stale, a warning will be issued.</p>
<p>A maintainer can apply “keep-open” label or remove “Closed?” label to remove the
stale status. The pull request author (or maintainer) can reset the stale timer by
pushing out a commit (e.g., by rebasing). Otherwise, stale-bot will close the
pull request after about a month and apply a “closed-by-bot” label.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The “keep-open” label should be used very sparingly, only for pull requests that
<em>must</em> be kept open. For example, a pull request that has been completed but cannot be
merged until a blocker is removed can use this label. An abandoned or incomplete
pull request should not use this label as it can be re-opened later when the author
has a renewed interest to wrap it up.</p>
</div>
<p>When both “keep-open” and “Close?” labels exist, the former will take precedence
and the latter will be removed from the pull request. If maintainer removes “Close?”
without applying “keep-open” or pushing a new commit, stale-bot will mark it as
stale again in the next run.</p>
<p>If a new commit is pushed but the “Close?” label remains, stale-bot will close
it without another warning after another 4-5 months.</p>
<p>In short, to truly reset the stale timer for a pull request, it is recommended
that a new commit be pushed <em>and</em> the “Close?” label be removed.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Workflow for Maintainers</a><ul>
<li><a class="reference internal" href="#integrating-changes-via-the-web-interface-recommended">Integrating changes via the web interface (recommended)</a></li>
<li><a class="reference internal" href="#integrating-changes-manually">Integrating changes manually</a><ul>
<li><a class="reference internal" href="#a-few-commits">A few commits</a></li>
<li><a class="reference internal" href="#a-long-series-of-commits">A long series of commits</a></li>
<li><a class="reference internal" href="#check-the-history">Check the history</a></li>
<li><a class="reference internal" href="#push-to-trunk">Push to trunk</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-milestones-and-labels">Using Milestones and Labels</a></li>
<li><a class="reference internal" href="#updating-and-maintaining-the-changelog">Updating and Maintaining the Changelog</a></li>
<li><a class="reference internal" href="#stale-policies">Stale Policies</a><ul>
<li><a class="reference internal" href="#issues">Issues</a></li>
<li><a class="reference internal" href="#pull-requests">Pull Requests</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../_sources/development/workflow/maintainer_workflow.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 08 May 2022. <br/>
  </p>
</footer>
  </body>
</html>