


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>How to create and maintain a Python package using the Astropy template &#8212; Astropy v5.2.dev104+gcdd6a1f81.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Full Changelog" href="../changelog.html" />
    <link rel="prev" title="Workflow for Maintainers" href="workflow/maintainer_workflow.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../changelog.html" title="Full Changelog">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="workflow/maintainer_workflow.html" title="Workflow for Maintainers">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev104+gcdd6a1f81.d20220509</a>
	 &#187;
      </li>
      
      <li>How to create and maintain a Python package using the Astropy template</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-create-and-maintain-a-python-package-using-the-astropy-template">
<h1>How to create and maintain a Python package using the Astropy template<a class="headerlink" href="#how-to-create-and-maintain-a-python-package-using-the-astropy-template" title="Permalink to this headline">¶</a></h1>
<p>If you run into any problems, don’t hesitate to ask for help on the
astropy-dev mailing list!</p>
<p>The <a class="reference external" href="https://github.com/astropy/package-template">package-template</a> repository provides a template for Python
packages. This package design mirrors the layout of the main <a class="reference external" href="https://www.astropy.org">Astropy</a>
repository, as well as reusing much of the helper code used to organize
<a class="reference external" href="https://www.astropy.org">Astropy</a>. See the
<a class="reference external" href="https://docs.astropy.org/projects/package-template/en/latest/index.html#package-template" title="(in Astropy Package Template v1.2)"><span class="xref std std-ref">package template documentation</span></a>
for instructions on using the package template.</p>
<div class="section" id="releasing-a-python-package">
<span id="simple-release-docs"></span><h2>Releasing a Python package<a class="headerlink" href="#releasing-a-python-package" title="Permalink to this headline">¶</a></h2>
<p>You can release a package using the steps given below. In these
instructions, we assume that the release is made from a fresh clone of the
remote “main” repository and not from a forked copy. We also assume that
the changelog file is named <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code>, like for the astropy core
package. If instead you use Markdown, then you should replace <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code>
by <code class="docutils literal notranslate"><span class="pre">CHANGES.md</span></code> in the instructions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The instructions below assume that you do not make use of bug fix
branches in your workflow. If you do wish to create a bug fix branch,
we recommend that you read over the more complete astropy
<a class="reference internal" href="releasing.html"><span class="doc">Release procedure for the astropy core package</span></a> and adapt them for your package.</p>
</div>
<ol class="arabic">
<li><p>Make sure that continuous integration is passing.</p></li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code> file to make sure that all the changes are listed,
and update the release date, which should currently be set to
<code class="docutils literal notranslate"><span class="pre">unreleased</span></code>, to the current date in <code class="docutils literal notranslate"><span class="pre">yyyy-mm-dd</span></code> format.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> to remove any untracked files (WARNING: this will
permanently remove any files that have not been previously committed, so
make sure that you don’t need to keep any of these files).</p></li>
<li><p>At this point, the command to run to build the tar file will depend on
whether your package has a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file or not. If it does
not, then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span> <span class="n">sdist</span> <span class="o">--</span><span class="nb">format</span><span class="o">=</span><span class="n">gztar</span>
</pre></div>
</div>
<p>If it does, then first make sure the <a class="reference external" href="https://pypi.org/project/build/">build</a>
package is installed and up-to-date:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">build</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<p>then create the source distribution with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">build</span> <span class="o">--</span><span class="n">sdist</span> <span class="o">.</span>
</pre></div>
</div>
<p>All following instructions will assume you have <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.
If you do not use <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> yet, please see
<a class="reference external" href="https://docs.astropy.org/en/v3.2.x/development/astropy-package-template.html">https://docs.astropy.org/en/v3.2.x/development/astropy-package-template.html</a>
instead.</p>
<p>In both cases, make sure that generated file is good to go by going inside
<code class="docutils literal notranslate"><span class="pre">dist</span></code>, expanding the tar file, going inside the expanded directory, and
running the tests with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>
<span class="n">pytest</span>
</pre></div>
</div>
<p>You may need to add the <code class="docutils literal notranslate"><span class="pre">--remote-data</span></code> flag or any other flags that you
normally add when fully testing your package.</p>
</li>
<li><p>Go back to the root of the directory and remove the generated files with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clean</span> <span class="o">-</span><span class="n">fxd</span>
</pre></div>
</div>
</li>
<li><p>Add the changes to <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code> and <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="n">CHANGES</span><span class="o">.</span><span class="n">rst</span> <span class="n">setup</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>and commit with message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Preparing release &lt;version&gt;&quot;</span>
</pre></div>
</div>
</li>
<li><p>Tag commit with <code class="docutils literal notranslate"><span class="pre">v&lt;version&gt;</span></code>, optionally signing with the <code class="docutils literal notranslate"><span class="pre">-s</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">tag</span> <span class="n">v</span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> to next version number, but with a
<code class="docutils literal notranslate"><span class="pre">.dev</span></code> suffix at the end (e.g. <code class="docutils literal notranslate"><span class="pre">0.2.dev</span></code>). Add a new section to
<code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code> for next version, with a single entry <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">changes</span> <span class="pre">yet</span></code>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.2</span> <span class="p">(</span><span class="n">unreleased</span><span class="p">)</span>
<span class="o">----------------</span>

<span class="o">-</span> <span class="n">No</span> <span class="n">changes</span> <span class="n">yet</span>
</pre></div>
</div>
</li>
<li><p>Add the changes to <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code> and <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="n">CHANGES</span><span class="o">.</span><span class="n">rst</span> <span class="n">setup</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>and commit with message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Back to development: &lt;next_version&gt;&quot;</span>
</pre></div>
</div>
</li>
<li><p>Check out the release commit with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">v&lt;version&gt;</span></code>.
Run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> to remove any non-committed files.</p></li>
<li><p>(optional) Run the tests in an environment that mocks up a “typical user”
scenario. This is not strictly necessary because you ran the tests above, but
it can sometimes be useful to catch subtle bugs that might come from you
using a customized developer environment.  For more on setting up virtual
environments, see <a class="reference internal" href="workflow/virtual_pythons.html#virtual-envs"><span class="std std-ref">Python virtual environments</span></a>, but for the sake of example we will
assume you’re using <a class="reference external" href="https://conda.io/docs/">Anaconda</a>. Do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">myaffilpkg_rel_test</span> <span class="n">astropy</span> <span class="o">&lt;</span><span class="nb">any</span> <span class="n">more</span> <span class="n">dependencies</span> <span class="n">here</span><span class="o">&gt;</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">myaffilpkg_rel_test</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">build</span> <span class="o">--</span><span class="n">sdist</span> <span class="o">.</span>
<span class="n">cd</span> <span class="n">dist</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">myaffilpkg</span><span class="o">-</span><span class="n">version</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import myaffilpkg; myaffilpkg.test()&#39;</span>
<span class="n">source</span> <span class="n">deactivate</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">back</span> <span class="n">to</span> <span class="n">your</span> <span class="n">source</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You may want to repeat this for other combinations of dependencies if you think
your users might have other relevant packages installed.  Assuming the tests
all pass, you can proceed on.</p>
</li>
<li><p>If you did the previous step, do <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> again to remove anything
you made there.  Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">build</span> <span class="pre">--sdist</span> <span class="pre">.</span></code> to
create the files for upload.  Then you can upload to PyPI via <code class="docutils literal notranslate"><span class="pre">twine</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twine</span> <span class="n">upload</span> <span class="n">dist</span><span class="o">/*</span>
</pre></div>
</div>
<p>as described in <a class="reference external" href="https://packaging.python.org/en/latest/tutorials/packaging-projects/#uploading-the-distribution-archives">these</a>
instructions. Check that the entry on PyPI is correct, and that
the tarfile is present.</p>
</li>
<li><p>Go back to the main branch and push your changes to github:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">main</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="n">tags</span> <span class="n">origin</span> <span class="n">main</span>
</pre></div>
</div>
<p>Once you have done this, if you use Read the Docs, trigger a <code class="docutils literal notranslate"><span class="pre">latest</span></code> build
then go to the project settings, and under <strong>Versions</strong> you should see the
tag you just pushed. Select the tag to activate it, and save.</p>
</li>
<li><p>If your package is available in the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> conda channel, you
should also submit a pull request to update the version number in the
feedstock of your package.</p></li>
</ol>
<div class="section" id="modifications-for-a-beta-release-candidate-release">
<h3>Modifications for a beta/release candidate release<a class="headerlink" href="#modifications-for-a-beta-release-candidate-release" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Before a new release of your package, you may wish do a “pre-release” of the
code, for example to allow collaborators to independently test the release.
If the release you are performing is this kind of pre-release,
some of the above steps need to be modified.</p>
<p>The primary modifications to the release procedure is:</p>
<ul class="simple">
<li><p>When entering the new version number, instead of just removing the
<code class="docutils literal notranslate"><span class="pre">.dev</span></code>, enter “1.2b1” or “1.2rc1”.  It is critical that you follow this
numbering scheme (<code class="docutils literal notranslate"><span class="pre">X.Yb#</span></code> or <code class="docutils literal notranslate"><span class="pre">X.Y.Zrc#</span></code>), as it will ensure the release
is ordered “before” the main release by various automated tools, and also
tells PyPI that this is a “pre-release”.</p></li>
</ul>
</div></blockquote>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">How to create and maintain a Python package using the Astropy template</a><ul>
<li><a class="reference internal" href="#releasing-a-python-package">Releasing a Python package</a><ul>
<li><a class="reference internal" href="#modifications-for-a-beta-release-candidate-release">Modifications for a beta/release candidate release</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/development/astropy-package-template.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>