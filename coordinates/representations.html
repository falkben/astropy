


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using and Designing Coordinate Representations &#8212; Astropy v5.2.dev94+gb1133d712.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using and Designing Coordinate Frames" href="frames.html" />
    <link rel="prev" title="Separations, Offsets, Catalog Matching, and Related Functionality" href="matchsep.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="frames.html" title="Using and Designing Coordinate Frames">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="matchsep.html" title="Separations, Offsets, Catalog Matching, and Related Functionality">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev94+gb1133d712.d20220509</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Astronomical Coordinate Systems (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>)</a> &#187;</li>
      
      <li>Using and Designing Coordinate Representations</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-and-designing-coordinate-representations">
<span id="astropy-coordinates-representations"></span><h1>Using and Designing Coordinate Representations<a class="headerlink" href="#using-and-designing-coordinate-representations" title="Permalink to this headline">¶</a></h1>
<p>Points in a 3D vector space can be represented in different ways, such as
Cartesian, spherical polar, cylindrical, and so on. These underlie the way
coordinate data in <a class="reference internal" href="index.html#module-astropy.coordinates" title="astropy.coordinates"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.coordinates</span></code></a> is represented, as described in the
<a class="reference internal" href="index.html#astropy-coordinates-overview"><span class="std std-ref">Overview of astropy.coordinates Concepts</span></a>. Below, we describe how you can use them on
their own as a way to convert between different representations, including
ones not built-in, and to do simple vector arithmetic.</p>
<p>The built-in representation classes are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/astropy.coordinates.CartesianRepresentation.html#astropy.coordinates.CartesianRepresentation" title="astropy.coordinates.CartesianRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CartesianRepresentation</span></code></a>: Cartesian
coordinates <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code>.</p></li>
<li><p><a class="reference internal" href="../api/astropy.coordinates.SphericalRepresentation.html#astropy.coordinates.SphericalRepresentation" title="astropy.coordinates.SphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SphericalRepresentation</span></code></a>: spherical
polar coordinates represented by a longitude (<code class="docutils literal notranslate"><span class="pre">lon</span></code>), a latitude
(<code class="docutils literal notranslate"><span class="pre">lat</span></code>), and a distance (<code class="docutils literal notranslate"><span class="pre">distance</span></code>). The latitude is a value ranging
from -90 to 90 degrees.</p></li>
<li><p><a class="reference internal" href="../api/astropy.coordinates.UnitSphericalRepresentation.html#astropy.coordinates.UnitSphericalRepresentation" title="astropy.coordinates.UnitSphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UnitSphericalRepresentation</span></code></a>:
spherical polar coordinates on a unit sphere, represented by a longitude
(<code class="docutils literal notranslate"><span class="pre">lon</span></code>) and latitude (<code class="docutils literal notranslate"><span class="pre">lat</span></code>).</p></li>
<li><p><a class="reference internal" href="../api/astropy.coordinates.PhysicsSphericalRepresentation.html#astropy.coordinates.PhysicsSphericalRepresentation" title="astropy.coordinates.PhysicsSphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PhysicsSphericalRepresentation</span></code></a>:
spherical polar coordinates, represented by an inclination (<code class="docutils literal notranslate"><span class="pre">theta</span></code>) and
azimuthal angle (<code class="docutils literal notranslate"><span class="pre">phi</span></code>), and radius <code class="docutils literal notranslate"><span class="pre">r</span></code>. The inclination goes from 0 to
180 degrees, and is related to the latitude in the
<a class="reference internal" href="../api/astropy.coordinates.SphericalRepresentation.html#astropy.coordinates.SphericalRepresentation" title="astropy.coordinates.SphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SphericalRepresentation</span></code></a> by
<code class="docutils literal notranslate"><span class="pre">theta</span> <span class="pre">=</span> <span class="pre">90</span> <span class="pre">deg</span> <span class="pre">-</span> <span class="pre">lat</span></code>.</p></li>
<li><p><a class="reference internal" href="../api/astropy.coordinates.CylindricalRepresentation.html#astropy.coordinates.CylindricalRepresentation" title="astropy.coordinates.CylindricalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CylindricalRepresentation</span></code></a>:
cylindrical polar coordinates, represented by a cylindrical radius
(<code class="docutils literal notranslate"><span class="pre">rho</span></code>), azimuthal angle (<code class="docutils literal notranslate"><span class="pre">phi</span></code>), and height (<code class="docutils literal notranslate"><span class="pre">z</span></code>).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For information about using and changing the representation of
<a class="reference internal" href="../api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyCoord</span></code></a> objects, see the
<a class="reference internal" href="skycoord.html#astropy-skycoord-representations"><span class="std std-ref">Representations</span></a> section.</p>
</div>
<div class="section" id="instantiating-and-converting">
<h2>Instantiating and Converting<a class="headerlink" href="#instantiating-and-converting" title="Permalink to this headline">¶</a></h2>
<p>Representation classes are instantiated with <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a>
objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates.representation</span> <span class="kn">import</span> <span class="n">CartesianRepresentation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car</span> <span class="o">=</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in kpc</span>
<span class="go">    (3., 5., 4.)&gt;</span>
</pre></div>
</div>
<p>Array <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> objects can also be passed to
representations. They will have the expected shape, which can be changed using
methods with the same names as those for <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></a>, such as <code class="docutils literal notranslate"><span class="pre">reshape</span></code>,
<code class="docutils literal notranslate"><span class="pre">ravel</span></code>, etc.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]],</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.</span><span class="p">]],</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.</span><span class="p">]],</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span> <span class="o">=</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [[(1.,  0.,   0.), (0.,  2.,   0.), (0.,  0.,   3.)],</span>
<span class="go">     [(3.,  4.,   0.), (5.,  0.,  12.), (3., -4., -12.)]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [(1.,  0.,   0.), (0.,  2.,   0.), (0.,  0.,   3.), (3.,  4.,   0.),</span>
<span class="go">     (5.,  0.,  12.), (3., -4., -12.)]&gt;</span>
</pre></div>
</div>
<p>Representations can be converted to other representations using the
<code class="docutils literal notranslate"><span class="pre">represent_as</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates.representation</span> <span class="kn">import</span> <span class="n">SphericalRepresentation</span><span class="p">,</span> <span class="n">CylindricalRepresentation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">SphericalRepresentation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (1.03037683, 0.60126422, 7.07106781)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cyl</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">CylindricalRepresentation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cyl</span>  
<span class="go">&lt;CylindricalRepresentation (rho, phi, z) in (kpc, rad, kpc)</span>
<span class="go">    (5.83095189, 1.03037683, 4.)&gt;</span>
</pre></div>
</div>
<p>All representations can be converted to each other without loss of
information, with the exception of
<a class="reference internal" href="../api/astropy.coordinates.UnitSphericalRepresentation.html#astropy.coordinates.UnitSphericalRepresentation" title="astropy.coordinates.UnitSphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UnitSphericalRepresentation</span></code></a>. This class
is used to store the longitude and latitude of points but does not contain
any distance to the points, and assumes that they are located on a unit and
dimensionless sphere:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates.representation</span> <span class="kn">import</span> <span class="n">UnitSphericalRepresentation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_unit</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">UnitSphericalRepresentation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_unit</span>  
<span class="go">&lt;UnitSphericalRepresentation (lon, lat) in rad</span>
<span class="go">    (1.03037683, 0.60126422)&gt;</span>
</pre></div>
</div>
<p>Converting back to Cartesian, the absolute scaling information has been
removed, and the points are still located on a unit sphere:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sph_unit</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">UnitSphericalRepresentation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_unit</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">CartesianRepresentation</span><span class="p">)</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) [dimensionless]</span>
<span class="go">    (0.42426407, 0.70710678, 0.56568542)&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="array-values-and-numpy-array-method-analogs">
<h2>Array Values and NumPy Array Method Analogs<a class="headerlink" href="#array-values-and-numpy-array-method-analogs" title="Permalink to this headline">¶</a></h2>
<p>Array <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> objects can also be passed to representations,
and such representations can be sliced, reshaped, etc., using the same methods
as are available to <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></a>. Corresponding functions, as well as
others that affect the shape, such as <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.atleast_1d.html#numpy.atleast_1d" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">atleast_1d</span></code></a> and
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.rollaxis.html#numpy.rollaxis" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollaxis</span></code></a>, work as expected.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>To pass array <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> objects to representations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">20.</span><span class="p">,</span> <span class="mf">25.</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span> <span class="o">=</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">z</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span>
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [(0., 10., 20.), (1., 11., 21.), (2., 12., 22.),</span>
<span class="go">     (3., 13., 23.), (4., 14., 24.), (5., 15., 25.)]&gt;</span>
</pre></div>
</div>
<p>To manipulate using methods and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [[(0., 10., 20.), (1., 11., 21.)],</span>
<span class="go">     [(2., 12., 22.), (3., 13., 23.)],</span>
<span class="go">     [(4., 14., 24.), (5., 15., 25.)]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    (2., 12., 22.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">car_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [(0., 10., 20.), (1., 11., 21.), (1., 11., 21.)]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">car_array</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [(5., 15., 25.), (0., 10., 20.), (1., 11., 21.), (1., 11., 21.),</span>
<span class="go">     (3., 13., 23.), (4., 14., 24.)]&gt;</span>
</pre></div>
</div>
<p>And to set elements using other representation classes (as long
as they are compatible in their units and number of dimensions):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SphericalRepresentation</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">99</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [(0., 10., 20.), (1., 11., 21.), (99., 0., 0.)]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">UnitSphericalRepresentation</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">value must be representable as CartesianRepresentation without loss of information.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vector-arithmetic">
<span id="astropy-coordinates-representations-arithmetic"></span><h2>Vector Arithmetic<a class="headerlink" href="#vector-arithmetic" title="Permalink to this headline">¶</a></h2>
<p>Representations support basic vector arithmetic such as taking the norm,
multiplying with and dividing by quantities, and taking dot and cross products,
as well as adding, subtracting, summing and taking averages of representations,
and multiplying with matrices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All arithmetic except the matrix multiplication works with
non-Cartesian representations as well. For taking the norm, multiplication,
and division, this uses just the non-angular components, while for the other
operations the representation is converted to Cartesian internally before
the operation is done, and the result is converted back to the original
representation. Hence, for optimal speed it may be best to work using
Cartesian representations.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>To see how vector arithmetic operations work with representation objects,
consider the following examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span> <span class="o">=</span> <span class="n">CartesianRepresentation</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">]]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.</span><span class="p">]]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">12.</span><span class="p">,</span><span class="o">-</span><span class="mf">12.</span><span class="p">]]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [[(1.,  0.,  0.), (0.,  2.,   0.), (0.,  0.,   3.)],</span>
<span class="go">     [(3.,  4.,  0.), (5.,  0.,  12.), (3., -4., -12.)]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>  
<span class="go">&lt;Quantity [[ 1.,  2.,  3.],</span>
<span class="go">           [ 5., 13., 13.]] m&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span> <span class="o">/</span> <span class="n">car_array</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) [dimensionless]</span>
<span class="go">    [[(1.        ,  0.        ,  0.        ),</span>
<span class="go">      (0.        ,  1.        ,  0.        ),</span>
<span class="go">      (0.        ,  0.        ,  1.        )],</span>
<span class="go">     [(0.6       ,  0.8       ,  0.        ),</span>
<span class="go">      (0.38461538,  0.        ,  0.92307692),</span>
<span class="go">      (0.23076923, -0.30769231, -0.92307692)]]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">car_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">car_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">10.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m / s</span>
<span class="go">    [(0.2,  0.4,  0. ), (0.5, -0.2,  1.2), (0.3, -0.4, -1.5)]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    (12.,  2.,  3.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [(2. ,  2.,  0. ), (2.5,  1.,  6. ), (1.5, -2., -4.5)]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">unit_x</span> <span class="o">=</span> <span class="n">UnitSphericalRepresentation</span><span class="p">(</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unit_y</span> <span class="o">=</span> <span class="n">UnitSphericalRepresentation</span><span class="p">(</span><span class="mf">90.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unit_z</span> <span class="o">=</span> <span class="n">UnitSphericalRepresentation</span><span class="p">(</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mf">90.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">unit_x</span><span class="p">)</span>  
<span class="go">&lt;Quantity [[1., 0., 0.],</span>
<span class="go">           [3., 5., 3.]] m&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">unit_y</span><span class="p">)</span>  
<span class="go">&lt;Quantity [[ 6.12323400e-17,  2.00000000e+00,  0.00000000e+00],</span>
<span class="go">           [ 4.00000000e+00,  3.06161700e-16, -4.00000000e+00]] m&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">unit_z</span><span class="p">)</span>  
<span class="go">&lt;Quantity [[ 6.12323400e-17,  0.00000000e+00,  3.00000000e+00],</span>
<span class="go">           [ 1.83697020e-16,  1.20000000e+01, -1.20000000e+01]] m&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">unit_x</span><span class="p">)</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [[(0.,  0.,  0.), (0.,   0., -2.), (0.,   3.,  0.)],</span>
<span class="go">     [(0.,  0., -4.), (0.,  12.,  0.), (0., -12.,  4.)]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates.matrix_utilities</span> <span class="kn">import</span> <span class="n">rotation_matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_matrix</span><span class="p">(</span><span class="mi">90</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rotation</span>  
<span class="go">array([[ 6.12323400e-17,  1.00000000e+00,  0.00000000e+00],</span>
<span class="go">       [-1.00000000e+00,  6.12323400e-17,  0.00000000e+00],</span>
<span class="go">       [ 0.00000000e+00,  0.00000000e+00,  1.00000000e+00]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">car_array</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in m</span>
<span class="go">    [[( 6.12323400e-17, -1.00000000e+00,   0.),</span>
<span class="go">      ( 2.00000000e+00,  1.22464680e-16,   0.),</span>
<span class="go">      ( 0.00000000e+00,  0.00000000e+00,   3.)],</span>
<span class="go">     [( 4.00000000e+00, -3.00000000e+00,   0.),</span>
<span class="go">      ( 3.06161700e-16, -5.00000000e+00,  12.),</span>
<span class="go">      (-4.00000000e+00, -3.00000000e+00, -12.)]]&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="differentials-and-derivatives-of-representations">
<span id="astropy-coordinates-differentials"></span><h2>Differentials and Derivatives of Representations<a class="headerlink" href="#differentials-and-derivatives-of-representations" title="Permalink to this headline">¶</a></h2>
<p>In addition to positions in 3D space, coordinates also deal with proper motions
and radial velocities, which require a way to represent differentials of
coordinates (i.e., finite realizations) of derivatives. To support this, the
representations all have corresponding <code class="docutils literal notranslate"><span class="pre">Differential</span></code> classes, which can hold
offsets or derivatives in terms of the components of the representation class.
Adding such an offset to a representation means the offset is taken in the
direction of the corresponding coordinate. (Although for any representation
other than Cartesian, this is only defined relative to a specific location, as
the unit vectors are not invariant.)</p>
<div class="section" id="id1">
<h3>Examples<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>To see how the <code class="docutils literal notranslate"><span class="pre">Differential</span></code> classes of representations works, consider the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SphericalRepresentation</span><span class="p">,</span> <span class="n">SphericalDifferential</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">=</span> <span class="n">SphericalRepresentation</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="gp">... </span>                                  <span class="n">distance</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_derivative</span> <span class="o">=</span> <span class="n">SphericalDifferential</span><span class="p">(</span><span class="n">d_lon</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="gp">... </span>                                       <span class="n">d_lat</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="gp">... </span>                                       <span class="n">d_distance</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_derivative</span><span class="o">.</span><span class="n">to_cartesian</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">sph_coo</span><span class="p">)</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in arcsec kpc / (rad yr)</span>
<span class="go">    (0., 1., 0.)&gt;</span>
</pre></div>
</div>
<p>Note how the conversion to Cartesian can only be done using a <code class="docutils literal notranslate"><span class="pre">base</span></code>, since
otherwise the code cannot know what direction an increase in longitude
corresponds to. For <code class="docutils literal notranslate"><span class="pre">lon=0</span></code>, this is in the <code class="docutils literal notranslate"><span class="pre">y</span></code> direction. Now, to get
the coordinates at two later times:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">+</span> <span class="n">sph_derivative</span> <span class="o">*</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">3600</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    [(4.84813681e-06, 0., 1.        ), (7.85398163e-01, 0., 1.41421356)]&gt;</span>
</pre></div>
</div>
<p>The above shows how addition is not to longitude itself, but in the direction
of increasing longitude: for the large shift, by the equivalent of one radian,
the distance has increased as well (after all, a source will likely not move
along a curve on the sky!). This also means that the order of operations is
important:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">big_offset</span> <span class="o">=</span> <span class="n">SphericalDifferential</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">+</span> <span class="n">big_offset</span> <span class="o">+</span> <span class="n">big_offset</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (1.57079633, 0., 2.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">+</span> <span class="p">(</span><span class="n">big_offset</span> <span class="o">+</span> <span class="n">big_offset</span><span class="p">)</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (1.10714872, 0., 2.23606798)&gt;</span>
</pre></div>
</div>
<p>Often, you may have just a proper motion or a radial velocity, but not both:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">UnitSphericalDifferential</span><span class="p">,</span> <span class="n">RadialDifferential</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radvel</span> <span class="o">=</span> <span class="n">RadialDifferential</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">+</span> <span class="n">radvel</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Myr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (0., 0., 2.02271217)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm</span> <span class="o">=</span> <span class="n">UnitSphericalDifferential</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">+</span> <span class="n">pm</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Myr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (0.0048481, 0., 1.00001175)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm</span> <span class="o">+</span> <span class="n">radvel</span>  
<span class="go">&lt;SphericalDifferential (d_lon, d_lat, d_distance) in (mas / yr, mas / yr, km / s)</span>
<span class="go">    (1., 0., 1000.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_coo</span> <span class="o">+</span> <span class="p">(</span><span class="n">pm</span> <span class="o">+</span> <span class="n">radvel</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Myr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (0.00239684, 0., 2.02271798)&gt;</span>
</pre></div>
</div>
<p>Note in the above that the proper motion is defined strictly as a change in
longitude (i.e., it does not include a <code class="docutils literal notranslate"><span class="pre">cos(latitude)</span></code> term). There are
special classes where this term is included:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">UnitSphericalCosLatDifferential</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_lat60</span> <span class="o">=</span> <span class="n">SphericalRepresentation</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mf">60.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="n">distance</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm</span> <span class="o">=</span> <span class="n">UnitSphericalDifferential</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm</span>  
<span class="go">&lt;UnitSphericalDifferential (d_lon, d_lat) in mas / yr</span>
<span class="go">    (1., 0.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm_coslat</span> <span class="o">=</span> <span class="n">UnitSphericalCosLatDifferential</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span> <span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm_coslat</span>  
<span class="go">&lt;UnitSphericalCosLatDifferential (d_lon_coslat, d_lat) in mas / yr</span>
<span class="go">    (1., 0.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_lat60</span> <span class="o">+</span> <span class="n">pm</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Myr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (0.0048481, 1.04719246, 1.00000294)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_lat60</span> <span class="o">+</span> <span class="n">pm_coslat</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Myr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (0.00969597, 1.0471772, 1.00001175)&gt;</span>
</pre></div>
</div>
<p>Close inspections shows that indeed the changes are as expected. The systems
with and without <code class="docutils literal notranslate"><span class="pre">cos(latitude)</span></code> can be converted to each other, provided you
supply the <code class="docutils literal notranslate"><span class="pre">base</span></code> (representation):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usph_lat60</span> <span class="o">=</span> <span class="n">sph_lat60</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">UnitSphericalRepresentation</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm_coslat2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">UnitSphericalCosLatDifferential</span><span class="p">,</span>
<span class="gp">... </span>                             <span class="n">base</span><span class="o">=</span><span class="n">usph_lat60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pm_coslat2</span>  
<span class="go">&lt;UnitSphericalCosLatDifferential (d_lon_coslat, d_lat) in mas / yr</span>
<span class="go">    (0.5, 0.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sph_lat60</span> <span class="o">+</span> <span class="n">pm_coslat2</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Myr</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, kpc)</span>
<span class="go">    (0.0048481, 1.04719246, 1.00000294)&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At present, the differential classes are generally meant to work with
first derivatives, but they do not check the units of the inputs to enforce
this. Passing in second derivatives (e.g., acceleration values with
acceleration units) will succeed, but any transformations that occur through
re-representation of the differential will not necessarily be correct.</p>
</div>
</div>
</div>
<div class="section" id="attaching-differential-objects-to-representation-objects">
<h2>Attaching <code class="docutils literal notranslate"><span class="pre">Differential</span></code> Objects to <code class="docutils literal notranslate"><span class="pre">Representation</span></code> Objects<a class="headerlink" href="#attaching-differential-objects-to-representation-objects" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Differential</span></code> objects can be attached to <code class="docutils literal notranslate"><span class="pre">Representation</span></code> objects as a way
to encapsulate related information into a single object. <code class="docutils literal notranslate"><span class="pre">Differential</span></code>
objects can be passed in to the initializer of any of the built-in
<code class="docutils literal notranslate"><span class="pre">Representation</span></code> classes.</p>
<div class="section" id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>To store a single velocity differential with a position:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">representation</span> <span class="k">as</span> <span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dif</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">SphericalDifferential</span><span class="p">(</span><span class="n">d_lon</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="n">d_lat</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="n">d_distance</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">SphericalRepresentation</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">distance</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">differentials</span><span class="o">=</span><span class="n">dif</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (deg, deg, kpc)</span>
<span class="go">    (0., 0., 1.)</span>
<span class="go"> (has differentials w.r.t.: &#39;s&#39;)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">differentials</span>  
<span class="go">{&#39;s&#39;: &lt;SphericalDifferential (d_lon, d_lat, d_distance) in (mas / yr, mas / yr, km / s)</span>
<span class="go">     (1., 2., 3.)&gt;}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Differential</span></code> objects are stored as a Python dictionary on the
<code class="docutils literal notranslate"><span class="pre">Representation</span></code> object with keys equal to the (string) unit with which the
differential derivatives are taken (converted to SI).</p>
<p>In this case the key is <code class="docutils literal notranslate"><span class="pre">'s'</span></code> (second) because the <code class="docutils literal notranslate"><span class="pre">Differential</span></code> units are
velocities, a time derivative. Passing a single differential to the
<code class="docutils literal notranslate"><span class="pre">Representation</span></code> initializer will automatically generate the necessary key
and store it in the differentials dictionary, but a dictionary is required to
specify multiple differentials:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dif2</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">SphericalDifferential</span><span class="p">(</span><span class="n">d_lon</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">d_lat</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">d_distance</span><span class="o">=</span><span class="mi">6</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">SphericalRepresentation</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">distance</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">differentials</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">dif</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">:</span> <span class="n">dif2</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span>  
<span class="go">&lt;SphericalDifferential (d_lon, d_lat, d_distance) in (mas / yr, mas / yr, km / s)</span>
<span class="go">    (1., 2., 3.)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">&#39;s2&#39;</span><span class="p">]</span>  
<span class="go">&lt;SphericalDifferential (d_lon, d_lat, d_distance) in (mas / yr2, mas / yr2, km / s2)</span>
<span class="go">    (4., 5., 6.)&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Differential</span></code> objects can also be attached to a <code class="docutils literal notranslate"><span class="pre">Representation</span></code> after
creation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">CartesianRepresentation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dif</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">CartesianDifferential</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">with_differentials</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in kpc</span>
<span class="go">    (1., 2., 3.)</span>
<span class="go"> (has differentials w.r.t.: &#39;s&#39;)&gt;</span>
</pre></div>
</div>
<p>This works for array data as well, as long as the shape of the
<code class="docutils literal notranslate"><span class="pre">Differential</span></code> data is the same as that of the <code class="docutils literal notranslate"><span class="pre">Representation</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">au</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">CartesianRepresentation</span><span class="p">(</span><span class="o">*</span><span class="n">xyz</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dif</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">CartesianDifferential</span><span class="p">(</span><span class="o">*</span><span class="n">d_xyz</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">with_differentials</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in AU</span>
<span class="go">    [(0., 4.,  8.), (1., 5.,  9.), (2., 6., 10.), (3., 7., 11.)]</span>
<span class="go"> (has differentials w.r.t.: &#39;s&#39;)&gt;</span>
</pre></div>
</div>
<p>As with a <code class="docutils literal notranslate"><span class="pre">Representation</span></code> instance without a differential, to convert the
positional data to a new representation, use the <code class="docutils literal notranslate"><span class="pre">.represent_as()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">SphericalRepresentation</span><span class="p">)</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, AU)</span>
<span class="go">    [(1.57079633, 1.10714872,  8.94427191),</span>
<span class="go">     (1.37340077, 1.05532979, 10.34408043),</span>
<span class="go">     (1.24904577, 1.00685369, 11.83215957),</span>
<span class="go">     (1.16590454, 0.96522779, 13.37908816)]&gt;</span>
</pre></div>
</div>
<p>However, by passing just the desired representation class, only the
<code class="docutils literal notranslate"><span class="pre">Representation</span></code> has changed, and the differentials are dropped. To
re-represent both the <code class="docutils literal notranslate"><span class="pre">Representation</span></code> and any <code class="docutils literal notranslate"><span class="pre">Differential</span></code> objects, you
must specify target classes for the <code class="docutils literal notranslate"><span class="pre">Differential</span></code> as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rep2</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">SphericalRepresentation</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">SphericalDifferential</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep2</span>  
<span class="go">&lt;SphericalRepresentation (lon, lat, distance) in (rad, rad, AU)</span>
<span class="go">  [(1.57079633, 1.10714872,  8.94427191),</span>
<span class="go">   (1.37340077, 1.05532979, 10.34408043),</span>
<span class="go">   (1.24904577, 1.00685369, 11.83215957),</span>
<span class="go">   (1.16590454, 0.96522779, 13.37908816)]</span>
<span class="go"> (has differentials w.r.t.: &#39;s&#39;)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep2</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span>  
<span class="go">&lt;SphericalDifferential (d_lon, d_lat, d_distance) in (km rad / (AU s), km rad / (AU s), km / s)</span>
<span class="go">    [( 6.12323400e-17, 1.11022302e-16,  8.94427191),</span>
<span class="go">     (-2.77555756e-17, 5.55111512e-17, 10.34408043),</span>
<span class="go">     ( 0.00000000e+00, 0.00000000e+00, 11.83215957),</span>
<span class="go">     ( 5.55111512e-17, 0.00000000e+00, 13.37908816)]&gt;</span>
</pre></div>
</div>
<p>Shape-changing operations (e.g., reshapes) are propagated to all
<code class="docutils literal notranslate"><span class="pre">Differential</span></code> objects because they are guaranteed to have the same shape as
their host <code class="docutils literal notranslate"><span class="pre">Representation</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rep</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rep</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rep</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 2)</span>
</pre></div>
</div>
<p>This also works for slicing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_rep</span> <span class="o">=</span> <span class="n">rep</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rep</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rep</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2,)</span>
</pre></div>
</div>
<p>Operations on representations that return <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> objects (as
opposed to other <code class="docutils literal notranslate"><span class="pre">Representation</span></code> instances) still work, but only operate on
the positional information, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>  
<span class="go">&lt;Quantity [ 8.94427191, 10.34408043, 11.83215957, 13.37908816] AU&gt;</span>
</pre></div>
</div>
<p>Operations that involve combining or scaling representations or pairs of
representation objects that contain differentials will currently fail, but
support for some operations may be added in future versions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rep</span> <span class="o">+</span> <span class="n">rep</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">Operation &#39;add&#39; is not supported when differentials are attached to a CartesianRepresentation.</span>
</pre></div>
</div>
<p>If you have a <code class="docutils literal notranslate"><span class="pre">Representation</span></code> with attached <code class="docutils literal notranslate"><span class="pre">Differential</span></code> objects, you
can retrieve a copy of the <code class="docutils literal notranslate"><span class="pre">Representation</span></code> without the <code class="docutils literal notranslate"><span class="pre">Differential</span></code>
object and use this <code class="docutils literal notranslate"><span class="pre">Differential</span></code>-free object for any arithmetic operation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">15</span> <span class="o">*</span> <span class="n">rep</span><span class="o">.</span><span class="n">without_differentials</span><span class="p">()</span>  
<span class="go">&lt;CartesianRepresentation (x, y, z) in AU</span>
<span class="go">    [( 0.,  60., 120.), (15.,  75., 135.), (30.,  90., 150.),</span>
<span class="go">     (45., 105., 165.)]&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-your-own-representations">
<span id="astropy-coordinates-create-repr"></span><h2>Creating Your Own Representations<a class="headerlink" href="#creating-your-own-representations" title="Permalink to this headline">¶</a></h2>
<p>To create your own representation class, your class must inherit from the
<a class="reference internal" href="../api/astropy.coordinates.BaseRepresentation.html#astropy.coordinates.BaseRepresentation" title="astropy.coordinates.BaseRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseRepresentation</span></code></a> class. This base has an <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
method that will put all arguments components through their initializers,
verify they can be broadcast against each other, and store the components on
<code class="docutils literal notranslate"><span class="pre">self</span></code> as the name prefixed with ‘_’. Furthermore, through its metaclass it
provides default properties for the components so that they can be accessed
using <code class="docutils literal notranslate"><span class="pre">&lt;instance&gt;.&lt;component&gt;</span></code>. For the machinery to work, the following
must be defined:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">attr_classes</span></code> class attribute (<code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code>):</p>
<p>Defines through its keys the names of the components (as well as the default
order), and through its values defines the class of which they should be
instances (which should be <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> or a subclass, or
anything that can initialize it).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_cartesian</span></code> class method:</p>
<p>Takes a <a class="reference internal" href="../api/astropy.coordinates.CartesianRepresentation.html#astropy.coordinates.CartesianRepresentation" title="astropy.coordinates.CartesianRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CartesianRepresentation</span></code></a> object and
returns an instance of your class.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_cartesian</span></code> method:</p>
<p>Returns a <a class="reference internal" href="../api/astropy.coordinates.CartesianRepresentation.html#astropy.coordinates.CartesianRepresentation" title="astropy.coordinates.CartesianRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CartesianRepresentation</span></code></a> object.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code> method (optional):</p>
<p>If you want more than the basic initialization and checks provided by the
base representation class, or just an explicit signature, you can define your
own <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. In general, it is recommended to stay close to the
signature assumed by the base representation, <code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">comp1,</span> <span class="pre">comp2,</span>
<span class="pre">comp3,</span> <span class="pre">copy=True)</span></code>, and use <code class="docutils literal notranslate"><span class="pre">super</span></code> to call the base representation
initializer.</p>
</li>
</ul>
<p>Once you do this, you will then automatically be able to call <code class="docutils literal notranslate"><span class="pre">represent_as</span></code>
to convert other representations to/from your representation class. Your
representation will also be available for use in <a class="reference internal" href="../api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="astropy.coordinates.SkyCoord"><code class="xref py py-class docutils literal notranslate"><span class="pre">SkyCoord</span></code></a> and all frame
classes.</p>
<p>A representation class may also have a <code class="docutils literal notranslate"><span class="pre">_unit_representation</span></code> attribute
(although it is not required). This attribute points to the appropriate
“unit” representation (i.e., a representation that is dimensionless). This is
probably only meaningful for subclasses of
<a class="reference internal" href="../api/astropy.coordinates.SphericalRepresentation.html#astropy.coordinates.SphericalRepresentation" title="astropy.coordinates.SphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SphericalRepresentation</span></code></a>, where it is assumed that it
will be a subclass of <a class="reference internal" href="../api/astropy.coordinates.UnitSphericalRepresentation.html#astropy.coordinates.UnitSphericalRepresentation" title="astropy.coordinates.UnitSphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UnitSphericalRepresentation</span></code></a>.</p>
<p>Finally, if you wish to also use offsets in your coordinate system, two further
methods should be defined (please see
<a class="reference internal" href="../api/astropy.coordinates.SphericalRepresentation.html#astropy.coordinates.SphericalRepresentation" title="astropy.coordinates.SphericalRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SphericalRepresentation</span></code></a> for an example):</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unit_vectors</span></code> method:</p>
<p>Returns a <code class="docutils literal notranslate"><span class="pre">dict</span></code> with a
<a class="reference internal" href="../api/astropy.coordinates.CartesianRepresentation.html#astropy.coordinates.CartesianRepresentation" title="astropy.coordinates.CartesianRepresentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CartesianRepresentation</span></code></a> of unit vectors in the
direction of each component.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale_factors</span></code> method:</p>
<p>Returns a <code class="docutils literal notranslate"><span class="pre">dict</span></code> with a <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> for each component with
the appropriate physical scale factor for a unit change in that direction.</p>
</li>
</ul>
<p>And furthermore you should define a <code class="docutils literal notranslate"><span class="pre">Differential</span></code> class based on
<a class="reference internal" href="../api/astropy.coordinates.BaseDifferential.html#astropy.coordinates.BaseDifferential" title="astropy.coordinates.BaseDifferential"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseDifferential</span></code></a>. This class only needs to define:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">base_representation</span></code> attribute:</p>
<p>A link back to the representation for which this differential holds.</p>
</li>
</ul>
<p>In pseudo-code, this means that a class will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyRepresentation</span><span class="p">(</span><span class="n">BaseRepresentation</span><span class="p">):</span>

    <span class="n">attr_classes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;comp1&#39;</span><span class="p">,</span> <span class="n">ComponentClass1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;comp2&#39;</span><span class="p">,</span> <span class="n">ComponentClass2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;comp3&#39;</span><span class="p">,</span> <span class="n">ComponentClass3</span><span class="p">)])</span>

    <span class="c1"># __init__ is optional</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">,</span> <span class="n">comp3</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">,</span> <span class="n">comp3</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>
        <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cartesian</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">MyRepresentation</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="c1"># if differential motion is needed</span>
    <span class="k">def</span> <span class="nf">unit_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;comp1&#39;</span><span class="p">:</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
                <span class="s1">&#39;comp2&#39;</span><span class="p">:</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
                <span class="s1">&#39;comp3&#39;</span><span class="p">:</span> <span class="n">CartesianRepresentation</span><span class="p">(</span><span class="o">...</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">scale_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;comp1&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
                <span class="s1">&#39;comp2&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
                <span class="s1">&#39;comp3&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyDifferential</span><span class="p">(</span><span class="n">BaseDifferential</span><span class="p">):</span>
    <span class="n">base_representation</span> <span class="o">=</span> <span class="n">MyRepresentation</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Using and Designing Coordinate Representations</a><ul>
<li><a class="reference internal" href="#instantiating-and-converting">Instantiating and Converting</a></li>
<li><a class="reference internal" href="#array-values-and-numpy-array-method-analogs">Array Values and NumPy Array Method Analogs</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vector-arithmetic">Vector Arithmetic</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#differentials-and-derivatives-of-representations">Differentials and Derivatives of Representations</a><ul>
<li><a class="reference internal" href="#id1">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attaching-differential-objects-to-representation-objects">Attaching <code class="docutils literal notranslate"><span class="pre">Differential</span></code> Objects to <code class="docutils literal notranslate"><span class="pre">Representation</span></code> Objects</a><ul>
<li><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-your-own-representations">Creating Your Own Representations</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/coordinates/representations.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 08 May 2022. <br/>
  </p>
</footer>
  </body>
</html>