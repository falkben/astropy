


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subclassing &#8212; Astropy v5.2.dev96+g04a0cf8bb</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="add_array" href="../api/astropy.nddata.add_array.html" />
    <link rel="prev" title="I/O Mixin" href="mixins/ndio.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../api/astropy.nddata.add_array.html" title="add_array">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="mixins/ndio.html" title="I/O Mixin">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev96+g04a0cf8bb</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">N-Dimensional Datasets (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.nddata</span></code>)</a> &#187;</li>
      
      <li>Subclassing</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="subclassing">
<span id="nddata-subclassing"></span><h1>Subclassing<a class="headerlink" href="#subclassing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="nddata">
<h2><a class="reference internal" href="../api/astropy.nddata.NDData.html#astropy.nddata.NDData" title="astropy.nddata.NDData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDData</span></code></a><a class="headerlink" href="#nddata" title="Permalink to this headline">¶</a></h2>
<p>This class serves as the base for subclasses that use a <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> (or
something that presents a <code class="docutils literal notranslate"><span class="pre">numpy</span></code>-like interface) as the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each attribute is saved as an attribute with one leading underscore. For
example, the <code class="docutils literal notranslate"><span class="pre">data</span></code> is saved as <code class="docutils literal notranslate"><span class="pre">_data</span></code> and the <code class="docutils literal notranslate"><span class="pre">mask</span></code> as <code class="docutils literal notranslate"><span class="pre">_mask</span></code>,
and so on.</p>
</div>
<div class="section" id="adding-another-property">
<h3>Adding Another Property<a class="headerlink" href="#adding-another-property" title="Permalink to this headline">¶</a></h3>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDData</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithFlags</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Remove flags attribute if given and pass it to the setter.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;flags&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@flags</span><span class="o">.</span><span class="n">setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">flags</span>
<span class="go">[0, 0.2, 0.3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To simplify subclassing, each setter (except for <code class="docutils literal notranslate"><span class="pre">data</span></code>) is called during
<code class="docutils literal notranslate"><span class="pre">__init__</span></code> so putting restrictions on any attribute can be done inside
the setter and will also apply during instance creation.</p>
</div>
</div>
<div class="section" id="customize-the-setter-for-a-property">
<h3>Customize the Setter for a Property<a class="headerlink" href="#customize-the-setter-for-a-property" title="Permalink to this headline">¶</a></h3>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataMaskBoolNumpy</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@NDData</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Convert mask to boolean numpy array.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataMaskBoolNumpy</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([ True, False,  True]...)</span>
</pre></div>
</div>
</div>
<div class="section" id="extend-the-setter-for-a-property">
<h3>Extend the Setter for a Property<a class="headerlink" href="#extend-the-setter-for-a-property" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">unit</span></code>, <code class="docutils literal notranslate"><span class="pre">meta</span></code>, and <code class="docutils literal notranslate"><span class="pre">uncertainty</span></code> implement some additional logic in their
setter so subclasses might define a call to the superclass and let the
super property set the attribute afterwards:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataUncertaintyShapeChecker</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@NDData</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;uncertainty must have the same shape as the data.&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># Call the setter of the super class in case it might contain some</span>
<span class="gp">... </span>        <span class="c1"># important logic (only True for meta, unit and uncertainty)</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">NDDataUncertaintyShapeChecker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># Unlike &quot;super(cls_name, cls_name).uncertainty.fset&quot; or</span>
<span class="gp">... </span>        <span class="c1"># or &quot;NDData.uncertainty.fset&quot; this will respect Pythons method</span>
<span class="gp">... </span>        <span class="c1"># resolution order.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataUncertaintyShapeChecker</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">uncertainty</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="go">INFO: uncertainty should have attribute uncertainty_type. [astropy.nddata.nddata]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">UnknownUncertainty([2, 3, 4])</span>
</pre></div>
</div>
</div>
<div class="section" id="having-a-setter-for-the-data">
<h3>Having a Setter for the Data<a class="headerlink" href="#having-a-setter-for-the-data" title="Permalink to this headline">¶</a></h3>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithDataSetter</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@NDData</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithDataSetter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span>
<span class="go">array([3, 2, 1])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nddataref">
<span id="id1"></span><h2><a class="reference internal" href="../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataRef</span></code></a><a class="headerlink" href="#nddataref" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataRef</span></code></a> itself inherits from <a class="reference internal" href="../api/astropy.nddata.NDData.html#astropy.nddata.NDData" title="astropy.nddata.NDData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDData</span></code></a> so
any of the possibilities there also apply to NDDataRef. But NDDataRef also
inherits from the Mixins:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/astropy.nddata.NDSlicingMixin.html#astropy.nddata.NDSlicingMixin" title="astropy.nddata.NDSlicingMixin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDSlicingMixin</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin" title="astropy.nddata.NDArithmeticMixin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDArithmeticMixin</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/astropy.nddata.NDIOMixin.html#astropy.nddata.NDIOMixin" title="astropy.nddata.NDIOMixin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDIOMixin</span></code></a></p></li>
</ul>
<p>Which allow additional operations.</p>
<div class="section" id="add-another-arithmetic-operation">
<h3>Add Another Arithmetic Operation<a class="headerlink" href="#add-another-arithmetic-operation" title="Permalink to this headline">¶</a></h3>
<p>Adding another operation is possible provided the <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">unit</span></code> allow
it within the framework of <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a>.</p>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<p>To add a power function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.utils</span> <span class="kn">import</span> <span class="n">sharedmethod</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataPower</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@sharedmethod</span> <span class="c1"># sharedmethod to allow it also as classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">operand2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># the uncertainty doesn&#39;t allow propagation so set it to None</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;propagate_uncertainties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="c1"># Call the _prepare_then_do_arithmetic function with the</span>
<span class="gp">... </span>        <span class="c1"># numpy.power ufunc.</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_then_do_arithmetic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span>
<span class="gp">... </span>                                                <span class="n">operand2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be used like the other arithmetic methods similar to
<a class="reference internal" href="../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.add" title="astropy.nddata.NDArithmeticMixin.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>. So it works when calling it
on the class or the instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataPower</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using it on the instance with one operand</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">NDDataPower([ 1,  8, 27])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using it on the instance with two operands</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">pow</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="go">NDDataPower([  1,  16, 243])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># or using it as classmethod</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NDDataPower</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">NDDataPower([  6,  36, 216])</span>
</pre></div>
</div>
<p>To allow propagation also with <code class="docutils literal notranslate"><span class="pre">uncertainty</span></code> see subclassing
<a class="reference internal" href="../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty" title="astropy.nddata.NDUncertainty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDUncertainty</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_prepare_then_do_arithmetic</span></code> implements the relevant checks if it was
called on the class or the instance, and if one or two operands were given,
converts the operands, if necessary, to the appropriate classes. Overriding
<code class="docutils literal notranslate"><span class="pre">_prepare_then_do_arithmetic</span></code> in subclasses should be avoided if
possible.</p>
</div>
</div>
<div class="section" id="arithmetic-on-an-existing-property">
<h3>Arithmetic on an Existing Property<a class="headerlink" href="#arithmetic-on-an-existing-property" title="Permalink to this headline">¶</a></h3>
<p>Customizing how an existing property is handled during arithmetic is possible
with some arguments to the function calls such as
<a class="reference internal" href="../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.add" title="astropy.nddata.NDArithmeticMixin.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>, but it is possible to hardcode
behavior too. The actual operation on the attribute (except for <code class="docutils literal notranslate"><span class="pre">unit</span></code>) is
done in a method <code class="docutils literal notranslate"><span class="pre">_arithmetic_*</span></code> where <code class="docutils literal notranslate"><span class="pre">*</span></code> is the name of the property.</p>
<div class="section" id="id2">
<h4>Examples<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>To customize how the <code class="docutils literal notranslate"><span class="pre">meta</span></code> will be affected during arithmetics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithMetaArithmetics</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_arithmetic_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">handle_mask</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># the function must take the arguments:</span>
<span class="gp">... </span>        <span class="c1"># operation (numpy-ufunc like np.add, np.subtract, ...)</span>
<span class="gp">... </span>        <span class="c1"># operand (the other NDData-like object, already wrapped as NDData)</span>
<span class="gp">... </span>        <span class="c1"># handle_mask (see description for &quot;add&quot;)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># The meta is dict like but we want the keywords exposure to change</span>
<span class="gp">... </span>        <span class="c1"># Anticipate that one or both might have no meta and take the first one that has</span>
<span class="gp">... </span>        <span class="n">result_meta</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="k">else</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">operand</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># Do the operation on the keyword if the keyword exists</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">result_meta</span> <span class="ow">and</span> <span class="s1">&#39;exposure&#39;</span> <span class="ow">in</span> <span class="n">result_meta</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">result_meta</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="n">result_meta</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">],</span> <span class="n">operand</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">result_meta</span> <span class="c1"># return it</span>
</pre></div>
</div>
<p>To trigger this method, the <code class="docutils literal notranslate"><span class="pre">handle_meta</span></code> argument to arithmetic methods can
be anything except <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;first_found&quot;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithMetaArithmetics</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;exposure&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">ndd</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span><span class="o">.</span><span class="n">meta</span>
<span class="go">{&#39;exposure&#39;: 20}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span> <span class="o">=</span> <span class="n">ndd</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span><span class="o">.</span><span class="n">meta</span>
<span class="go">{&#39;exposure&#39;: 5.0}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To use these internal <code class="xref py py-obj docutils literal notranslate"><span class="pre">_arithmetic_*</span></code> methods there are some restrictions on
the attributes when calling the operation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code>: <code class="docutils literal notranslate"><span class="pre">handle_mask</span></code> must not be <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ff&quot;</span></code>, or
<code class="docutils literal notranslate"><span class="pre">&quot;first_found&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wcs</span></code>: <code class="docutils literal notranslate"><span class="pre">compare_wcs</span></code> argument with the same restrictions as mask.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meta</span></code>: <code class="docutils literal notranslate"><span class="pre">handle_meta</span></code> argument with the same restrictions as mask.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uncertainty</span></code>: <code class="docutils literal notranslate"><span class="pre">propagate_uncertainties</span></code> must be <code class="docutils literal notranslate"><span class="pre">None</span></code> or evaluate
to <code class="docutils literal notranslate"><span class="pre">False</span></code>. <code class="docutils literal notranslate"><span class="pre">arithmetic_uncertainty</span></code> must also accept different
arguments: <code class="docutils literal notranslate"><span class="pre">operation</span></code>, <code class="docutils literal notranslate"><span class="pre">operand</span></code>, <code class="docutils literal notranslate"><span class="pre">result</span></code>, <code class="docutils literal notranslate"><span class="pre">correlation</span></code>,
<code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="changing-the-default-argument-for-arithmetic-operations">
<h3>Changing the Default Argument for Arithmetic Operations<a class="headerlink" href="#changing-the-default-argument-for-arithmetic-operations" title="Permalink to this headline">¶</a></h3>
<p>If the goal is to change the default value of an existing parameter for
arithmetic methods, such as when explicitly specifying the parameter each
time you call an arithmetic operation is too much effort, you can change the
default value of existing parameters by changing it in the method signature of
<code class="docutils literal notranslate"><span class="pre">_arithmetic</span></code>.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>To change the default value of an existing parameter for arithmetic methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDDiffAritDefaults</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_arithmetic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Changing the default of handle_mask to None</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="s1">&#39;handle_mask&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;handle_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="c1"># Call the original with the updated kwargs</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_arithmetic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDDiffAritDefaults</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDDiffAritDefaults</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="c1"># it will be None</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But giving other values is still possible:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="s2">&quot;ff&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">False</span>
</pre></div>
</div>
<p>The parameter controlling how properties are handled are all keyword-only
so using the <code class="docutils literal notranslate"><span class="pre">*args</span></code>, <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> approach allows you to only alter one
default without needing to care about the positional order of arguments.</p>
</div>
</div>
<div class="section" id="arithmetic-with-an-additional-property">
<h3>Arithmetic with an Additional Property<a class="headerlink" href="#arithmetic-with-an-additional-property" title="Permalink to this headline">¶</a></h3>
<p>This also requires overriding the <code class="docutils literal notranslate"><span class="pre">_arithmetic</span></code> method. Suppose we have a
<code class="docutils literal notranslate"><span class="pre">flags</span></code> attribute again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithFlags</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Remove flags attribute if given and pass it to the setter.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;flags&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@flags</span><span class="o">.</span><span class="n">setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_arithmetic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># take all args and kwargs to allow arithmetic on the other properties</span>
<span class="gp">... </span>        <span class="c1"># to work like before.</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># do the arithmetics on the flags (pop the relevant kwargs, if any!!!)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">operand</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">result_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="n">operand</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
<span class="gp">... </span>            <span class="c1"># np.logical_or is just a suggestion you can do what you want</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>                <span class="n">result_flags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>                <span class="n">result_flags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">operand</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c1"># Let the superclass do all the other attributes note that</span>
<span class="gp">... </span>        <span class="c1"># this returns the result and a dictionary containing other attributes</span>
<span class="gp">... </span>        <span class="n">result</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_arithmetic</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># The arguments for creating a new instance are saved in kwargs</span>
<span class="gp">... </span>        <span class="c1"># so we need to add another keyword &quot;flags&quot; and add the processed flags</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_flags</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">kwargs</span> <span class="c1"># these must be returned</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span> <span class="o">=</span> <span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span><span class="o">.</span><span class="n">flags</span>
<span class="go">array([ True, False,  True]...)</span>
</pre></div>
</div>
</div>
<div class="section" id="slicing-an-existing-property">
<h3>Slicing an Existing Property<a class="headerlink" href="#slicing-an-existing-property" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have a class expecting a 2D <code class="docutils literal notranslate"><span class="pre">data</span></code> but the mask is
only 1D. This would lead to problems if you were to slice in two dimensions.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataMask1D</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_slice_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Multidimensional slices are represented by tuples:</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="gp">... </span>            <span class="c1"># only use the first dimension of the slice</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">... </span>        <span class="c1"># Let the superclass deal with the other cases</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_slice_mask</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataMask1D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nddsliced</span> <span class="o">=</span> <span class="n">ndd</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nddsliced</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([ True,  True]...)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The methods slicing the attributes are prefixed by a <code class="docutils literal notranslate"><span class="pre">_slice_*</span></code> where <code class="docutils literal notranslate"><span class="pre">*</span></code>
can be <code class="docutils literal notranslate"><span class="pre">mask</span></code>, <code class="docutils literal notranslate"><span class="pre">uncertainty</span></code>, or <code class="docutils literal notranslate"><span class="pre">wcs</span></code>. So overriding them is the
most convenient way to customize how the attributes are sliced.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If slicing should affect the <code class="docutils literal notranslate"><span class="pre">unit</span></code> or <code class="docutils literal notranslate"><span class="pre">meta</span></code> see the next example.</p>
</div>
</div>
<div class="section" id="slicing-an-additional-property">
<h3>Slicing an Additional Property<a class="headerlink" href="#slicing-an-additional-property" title="Permalink to this headline">¶</a></h3>
<p>Building on the added property <code class="docutils literal notranslate"><span class="pre">flags</span></code>, we want them to be sliceable:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithFlags</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Remove flags attribute if given and pass it to the setter.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;flags&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@flags</span><span class="o">.</span><span class="n">setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># slice all normal attributes</span>
<span class="gp">... </span>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_slice</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c1"># The arguments for creating a new instance are saved in kwargs</span>
<span class="gp">... </span>        <span class="c1"># so we need to add another keyword &quot;flags&quot; and add the sliced flags</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">kwargs</span> <span class="c1"># these must be returned</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">ndd</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span><span class="o">.</span><span class="n">flags</span>
<span class="go">[0.2, 0.3]</span>
</pre></div>
</div>
<p>If you wanted to keep just the original <code class="docutils literal notranslate"><span class="pre">flags</span></code> instead of the sliced ones,
you could use <code class="docutils literal notranslate"><span class="pre">kwargs['flags']</span> <span class="pre">=</span> <span class="pre">self.flags</span></code> and omit the <code class="docutils literal notranslate"><span class="pre">[item]</span></code>.</p>
</div>
</div>
<div class="section" id="nddatabase">
<h2><a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataBase</span></code></a><a class="headerlink" href="#nddatabase" title="Permalink to this headline">¶</a></h2>
<p>The class <a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataBase</span></code></a> is a metaclass — when subclassing it,
all properties of <a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataBase</span></code></a> <em>must</em> be overridden in the
subclass.</p>
<p>Subclassing from <a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataBase</span></code></a> gives you complete flexibility
in how you implement data storage and the other properties. If your data is
stored in a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array (or something that behaves like a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array),
it may be more convenient to subclass <a class="reference internal" href="../api/astropy.nddata.NDData.html#astropy.nddata.NDData" title="astropy.nddata.NDData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDData</span></code></a> instead of
<a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataBase</span></code></a>.</p>
<div class="section" id="id3">
<h3>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>To implement the NDDataBase interface by creating a read-only container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataBase</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataReadOnlyNoRestrictions</span><span class="p">(</span><span class="n">NDDataBase</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">wcs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">unit</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">mask</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="o">=</span> <span class="n">uncertainty</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">meta</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wcs</span> <span class="o">=</span> <span class="n">wcs</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wcs</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># A meaningless test to show that creating this class is possible:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NDDataReadOnlyNoRestrictions</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Actually defining an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> is not necessary and the properties could
return arbitrary values but the properties <strong>must</strong> be defined.</p>
</div>
</div>
</div>
<div class="section" id="subclassing-nduncertainty">
<h2>Subclassing <a class="reference internal" href="../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty" title="astropy.nddata.NDUncertainty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDUncertainty</span></code></a><a class="headerlink" href="#subclassing-nduncertainty" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The internal interface of NDUncertainty and subclasses is experimental and
might change in future versions.</p>
</div>
<p>Subclasses deriving from <a class="reference internal" href="../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty" title="astropy.nddata.NDUncertainty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDUncertainty</span></code></a> need in order to
implement:</p>
<ul class="simple">
<li><p>Property <code class="docutils literal notranslate"><span class="pre">uncertainty_type</span></code> should return a string describing the
uncertainty, for example, <code class="docutils literal notranslate"><span class="pre">&quot;ivar&quot;</span></code> for inverse variance.</p></li>
<li><p>Methods for propagation: <code class="xref py py-obj docutils literal notranslate"><span class="pre">_propagate_*</span></code> where <code class="docutils literal notranslate"><span class="pre">*</span></code> is the name of the
universal function (ufunc) that is used on the <code class="docutils literal notranslate"><span class="pre">NDData</span></code> parent.</p></li>
</ul>
<div class="section" id="creating-an-uncertainty-without-propagation">
<h3>Creating an Uncertainty without Propagation<a class="headerlink" href="#creating-an-uncertainty-without-propagation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../api/astropy.nddata.UnknownUncertainty.html#astropy.nddata.UnknownUncertainty" title="astropy.nddata.UnknownUncertainty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">UnknownUncertainty</span></code></a> is a minimal working implementation
without error propagation. We can create an uncertainty by storing
systematic uncertainties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDUncertainty</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SystematicUncertainty</span><span class="p">(</span><span class="n">NDUncertainty</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;systematic&#39;</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_data_unit_to_uncertainty_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">SystematicUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">])</span>
<span class="go">SystematicUncertainty([10])</span>
</pre></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Subclassing</a><ul>
<li><a class="reference internal" href="#nddata"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDData</span></code></a><ul>
<li><a class="reference internal" href="#adding-another-property">Adding Another Property</a></li>
<li><a class="reference internal" href="#customize-the-setter-for-a-property">Customize the Setter for a Property</a></li>
<li><a class="reference internal" href="#extend-the-setter-for-a-property">Extend the Setter for a Property</a></li>
<li><a class="reference internal" href="#having-a-setter-for-the-data">Having a Setter for the Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nddataref"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataRef</span></code></a><ul>
<li><a class="reference internal" href="#add-another-arithmetic-operation">Add Another Arithmetic Operation</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arithmetic-on-an-existing-property">Arithmetic on an Existing Property</a><ul>
<li><a class="reference internal" href="#id2">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changing-the-default-argument-for-arithmetic-operations">Changing the Default Argument for Arithmetic Operations</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arithmetic-with-an-additional-property">Arithmetic with an Additional Property</a></li>
<li><a class="reference internal" href="#slicing-an-existing-property">Slicing an Existing Property</a></li>
<li><a class="reference internal" href="#slicing-an-additional-property">Slicing an Additional Property</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nddatabase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NDDataBase</span></code></a><ul>
<li><a class="reference internal" href="#id3">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subclassing-nduncertainty">Subclassing <code class="xref py py-obj docutils literal notranslate"><span class="pre">NDUncertainty</span></code></a><ul>
<li><a class="reference internal" href="#creating-an-uncertainty-without-propagation">Creating an Uncertainty without Propagation</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/nddata/subclassing.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>