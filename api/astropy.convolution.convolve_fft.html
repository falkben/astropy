


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>convolve_fft &#8212; Astropy v5.2.dev94+gb1133d712.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="convolve_models" href="astropy.convolution.convolve_models.html" />
    <link rel="prev" title="convolve" href="astropy.convolution.convolve.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="astropy.convolution.convolve_models.html" title="convolve_models">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="astropy.convolution.convolve.html" title="convolve">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev94+gb1133d712.d20220509</a>
	 &#187;
      </li>
      <li><a href="../convolution/index.html" accesskey="U">Convolution and Filtering (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.convolution</span></code>)</a> &#187;</li>
      
      <li>convolve_fft</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="convolve-fft">
<h1>convolve_fft<a class="headerlink" href="#convolve-fft" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="astropy.convolution.convolve_fft">
<code class="sig-prename descclassname"><span class="pre">astropy.convolution.</span></code><code class="sig-name descname"><span class="pre">convolve_fft</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="pre">array</span></em>, <em class="sig-param"><span class="pre">kernel</span></em>, <em class="sig-param"><span class="pre">boundary='fill'</span></em>, <em class="sig-param"><span class="pre">fill_value=0.0</span></em>, <em class="sig-param"><span class="pre">nan_treatment='interpolate'</span></em>, <em class="sig-param"><span class="pre">normalize_kernel=True</span></em>, <em class="sig-param"><span class="pre">normalization_zero_tol=1e-08</span></em>, <em class="sig-param"><span class="pre">preserve_nan=False</span></em>, <em class="sig-param"><span class="pre">mask=None</span></em>, <em class="sig-param"><span class="pre">crop=True</span></em>, <em class="sig-param"><span class="pre">return_fft=False</span></em>, <em class="sig-param"><span class="pre">fft_pad=None</span></em>, <em class="sig-param"><span class="pre">psf_pad=None</span></em>, <em class="sig-param"><span class="pre">min_wt=0.0</span></em>, <em class="sig-param"><span class="pre">allow_huge=False</span></em>, <em class="sig-param"><span class="pre">fftn=&lt;function</span> <span class="pre">fftn&gt;</span></em>, <em class="sig-param"><span class="pre">ifftn=&lt;function</span> <span class="pre">ifftn&gt;</span></em>, <em class="sig-param"><span class="pre">complex_dtype=&lt;class</span> <span class="pre">'complex'&gt;</span></em>, <em class="sig-param"><span class="pre">dealias=False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/astropy/convolution/convolve.html#convolve_fft"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#astropy.convolution.convolve_fft" title="Permalink to this definition">¶</a></dt>
<dd><p>Convolve an ndarray with an nd-kernel.  Returns a convolved image with
<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">array.shape</span></code>.  Assumes kernel is centered.</p>
<p><a class="reference internal" href="#astropy.convolution.convolve_fft" title="astropy.convolution.convolve_fft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolve_fft</span></code></a> is very similar to <a class="reference internal" href="astropy.convolution.convolve.html#astropy.convolution.convolve" title="astropy.convolution.convolve"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolve</span></code></a> in that it replaces <code class="docutils literal notranslate"><span class="pre">NaN</span></code>
values in the original image with interpolated values using the kernel as
an interpolation function.  However, it also includes many additional
options specific to the implementation.</p>
<p><a class="reference internal" href="#astropy.convolution.convolve_fft" title="astropy.convolution.convolve_fft"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolve_fft</span></code></a> differs from <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.fftconvolve.html#scipy.signal.fftconvolve" title="(in SciPy v1.8.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal.fftconvolve</span></code></a> in a few ways:</p>
<ul class="simple">
<li><p>It can treat <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values as zeros or interpolate over them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inf</span></code> values are treated as <code class="docutils literal notranslate"><span class="pre">NaN</span></code></p></li>
<li><p>It optionally pads to the nearest faster sizes to improve FFT speed.
These sizes are optimized for the numpy and scipy implementations, and
<code class="docutils literal notranslate"><span class="pre">fftconvolve</span></code> uses them by default as well; when using other external
functions (see below), results may vary.</p></li>
<li><p>Its only valid <code class="docutils literal notranslate"><span class="pre">mode</span></code> is ‘same’ (i.e., the same shape array is returned)</p></li>
<li><p>It lets you use your own fft, e.g.,
<a class="reference external" href="https://pypi.org/project/pyFFTW/">pyFFTW</a> or
<a class="reference external" href="https://pypi.org/project/PyFFTW3/0.2.1/">pyFFTW3</a> , which can lead to
performance improvements, depending on your system configuration.  pyFFTW3
is threaded, and therefore may yield significant performance benefits on
multi-core machines at the cost of greater memory requirements.  Specify
the <code class="docutils literal notranslate"><span class="pre">fftn</span></code> and <code class="docutils literal notranslate"><span class="pre">ifftn</span></code> keywords to override the default, which is
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.fft.fftn.html#numpy.fft.fftn" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.fft.fftn</span></code></a> and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.fft.ifftn.html#numpy.fft.ifftn" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.fft.ifftn</span></code></a>.  The <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/fft.html#module-scipy.fft" title="(in SciPy v1.8.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.fft</span></code></a> functions also
offer somewhat better performance and a multi-threaded option.</p></li>
</ul>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>array</strong><span class="classifier"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a></span></dt><dd><p>Array to be convolved with <code class="docutils literal notranslate"><span class="pre">kernel</span></code>.  It can be of any
dimensionality, though only 1, 2, and 3d arrays have been tested.</p>
</dd>
<dt><strong>kernel</strong><span class="classifier"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> or <a class="reference internal" href="astropy.convolution.Kernel.html#astropy.convolution.Kernel" title="astropy.convolution.Kernel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.convolution.Kernel</span></code></a></span></dt><dd><p>The convolution kernel. The number of dimensions should match those
for the array.  The dimensions <em>do not</em> have to be odd in all directions,
unlike in the non-fft <a class="reference internal" href="astropy.convolution.convolve.html#astropy.convolution.convolve" title="astropy.convolution.convolve"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolve</span></code></a> function.  The kernel will be
normalized if <code class="docutils literal notranslate"><span class="pre">normalize_kernel</span></code> is set.  It is assumed to be centered
(i.e., shifts may result if your kernel is asymmetric)</p>
</dd>
<dt><strong>boundary</strong><span class="classifier">{‘fill’, ‘wrap’}, optional</span></dt><dd><p>A flag indicating how to handle boundaries:</p>
<blockquote>
<div><ul class="simple">
<li><p>‘fill’: set values outside the array boundary to fill_value
(default)</p></li>
<li><p>‘wrap’: periodic boundary</p></li>
</ul>
</div></blockquote>
<p>The <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> and ‘extend’ parameters are not supported for FFT-based
convolution.</p>
</dd>
<dt><strong>fill_value</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">float</span></code></a>, optional</span></dt><dd><p>The value to use outside the array when using boundary=’fill’.</p>
</dd>
<dt><strong>nan_treatment</strong><span class="classifier">{‘interpolate’, ‘fill’}, optional</span></dt><dd><dl class="simple">
<dt>The method used to handle NaNs in the input <code class="docutils literal notranslate"><span class="pre">array</span></code>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'interpolate'</span></code>: <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values are replaced with
interpolated values using the kernel as an interpolation
function. Note that if the kernel has a sum equal to
zero, NaN interpolation is not possible and will raise an
exception.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'fill'</span></code>: <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values are replaced by <code class="docutils literal notranslate"><span class="pre">fill_value</span></code>
prior to convolution.</p></li>
</ul>
</dd>
</dl>
</dd>
<dt><strong>normalize_kernel</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">callable()</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>If specified, this is the function to divide kernel by to normalize it.
e.g., <code class="docutils literal notranslate"><span class="pre">normalize_kernel=np.sum</span></code> means that kernel will be modified to be:
<code class="docutils literal notranslate"><span class="pre">kernel</span> <span class="pre">=</span> <span class="pre">kernel</span> <span class="pre">/</span> <span class="pre">np.sum(kernel)</span></code>.  If True, defaults to
<code class="docutils literal notranslate"><span class="pre">normalize_kernel</span> <span class="pre">=</span> <span class="pre">np.sum</span></code>.</p>
</dd>
<dt><strong>normalization_zero_tol</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">float</span></code></a>, optional</span></dt><dd><p>The absolute tolerance on whether the kernel is different than zero.
If the kernel sums to zero to within this precision, it cannot be
normalized. Default is “1e-8”.</p>
</dd>
<dt><strong>preserve_nan</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>After performing convolution, should pixels that were originally NaN
again become NaN?</p>
</dd>
<dt><strong>mask</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a> or <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></a>, optional</span></dt><dd><p>A “mask” array.  Shape must match <code class="docutils literal notranslate"><span class="pre">array</span></code>, and anything that is masked
(i.e., not 0/<a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>) will be set to NaN for the convolution.  If
<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, no masking will be performed unless <code class="docutils literal notranslate"><span class="pre">array</span></code> is a masked array.
If <code class="docutils literal notranslate"><span class="pre">mask</span></code> is not <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> <em>and</em> <code class="docutils literal notranslate"><span class="pre">array</span></code> is a masked array, a pixel is
masked of it is masked in either <code class="docutils literal notranslate"><span class="pre">mask</span></code> <em>or</em> <code class="docutils literal notranslate"><span class="pre">array.mask</span></code>.</p>
</dd>
<dt><strong>crop</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Default on.  Return an image of the size of the larger of the input
image and the kernel.
If the image and kernel are asymmetric in opposite directions, will
return the largest image in both directions.
For example, if an input image has shape [100,3] but a kernel with shape
[6,6] is used, the output will be [100,6].</p>
</dd>
<dt><strong>return_fft</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Return the <code class="docutils literal notranslate"><span class="pre">fft(image)*fft(kernel)</span></code> instead of the convolution (which is
<code class="docutils literal notranslate"><span class="pre">ifft(fft(image)*fft(kernel))</span></code>).  Useful for making PSDs.</p>
</dd>
<dt><strong>fft_pad</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Default on.  Zero-pad image to the nearest size supporting more efficient
execution of the FFT, generally values factorizable into the first 3-5
prime numbers.  With <code class="docutils literal notranslate"><span class="pre">boundary='wrap'</span></code>, this will be disabled.</p>
</dd>
<dt><strong>psf_pad</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Zero-pad image to be at least the sum of the image sizes to avoid
edge-wrapping when smoothing.  This is enabled by default with
<code class="docutils literal notranslate"><span class="pre">boundary='fill'</span></code>, but it can be overridden with a boolean option.
<code class="docutils literal notranslate"><span class="pre">boundary='wrap'</span></code> and <code class="docutils literal notranslate"><span class="pre">psf_pad=True</span></code> are not compatible.</p>
</dd>
<dt><strong>min_wt</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">float</span></code></a>, optional</span></dt><dd><p>If ignoring <code class="docutils literal notranslate"><span class="pre">NaN</span></code> / zeros, force all grid points with a weight less than
this value to <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (the weight of a grid point with <em>no</em> ignored
neighbors is 1.0).
If <code class="docutils literal notranslate"><span class="pre">min_wt</span></code> is zero, then all zero-weight points will be set to zero
instead of <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (which they would be otherwise, because 1/0 = nan).
See the examples below.</p>
</dd>
<dt><strong>allow_huge</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.10)"><span class="xref std std-ref">bool</span></a>, optional</span></dt><dd><p>Allow huge arrays in the FFT?  If False, will raise an exception if the
array or kernel size is &gt;1 GB.</p>
</dd>
<dt><strong>fftn</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">callable()</span></code></a>, optional</span></dt><dd><p>The fft function.  Can be overridden to use your own ffts,
e.g. an fftw3 wrapper or scipy’s fftn, <code class="docutils literal notranslate"><span class="pre">fft=scipy.fftpack.fftn</span></code>.</p>
</dd>
<dt><strong>ifftn</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.10)"><code class="docutils literal notranslate"><span class="pre">callable()</span></code></a>, optional</span></dt><dd><p>The inverse fft function. Can be overridden the same way <code class="docutils literal notranslate"><span class="pre">fttn</span></code>.</p>
</dd>
<dt><strong>complex_dtype</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">complex</span></code></a> type, optional</span></dt><dd><p>Which complex dtype to use.  <a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span></code></a> has a range of options, from 64 to
256.</p>
</dd>
<dt><strong>dealias: bool, optional</strong></dt><dd><p>Default off. Zero-pad image to enable explicit dealiasing
of convolution. With <code class="docutils literal notranslate"><span class="pre">boundary='wrap'</span></code>, this will be disabled.
Note that for an input of nd dimensions this will increase
the size of the temporary arrays by at least <code class="docutils literal notranslate"><span class="pre">1.5**nd</span></code>.
This may result in significantly more memory usage.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl>
<dt><strong>default</strong><span class="classifier"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.22)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></a></span></dt><dd><p><code class="docutils literal notranslate"><span class="pre">array</span></code> convolved with <code class="docutils literal notranslate"><span class="pre">kernel</span></code>.  If <code class="docutils literal notranslate"><span class="pre">return_fft</span></code> is set, returns
<code class="docutils literal notranslate"><span class="pre">fft(array)</span> <span class="pre">*</span> <span class="pre">fft(kernel)</span></code>.  If crop is not set, returns the
image, but with the fft-padded size instead of the input size.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ValueError</span></code></a></dt><dd><p>If the array is bigger than 1 GB after padding, will raise this
exception unless <code class="docutils literal notranslate"><span class="pre">allow_huge</span></code> is True.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="astropy.convolution.convolve.html#astropy.convolution.convolve" title="astropy.convolution.convolve"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolve</span></code></a></dt><dd><p>Convolve is a non-fft version of this code.  It is more memory efficient and for small kernels can be faster.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>With <code class="docutils literal notranslate"><span class="pre">psf_pad=True</span></code> and a large PSF, the resulting data
can become large and consume a lot of memory. See Issue
<a class="reference external" href="https://github.com/astropy/astropy/pull/4366">https://github.com/astropy/astropy/pull/4366</a> and the update in
<a class="reference external" href="https://github.com/astropy/astropy/pull/11533">https://github.com/astropy/astropy/pull/11533</a> for further details.</p>
<p>Dealiasing of pseudospectral convolutions is necessary for
numerical stability of the underlying algorithms. A common
method for handling this is to zero pad the image by at least
1/2 to eliminate the wavenumbers which have been aliased
by convolution. This is so that the aliased 1/3 of the
results of the convolution computation can be thrown out. See
<a class="reference external" href="https://doi.org/10.1175/1520-0469(1971)028%3C1074:OTEOAI%3E2.0.CO;2">https://doi.org/10.1175/1520-0469(1971)028%3C1074:OTEOAI%3E2.0.CO;2</a>
<a class="reference external" href="https://iopscience.iop.org/article/10.1088/1742-6596/318/7/072037">https://iopscience.iop.org/article/10.1088/1742-6596/318/7/072037</a></p>
<p>Note that if dealiasing is necessary to your application, but your
process is memory constrained, you may want to consider using
FFTW++: <a class="reference external" href="https://github.com/dealias/fftwpp">https://github.com/dealias/fftwpp</a>. It includes python
wrappers for a pseudospectral convolution which will implicitly
dealias your convolution without the need for additional padding.
Note that one cannot use FFTW++’s convlution directly in this
method as in handles the entire convolution process internally.
Additionally, FFTW++ includes other useful pseudospectral methods to
consider.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="go">array([0.33333333, 1.33333333, 1.        ])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="go">array([0.5, 2. , 1.5])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  
<span class="go">array([ 1.00000000e+00, -3.70074342e-17,  3.00000000e+00])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">array([1., 2., 3.])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">nan_treatment</span><span class="o">=</span><span class="s1">&#39;interpolate&#39;</span><span class="p">)</span>
<span class="go">array([1., 0., 3.])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">nan_treatment</span><span class="o">=</span><span class="s1">&#39;interpolate&#39;</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">min_wt</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="go">array([ 1., nan,  3.])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nan_treatment</span><span class="o">=</span><span class="s1">&#39;interpolate&#39;</span><span class="p">)</span>
<span class="go">array([0.5, 2. , 1.5])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nan_treatment</span><span class="o">=</span><span class="s1">&#39;interpolate&#39;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">normalize_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">array([0.5, 2. , 1.5])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.fft</span>  <span class="c1"># optional - requires scipy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nan_treatment</span><span class="o">=</span><span class="s1">&#39;interpolate&#39;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">normalize_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">fftn</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftn</span><span class="p">,</span> <span class="n">ifftn</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftn</span><span class="p">)</span>
<span class="go">array([0.5, 2. , 1.5])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fft_mp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># use all available cores</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ifft_mp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convolve_fft</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nan_treatment</span><span class="o">=</span><span class="s1">&#39;interpolate&#39;</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">normalize_kernel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fftn</span><span class="o">=</span><span class="n">fft_mp</span><span class="p">,</span> <span class="n">ifftn</span><span class="o">=</span><span class="n">ifft_mp</span><span class="p">)</span>
<span class="go">array([0.5, 2. , 1.5])</span>
</pre></div>
</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">convolve_fft</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/astropy.convolution.convolve_fft.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>