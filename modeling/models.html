


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Models &#8212; Astropy v5.2.dev96+g04a0cf8bb</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Combining Models" href="compound-models.html" />
    <link rel="prev" title="Models and Fitting (astropy.modeling)" href="index.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="compound-models.html" title="Combining Models">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="index.html" title="Models and Fitting (astropy.modeling)">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev96+g04a0cf8bb</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Models and Fitting (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.modeling</span></code>)</a> &#187;</li>
      
      <li>Models</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="models">
<span id="id1"></span><h1>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basics">
<span id="basics-models"></span><h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="reference_api.html#module-astropy.modeling" title="astropy.modeling"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.modeling</span></code></a> package defines a number of models that are collected
under a single namespace as <code class="docutils literal notranslate"><span class="pre">astropy.modeling.models</span></code>.  Models behave like
parametrized functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">Model: Gaussian1D</span>
<span class="go">Inputs: (&#39;x&#39;,)</span>
<span class="go">Outputs: (&#39;y&#39;,)</span>
<span class="go">Model set size: 1</span>
<span class="go">Parameters:</span>
<span class="go">    amplitude mean stddev</span>
<span class="go">    --------- ---- ------</span>
<span class="go">          1.2  0.9    0.5</span>
</pre></div>
</div>
<p>Model parameters can be accessed as attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">amplitude</span>
<span class="go">Parameter(&#39;amplitude&#39;, value=1.2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">mean</span>
<span class="go">Parameter(&#39;mean&#39;, value=0.9)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">stddev</span>  
<span class="go">Parameter(&#39;stddev&#39;, value=0.5, bounds=(1.1754943508222875e-38, None))</span>
</pre></div>
</div>
<p>and can also be updated via those attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">amplitude</span>
<span class="go">Parameter(&#39;amplitude&#39;, value=0.8)</span>
</pre></div>
</div>
<p>Models can be evaluated by calling them as functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="go">0.22242984036255528</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>  
<span class="go">array([0.58091923, 0.71746405, 0.7929204 , 0.78415894, 0.69394278,</span>
<span class="go">       0.54952605, 0.3894018 ])</span>
</pre></div>
</div>
<p>As the above example demonstrates, in general most models evaluate array-like
inputs according to the standard <a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html">Numpy broadcasting rules</a> for arrays.
Models can therefore already be useful to evaluate common functions,
independently of the fitting features of the package.</p>
<div class="section" id="instantiating-and-evaluating-models">
<span id="modeling-instantiating"></span><h3>Instantiating and Evaluating Models<a class="headerlink" href="#instantiating-and-evaluating-models" title="Permalink to this headline">¶</a></h3>
<p>In general, models are instantiated by supplying the parameter values that
define that instance of the model to the constructor, as demonstrated in
the section on <a class="reference internal" href="parameters.html#modeling-parameters"><span class="std std-ref">Parameters</span></a>.</p>
<p>Additionally, a <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model</span></code></a> instance may represent a single model
with one set of parameters, or a <a class="reference internal" href="#modeling-model-sets"><span class="std std-ref">Model set</span></a> consisting
of a set of parameters each representing a different parameterization of the same
parametric model. For example, you may instantiate a single Gaussian model
with one mean, standard deviation, and amplitude. Or you may create a set
of N Gaussians, each one of which would be evaluated on, for example, a
different plane in an image cube.</p>
<p>For example, a single Gaussian model may be instantiated with all scalar parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Gaussian1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span>  
<span class="go">&lt;Gaussian1D(amplitude=1., mean=0., stddev=1.)&gt;</span>
</pre></div>
</div>
<p>The newly created model instance <code class="docutils literal notranslate"><span class="pre">g</span></code> now works like a Gaussian function
with the specific parameters.  It takes a single input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">inputs</span>
<span class="go">(&#39;x&#39;,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>The model can also be called without explicitly using keyword arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>Or a set of Gaussians may be instantiated by passing multiple parameter values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Gaussian1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gset</span> <span class="o">=</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="n">stddev</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="n">n_models</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gset</span><span class="p">)</span>  
<span class="go">Model: Gaussian1D</span>
<span class="go">Inputs: (&#39;x&#39;,)</span>
<span class="go">Outputs: (&#39;y&#39;,)</span>
<span class="go">Model set size: 3</span>
<span class="go">Parameters:</span>
<span class="go">    amplitude mean stddev</span>
<span class="go">    --------- ---- ------</span>
<span class="go">          1.0  0.0    1.0</span>
<span class="go">          1.5  1.0    1.0</span>
<span class="go">          2.0  2.0    1.0</span>
</pre></div>
</div>
<p>This model also works like a Gaussian function. The three models in
the model set can be evaluated on the same input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gset</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="go">array([0.60653066, 1.5       , 1.21306132])</span>
</pre></div>
</div>
<p>or on <code class="docutils literal notranslate"><span class="pre">N=3</span></code> inputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gset</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="go">array([0.60653066, 0.90979599, 1.21306132])</span>
</pre></div>
</div>
<p>For a comprehensive example of fitting a model set see <a class="reference internal" href="example-fitting-model-sets.html#example-fitting-model-sets"><span class="std std-ref">Fitting Model Sets</span></a>.</p>
</div>
<div class="section" id="model-inverses">
<h3>Model inverses<a class="headerlink" href="#model-inverses" title="Permalink to this headline">¶</a></h3>
<p>All models have a <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.inverse" title="astropy.modeling.Model.inverse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.inverse</span></code></a> property
which may, for some models, return a new model that is the analytic inverse of
the model it is attached to.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Linear1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">linear</span> <span class="o">=</span> <span class="n">Linear1D</span><span class="p">(</span><span class="n">slope</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">linear</span><span class="o">.</span><span class="n">inverse</span>
<span class="go">&lt;Linear1D(slope=1.25, intercept=-1.25)&gt;</span>
</pre></div>
</div>
<p>The inverse of a model will always be a fully instantiated model in its own
right, and so can be evaluated directly like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">linear</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="go">1.25</span>
</pre></div>
</div>
<p>It is also possible to assign a <em>custom</em> inverse to a model.  This may be
useful, for example, in cases where a model does not have an analytic inverse,
but may have an approximate inverse that was computed numerically and is
represented by another model. This works even if the target model has a
default analytic inverse–in this case the default is overridden with the
custom inverse:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">linear</span><span class="o">.</span><span class="n">inverse</span> <span class="o">=</span> <span class="n">Polynomial1D</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c0</span><span class="o">=-</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">c1</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">linear</span><span class="o">.</span><span class="n">inverse</span>
<span class="go">&lt;Polynomial1D(1, c0=-1.25, c1=1.25)&gt;</span>
</pre></div>
</div>
<p>If a custom inverse has been assigned to a model, it can be deleted with
<code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">model.inverse</span></code>.  This resets the inverse to its default (if one exists).
If a default does not exist, accessing <code class="docutils literal notranslate"><span class="pre">model.inverse</span></code> raises a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NotImplementedError" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NotImplementedError</span></code></a>.  For example polynomial models do not have a default
inverse:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">linear</span><span class="o">.</span><span class="n">inverse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">linear</span><span class="o">.</span><span class="n">inverse</span>
<span class="go">&lt;Linear1D(slope=1.25, intercept=-1.25)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Polynomial1D</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">inverse</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;astropy\modeling\core.py&quot;</span>, line <span class="m">796</span>, in <span class="n">inverse</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;An analytical inverse transform has not &quot;</span>
<span class="gr">NotImplementedError</span>: <span class="n">No analytical or user-supplied inverse transform</span>
<span class="go">has been implemented for this model.</span>
</pre></div>
</div>
<p>One may certainly compute an inverse and assign it to a polynomial model
though.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When assigning a custom inverse to a model no validation is performed to
ensure that it is actually an inverse or even approximate inverse.  So
assign custom inverses at your own risk.</p>
</div>
</div>
<div class="section" id="bounding-boxes">
<h3>Bounding Boxes<a class="headerlink" href="#bounding-boxes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="efficient-model-rendering-with-bounding-boxes">
<span id="id2"></span><h4>Efficient Model Rendering with Bounding Boxes<a class="headerlink" href="#efficient-model-rendering-with-bounding-boxes" title="Permalink to this headline">¶</a></h4>
<p>All <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model</span></code></a> subclasses have a
<a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bounding_box</span></code></a> attribute that
can be used to set the limits over which the model is significant. This greatly
improves the efficiency of evaluation when the input range is much larger than
the characteristic width of the model itself. For example, to create a sky model
image from a large survey catalog, each source should only be evaluated over the
pixels to which it contributes a significant amount of flux. This task can
otherwise be computationally prohibitive on an average CPU.</p>
<p>The <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-func docutils literal notranslate"><span class="pre">Model.render</span></code></a> method can be used to
evaluate a model on an output array, or input coordinate arrays, limiting the
evaluation to the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bounding_box</span></code></a> region if
it is set. This function will also produce postage stamp images of the model if
no other input array is passed. To instead extract postage stamps from the data
array itself, see <a class="reference internal" href="../nddata/utils.html#cutout-images"><span class="std std-ref">2D Cutout Images</span></a>.</p>
</div>
<div class="section" id="using-the-standard-bounding-box">
<h4>Using the standard Bounding Box<a class="headerlink" href="#using-the-standard-bounding-box" title="Permalink to this headline">¶</a></h4>
<p>For basic usage, see <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.bounding_box</span></code></a>.
By default no <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bounding_box</span></code></a> is set, except on model
subclasses where a <code class="docutils literal notranslate"><span class="pre">bounding_box</span></code> property or method is explicitly defined.
The default is then the minimum rectangular region symmetric about the position
that fully contains the model. If the model does not have a finite extent,
the containment criteria are noted in the documentation. For example, see
<code class="docutils literal notranslate"><span class="pre">Gaussian2D.bounding_box</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Accessing the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.bounding_box</span></code></a>
property when it has not been set, or does not have a default will
result in a <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>. If this behavior is undesireable,
then one can instead use the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.get_bounding_box" title="astropy.modeling.Model.get_bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.get_bounding_box</span></code></a>
method instead. This method will return the bounding box if one exists
(by setting or default) otherwise it will return <code class="docutils literal notranslate"><span class="pre">None</span></code> instead
of raising an error.</p>
</div>
<p>A <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.bounding_box</span></code></a> default can be
set by the user to any callable. This is particularly useful for models created
with <a class="reference internal" href="../api/astropy.modeling.custom_model.html#astropy.modeling.custom_model" title="astropy.modeling.custom_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">custom_model</span></code></a> or as a <a class="reference internal" href="../api/astropy.modeling.CompoundModel.html#astropy.modeling.CompoundModel" title="astropy.modeling.core.CompoundModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CompoundModel</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">custom_model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ellipsoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">rsq</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="n">z</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">rsq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">amp</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">val</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Ellipsoid3D</span><span class="p">(</span><span class="n">custom_model</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="c1"># A 3D ellipsoid model</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span> <span class="o">=</span> <span class="n">Ellipsoid3D</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">ModelBoundingBox(</span>
<span class="go">    intervals={</span>
<span class="go">        x0: Interval(lower=-2.0, upper=2.0)</span>
<span class="go">        x1: Interval(lower=-3.0, upper=3.0)</span>
<span class="go">        x2: Interval(lower=-4.0, upper=4.0)</span>
<span class="go">    }</span>
<span class="go">    model=Ellipsoid3D(inputs=(&#39;x0&#39;, &#39;x1&#39;, &#39;x2&#39;))</span>
<span class="go">    order=&#39;C&#39;</span>
<span class="go">)</span>
</pre></div>
</div>
<p>By default models are evaluated on any inputs. By passing a flag they can be evaluated
only on inputs within the bounding box. For inputs outside of the bounding_box a <code class="docutils literal notranslate"><span class="pre">fill_value</span></code> is
returned (<code class="docutils literal notranslate"><span class="pre">np.nan</span></code> by default):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="go">-1.0</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.bounding_box</span></code></a> can be set on any
model instance via the usage of the property setter. For example for a single
input model one needs to only set a tuple of the lower and upper bounds</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span> <span class="o">=</span> <span class="n">Polynomial1D</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">ModelBoundingBox(</span>
<span class="go">    intervals={</span>
<span class="go">        x: Interval(lower=-1, upper=1)</span>
<span class="go">    }</span>
<span class="go">    model=Polynomial1D(inputs=(&#39;x&#39;,))</span>
<span class="go">    order=&#39;C&#39;</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">47</span><span class="p">)</span>
<span class="go">47.0</span>
</pre></div>
</div>
<p>For multi-input models, <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.bounding_box</span></code></a>
can be set on any model instance by specifying a tuple of lower/upper bound tuples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial2D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">ModelBoundingBox(</span>
<span class="go">    intervals={</span>
<span class="go">        x: Interval(lower=-1, upper=1)</span>
<span class="go">        y: Interval(lower=-2, upper=2)</span>
<span class="go">    }</span>
<span class="go">    model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">    order=&#39;C&#39;</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="go">7.0</span>
</pre></div>
</div>
<p>Note that if one wants to directly recover the tuple used to formulate
a bounding box, then one can use the
<a class="reference internal" href="../api/astropy.modeling.bounding_box.ModelBoundingBox.html#astropy.modeling.bounding_box.ModelBoundingBox.bounding_box" title="astropy.modeling.bounding_box.ModelBoundingBox.bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelBoundingBox.bounding_box()</span></code></a>
method</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
<span class="go">((-4.0, 4.0), (-3.0, 3.0), (-2.0, 2.0))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
<span class="go">(-1, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model3</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
<span class="go">((-2, 2), (-1, 1))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When setting multi-dimensional bounding boxes it is important to
remember that by default the tuple of tuples is assumed to be <code class="docutils literal notranslate"><span class="pre">'C'</span></code> ordered,
which means that the bound tuples will be ordered in the reverse order
to their respective input order. That is if the inputs are in the order
<code class="docutils literal notranslate"><span class="pre">('x',</span> <span class="pre">'y',</span> <span class="pre">'z')</span></code> then the bounds will need to be listed in <code class="docutils literal notranslate"><span class="pre">('z',</span> <span class="pre">'y',</span> <span class="pre">'x')</span></code>
order.</p>
</div>
<p>The if one does not want to work directly with the default <code class="docutils literal notranslate"><span class="pre">'C'</span></code> ordered
bounding boxes. It is possible to use the alternate <code class="docutils literal notranslate"><span class="pre">'F'</span></code> ordering, which
orders the bounding box tuple in the same order as the inputs. To do this
one can use the <a class="reference internal" href="../api/astropy.modeling.bind_bounding_box.html#astropy.modeling.bind_bounding_box" title="astropy.modeling.bind_bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bind_bounding_box</span></code></a>
function, and passing the <code class="docutils literal notranslate"><span class="pre">order='F'</span></code> keyword argument</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">bind_bounding_box</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bind_bounding_box</span><span class="p">(</span><span class="n">model4</span><span class="p">,</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">ModelBoundingBox(</span>
<span class="go">    intervals={</span>
<span class="go">        x: Interval(lower=-1, upper=1)</span>
<span class="go">        y: Interval(lower=-2, upper=2)</span>
<span class="go">    }</span>
<span class="go">    model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">    order=&#39;F&#39;</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="go">12.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
<span class="go">((-1, 1), (-2, 2))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model4</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="go">((-2, 2), (-1, 1))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently when combining models the bounding boxes of components are
combined only when joining models with the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator.
For the other operators bounding boxes for compound models must be assigned
explicitly.  A future release will determine the appropriate bounding box
for a compound model where possible.</p>
</div>
</div>
<div class="section" id="using-the-compound-bounding-box">
<h4>Using the Compound Bounding Box<a class="headerlink" href="#using-the-compound-bounding-box" title="Permalink to this headline">¶</a></h4>
<p>Sometimes it is useful to have multiple bounding boxes for the same model,
which are selectable when the model is evaluated. In this case, one should
consider using a <a class="reference internal" href="../api/astropy.modeling.bounding_box.CompoundBoundingBox.html#astropy.modeling.bounding_box.CompoundBoundingBox" title="astropy.modeling.bounding_box.CompoundBoundingBox"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CompoundBoundingBox</span></code></a>.</p>
<p>A common use case for this may be if the model has a single “discrete”
selector input (for example <code class="docutils literal notranslate"><span class="pre">'slit_id'</span></code>), which among other things,
determines what bounding box should be applied to the other inputs. To
do this one needs to first define a dictionary of bounding box tuples,
with dictionary keys being the specific values of the selector input
corresponding to that specific bounding box</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Shift</span><span class="p">,</span> <span class="n">Identity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span> <span class="o">=</span> <span class="n">Shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Identity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;slit_id&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bboxes</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">0</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>In order for the compound bounding box to function one must specify a list
of selector arguments, where the elements of this list are tuples of the input’s
name and whether or not the bounding box should be applied to the selector argument
or not. In this case, it makes sense for the selector argument to be ignored</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.core</span> <span class="kn">import</span> <span class="n">bind_compound_bounding_box</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector_args</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;slit_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bind_compound_bounding_box</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">selector_args</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">CompoundBoundingBox(</span>
<span class="go">    bounding_boxes={</span>
<span class="go">        (0,) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=0, upper=1)</span>
<span class="go">                    y: Interval(lower=1, upper=2)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;slit_id&#39;]</span>
<span class="go">                model=CompoundModel(inputs=(&#39;x&#39;, &#39;y&#39;, &#39;slit_id&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">        (1,) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=2, upper=3)</span>
<span class="go">                    y: Interval(lower=3, upper=4)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;slit_id&#39;]</span>
<span class="go">                model=CompoundModel(inputs=(&#39;x&#39;, &#39;y&#39;, &#39;slit_id&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">    }</span>
<span class="go">    selector_args = SelectorArguments(</span>
<span class="go">            Argument(name=&#39;slit_id&#39;, ignore=True)</span>
<span class="go">        )</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">(1.5, 3.5, 0.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">(nan, nan, nan)</span>
</pre></div>
</div>
<p>Multiple selector arguments can also be used, in this case the keys of the
dictionary of bounding boxes need to be specified as tuples of values</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span> <span class="o">=</span> <span class="n">Shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;slit_x&#39;</span><span class="p">,</span> <span class="s1">&#39;slit_y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bboxes</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector_args</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;slit_x&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;slit_y&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bind_compound_bounding_box</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">selector_args</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">CompoundBoundingBox(</span>
<span class="go">    bounding_boxes={</span>
<span class="go">        (0, 0) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=0, upper=1)</span>
<span class="go">                    y: Interval(lower=1, upper=2)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;slit_x&#39;, &#39;slit_y&#39;]</span>
<span class="go">                model=CompoundModel(inputs=(&#39;x&#39;, &#39;y&#39;, &#39;slit_x&#39;, &#39;slit_y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">        (0, 1) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=2, upper=3)</span>
<span class="go">                    y: Interval(lower=3, upper=4)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;slit_x&#39;, &#39;slit_y&#39;]</span>
<span class="go">                model=CompoundModel(inputs=(&#39;x&#39;, &#39;y&#39;, &#39;slit_x&#39;, &#39;slit_y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">        (1, 0) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=4, upper=5)</span>
<span class="go">                    y: Interval(lower=5, upper=6)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;slit_x&#39;, &#39;slit_y&#39;]</span>
<span class="go">                model=CompoundModel(inputs=(&#39;x&#39;, &#39;y&#39;, &#39;slit_x&#39;, &#39;slit_y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">        (1, 1) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=6, upper=7)</span>
<span class="go">                    y: Interval(lower=7, upper=8)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;slit_x&#39;, &#39;slit_y&#39;]</span>
<span class="go">                model=CompoundModel(inputs=(&#39;x&#39;, &#39;y&#39;, &#39;slit_x&#39;, &#39;slit_y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">    }</span>
<span class="go">    selector_args = SelectorArguments(</span>
<span class="go">            Argument(name=&#39;slit_x&#39;, ignore=True)</span>
<span class="go">            Argument(name=&#39;slit_y&#39;, ignore=True)</span>
<span class="go">        )</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">(1.5, 3.5, 0.0, 0.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">(nan, nan, nan, nan)</span>
</pre></div>
</div>
<p>Note that one can also specify the ordering for all the bounding boxes
comprising the compound bounding using the <code class="docutils literal notranslate"><span class="pre">order</span></code> keyword argument.</p>
<p>Another use case for this maybe a if one wants to use multiple bounding
boxes for the same model, where the user chooses the bounding box when
evaluating the model. In this case, one must still choose a selector
argument as a fall back default for bounding box selection; however, this
argument should not be ignored by the bounding box:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial2D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">bind_compound_bounding_box</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bboxes</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">0</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector_args</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bind_compound_bounding_box</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">selector_args</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">    CompoundBoundingBox(</span>
<span class="go">    bounding_boxes={</span>
<span class="go">        (0,) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=0, upper=1)</span>
<span class="go">                    y: Interval(lower=1, upper=2)</span>
<span class="go">                }</span>
<span class="go">                model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">        (1,) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=2, upper=3)</span>
<span class="go">                    y: Interval(lower=3, upper=4)</span>
<span class="go">                }</span>
<span class="go">                model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">    }</span>
<span class="go">    selector_args = SelectorArguments(</span>
<span class="go">            Argument(name=&#39;x&#39;, ignore=False)</span>
<span class="go">        )</span>
<span class="go">)</span>
</pre></div>
</div>
<p>For the user to select the bounding box on evaluation, instead of
specifying, <code class="docutils literal notranslate"><span class="pre">with_bounding_box=True</span></code> as the keyword argument; the user
instead specifies <code class="docutils literal notranslate"><span class="pre">with_bounding_box=&lt;bounding_key&gt;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">nan</span>
</pre></div>
</div>
</div>
<div class="section" id="ignoring-inputs-in-bounding-boxes">
<h4>Ignoring Inputs in Bounding Boxes<a class="headerlink" href="#ignoring-inputs-in-bounding-boxes" title="Permalink to this headline">¶</a></h4>
<p>Both <a class="reference internal" href="../api/astropy.modeling.bounding_box.ModelBoundingBox.html#astropy.modeling.bounding_box.ModelBoundingBox" title="astropy.modeling.bounding_box.ModelBoundingBox"><code class="xref py py-obj docutils literal notranslate"><span class="pre">standard</span> <span class="pre">bounding</span> <span class="pre">box</span></code></a>
and <a class="reference internal" href="../api/astropy.modeling.bounding_box.CompoundBoundingBox.html#astropy.modeling.bounding_box.CompoundBoundingBox" title="astropy.modeling.bounding_box.CompoundBoundingBox"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CompoundBoundingBox</span></code></a>
support ignoring specific inputs from enforcement by the bounding box. Effectively,
for multi-dimensional models one can define bounding boxes so that bounds are
only applied to a subset of the model’s inputs rather than the default of enforcing
a bound of some kind on every input. Note that use of this feature is equivalent
to defining the bounds for an input to be <code class="docutils literal notranslate"><span class="pre">[-np.inf,</span> <span class="pre">np.inf]</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ignored</span></code> input feature is not available when constructing/adding bounding
boxes to models using tuples and the property interface. That is one cannot
ignore inputs when setting bounding boxes using <code class="docutils literal notranslate"><span class="pre">model.bounding_box</span> <span class="pre">=</span> <span class="pre">(-1,</span> <span class="pre">1)</span></code>.
This feature is only available via the methods
<a class="reference internal" href="../api/astropy.modeling.bind_bounding_box.html#astropy.modeling.bind_bounding_box" title="astropy.modeling.bind_bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bind_bounding_box</span></code></a> and
<a class="reference internal" href="../api/astropy.modeling.bind_compound_bounding_box.html#astropy.modeling.bind_compound_bounding_box" title="astropy.modeling.bind_compound_bounding_box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bind_compound_bounding_box</span></code></a>.</p>
</div>
<p>Ignoring inputs for a bounding box can be achieved via passing a list of the input
name strings to be ignored to the <code class="docutils literal notranslate"><span class="pre">ignored</span></code> keyword argument in any of the main
bounding box interfaces.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">bind_bounding_box</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bind_bounding_box</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span> <span class="n">ignored</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">ModelBoundingBox(</span>
<span class="go">    intervals={</span>
<span class="go">        x: Interval(lower=-1, upper=1)</span>
<span class="go">    }</span>
<span class="go">    ignored=[&#39;y&#39;]</span>
<span class="go">    model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">    order=&#39;C&#39;</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>Similarly, the ignored inputs will be applied to all of the bounding boxes
contained within a compound bounding box.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">bind_compound_bounding_box</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bboxes</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector_args</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bind_compound_bounding_box</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">selector_args</span><span class="p">,</span> <span class="n">ignored</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">    CompoundBoundingBox(</span>
<span class="go">    bounding_boxes={</span>
<span class="go">        (0,) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=0, upper=1)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;y&#39;]</span>
<span class="go">                model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">        (1,) = ModelBoundingBox(</span>
<span class="go">                intervals={</span>
<span class="go">                    x: Interval(lower=1, upper=2)</span>
<span class="go">                }</span>
<span class="go">                ignored=[&#39;y&#39;]</span>
<span class="go">                model=Polynomial2D(inputs=(&#39;x&#39;, &#39;y&#39;))</span>
<span class="go">                order=&#39;F&#39;</span>
<span class="go">            )</span>
<span class="go">    }</span>
<span class="go">    selector_args = SelectorArguments(</span>
<span class="go">            Argument(name=&#39;x&#39;, ignore=False)</span>
<span class="go">        )</span>
<span class="go">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">with_bounding_box</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">nan</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="efficient-evaluation-with-model-render">
<h3>Efficient evaluation with <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.render()</span></code></a><a class="headerlink" href="#efficient-evaluation-with-model-render" title="Permalink to this headline">¶</a></h3>
<p>When a model is evaluated over a range much larger than the model itself, it
may be prudent to use the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-func docutils literal notranslate"><span class="pre">Model.render</span></code></a>
method if efficiency is a concern. The <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-func docutils literal notranslate"><span class="pre">render</span></code></a>
method can be used to evaluate the model on an
array of the same dimensions.  <code class="docutils literal notranslate"><span class="pre">model.render()</span></code> can be called with no
arguments to return a “postage stamp” of the bounding box region.</p>
<p>In this example, we generate a 300x400 pixel image of 100 2D Gaussian sources.
For comparison, the models are evaluated both with and without using bounding
boxes. By using bounding boxes, the evaluation speed increases by approximately
a factor of 10 with negligible loss of information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>

<span class="n">imshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">imshape</span><span class="p">)</span>

<span class="c1"># Generate random source model list</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">nsrc</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
         <span class="n">x_mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">imshape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
         <span class="n">y_mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">imshape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
         <span class="n">x_stddev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
         <span class="n">y_stddev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
         <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsrc</span><span class="p">)]</span>

<span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Gaussian2D</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">model_params</span><span class="p">]</span>

<span class="c1"># Render models to image using bounding boxes</span>
<span class="n">bb_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">imshape</span><span class="p">)</span>
<span class="n">t_bb</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">bb_image</span><span class="p">)</span>
<span class="n">t_bb</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_bb</span>

<span class="c1"># Render models to image using full evaluation</span>
<span class="n">full_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">imshape</span><span class="p">)</span>
<span class="n">t_full</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">full_image</span><span class="p">)</span>
<span class="n">t_full</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_full</span>

<span class="n">flux</span> <span class="o">=</span> <span class="n">full_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">full_image</span> <span class="o">-</span> <span class="n">bb_image</span><span class="p">)</span>
<span class="n">max_err</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">.97</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">.03</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">.97</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># Full model image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">full_image</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Full Models</span><span class="se">\n</span><span class="s1">Timing: </span><span class="si">{</span><span class="n">t_full</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="c1"># Bounded model image with boxes overplotted</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bb_image</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span>  <span class="c1"># Reset bounding_box to its default</span>
    <span class="n">dy</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x_mean</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">y_mean</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bounded Models</span><span class="se">\n</span><span class="s1">Timing: </span><span class="si">{</span><span class="n">t_bb</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="c1"># Difference image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">max_err</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_err</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1e</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference Image</span><span class="se">\n</span><span class="s1">Total Flux Err = </span><span class="si">{</span><span class="p">((</span><span class="n">flux</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bb_image</span><span class="p">))</span> <span class="o">/</span> <span class="n">flux</span><span class="p">)</span><span class="si">:</span><span class="s1">.0e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id3">
<img alt="../_images/models-1_00.png" class="plot-directive" src="../_images/models-1_00.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href="../modeling/models-1_00.png">png</a>, <a class="reference external" href="../modeling/models-1_00.svg">svg</a>, <a class="reference external" href="../modeling/models-1_00.pdf">pdf</a>)</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id4">
<img alt="../_images/models-1_01.png" class="plot-directive" src="../_images/models-1_01.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href="../modeling/models-1_01.png">png</a>, <a class="reference external" href="../modeling/models-1_01.svg">svg</a>, <a class="reference external" href="../modeling/models-1_01.pdf">pdf</a>)</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="model-separability">
<span id="separability"></span><h3>Model Separability<a class="headerlink" href="#model-separability" title="Permalink to this headline">¶</a></h3>
<p>Simple models have a boolean <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.separable" title="astropy.modeling.Model.separable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.separable</span></code></a> property.
It indicates whether the outputs are independent and is essential for computing the
separability of compound models using the <a class="reference internal" href="../api/astropy.modeling.is_separable.html#astropy.modeling.is_separable" title="astropy.modeling.is_separable"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_separable()</span></code></a> function.
Having a separable compound model means that it can be decomposed into independent models,
which in turn is useful in many applications.
For example, it may be easier to define inverses using the independent parts of a model
than the entire model.
In other cases, tools using <a class="reference external" href="https://gwcs.readthedocs.io/en/latest/">Generalized World Coordinate System (GWCS)</a>,
can be more flexible and take advantage of separable spectral and spatial transforms.</p>
<p>If a custom subclass of <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model</span></code></a> needs to override the
computation of its separability it can implement the
<code class="docutils literal notranslate"><span class="pre">_calculate_separability_matrix</span></code> method which should return the separability
matrix for that model.</p>
</div>
</div>
<div class="section" id="model-sets">
<span id="modeling-model-sets"></span><h2>Model Sets<a class="headerlink" href="#model-sets" title="Permalink to this headline">¶</a></h2>
<p>In some cases it is useful to describe many models of the same type but with
different sets of parameter values.  This could be done simply by instantiating
as many instances of a <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model</span></code></a> as are needed.  But that can
be inefficient for a large number of models.  To that end, all model classes in
<a class="reference internal" href="reference_api.html#module-astropy.modeling" title="astropy.modeling"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.modeling</span></code></a> can also be used to represent a model <strong>set</strong> which is a
collection of models of the same type, but with different values for their
parameters.</p>
<p>To instantiate a model set, use argument <code class="docutils literal notranslate"><span class="pre">n_models=N</span></code> where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the
number of models in the set when constructing the model.  The value of each
parameter must be a list or array of length <code class="docutils literal notranslate"><span class="pre">N</span></code>, such that each item in
the array corresponds to one model in the set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>                      <span class="n">stddev</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">Model: Gaussian1D</span>
<span class="go">Inputs: (&#39;x&#39;,)</span>
<span class="go">Outputs: (&#39;y&#39;,)</span>
<span class="go">Model set size: 2</span>
<span class="go">Parameters:</span>
<span class="go">    amplitude mean stddev</span>
<span class="go">    --------- ---- ------</span>
<span class="go">          1.0  0.0    0.1</span>
<span class="go">          2.0  0.0    0.2</span>
</pre></div>
</div>
<p>This is equivalent to two Gaussians with the parameters <code class="docutils literal notranslate"><span class="pre">amplitude=1,</span> <span class="pre">mean=0,</span>
<span class="pre">stddev=0.1</span></code> and <code class="docutils literal notranslate"><span class="pre">amplitude=2,</span> <span class="pre">mean=0,</span> <span class="pre">stddev=0.2</span></code> respectively.  When
printing the model the parameter values are displayed as a table, with each row
corresponding to a single model in the set.</p>
<p>The number of models in a model set can be determined using the <a class="reference external" href="https://docs.python.org/3/library/functions.html#len" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">len</span></code></a> builtin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Single models have a length of 1, and are not considered a model set as such.</p>
<p>When evaluating a model set, by default the input must be the same length as
the number of models, with one input per model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>  
<span class="go">array([1.        , 1.76499381])</span>
</pre></div>
</div>
<p>The result is an array with one result per model in the set.  It is also
possible to broadcast a single input value to all models in the set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  
<span class="go">array([1., 2.])</span>
</pre></div>
</div>
<p>Or when the input is an array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">[[0.  0.  0. ]</span>
<span class="go"> [0.1 0.1 0.1]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">array([[1.        , 1.        , 1.        ],</span>
<span class="go">       [1.76499381, 1.76499381, 1.76499381]])</span>
</pre></div>
</div>
<p>Internally the shape of the inputs, outputs, and parameter values is controlled
by an attribute - <code class="docutils literal notranslate"><span class="pre">model_set_axis</span></code>. In the above case <code class="docutils literal notranslate"><span class="pre">model_set_axis=0</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">model_set_axis</span>
<span class="go">0</span>
</pre></div>
</div>
<p>This indicates that elements along the 0-th axis will be passed as inputs to individual models.
Sometimes it may be useful to pass inputs along a different axis, for example the 1st axis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">[[0.  0.1]</span>
<span class="go"> [0.  0.1]</span>
<span class="go"> [0.  0.1]]</span>
</pre></div>
</div>
<p>Because there are two models in this model set and we are passing three inputs
along the 0th axis, evaluation will fail:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Input argument &#39;x&#39; does not have the correct dimensions in</span>
<span class="go">model_set_axis=0 for a model set with n_models=2.</span>
</pre></div>
</div>
<p>There are two ways to get around this. <code class="docutils literal notranslate"><span class="pre">model_set_axis</span></code> can be passed in
when the model is evaluated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">array([[1.        , 1.76499381],</span>
<span class="go">       [1.        , 1.76499381],</span>
<span class="go">       [1.        , 1.76499381]])</span>
</pre></div>
</div>
<p>Or when the model is initialized:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">mean</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span>                      <span class="n">stddev</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]],</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">model_set_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">array([[1.        , 1.76499381],</span>
<span class="go">       [1.        , 1.76499381],</span>
<span class="go">       [1.        , 1.76499381]])</span>
</pre></div>
</div>
<p>Note that in the latter case, the shape of the individual parameters has changed to 2D
because now the parameters are defined along the 1st axis.</p>
<p>The value of <code class="docutils literal notranslate"><span class="pre">model_set_axis</span></code> is either an integer number, representing the axis along which
the different parameter sets and inputs are defined, or a boolean of value <code class="docutils literal notranslate"><span class="pre">False</span></code>,
in which case it indicates all model sets should use the same inputs on evaluation.
For example, the above model has a value of 1 for <code class="docutils literal notranslate"><span class="pre">model_set_axis</span></code>.
If <code class="docutils literal notranslate"><span class="pre">model_set_axis=False</span></code> is passed the two models will be evaluated on the same input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">model_set_axis</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span>
<span class="go">array([[[1.        , 0.60653066],</span>
<span class="go">        [2.        , 1.76499381]],</span>

<span class="go">       [[1.        , 0.60653066],</span>
<span class="go">        [2.        , 1.76499381]],</span>

<span class="go">       [[1.        , 0.60653066],</span>
<span class="go">        [2.        , 1.76499381]]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="go">array([[1.        , 0.60653066],</span>
<span class="go">       [1.        , 0.60653066],</span>
<span class="go">       [1.        , 0.60653066]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="go">array([[2.        , 1.76499381],</span>
<span class="go">       [2.        , 1.76499381],</span>
<span class="go">       [2.        , 1.76499381]])</span>
</pre></div>
</div>
<p>Currently model sets are most useful for fitting a set of <strong>linear</strong> models
(<a class="reference internal" href="example-fitting-model-sets.html#example-fitting-model-sets"><span class="std std-ref">example</span></a>)
allowing a large number of models of the same type to be fitted simultaneously
(and independently from each other) to some large set of inputs, such as
fitting a polynomial to the time response of each pixel in a data cube.
This can greatly speed up the fitting process. The speed-up is due to solving
the set of equations to find the exact solution. Nonlinear models, which require
an iterative algorithm, cannot be currently fit using model sets. Model sets of nonlinear
models can only be evaluated.</p>
<p>When fitting model sets it is important that data arrays are passed to the fitter
in the correct shape. The shape depends on the <code class="docutils literal notranslate"><span class="pre">model_set_axis</span></code> attribute of the
model to be fit. The rule is that the index of the dependent variable that corresponds
to a model set should be along the <code class="docutils literal notranslate"><span class="pre">model_set_axis</span></code> dimension. For example, for a
1D model set with 3 models with <code class="docutils literal notranslate"><span class="pre">model_set_axis</span> <span class="pre">==</span> <span class="pre">1</span></code> the shape of <code class="docutils literal notranslate"><span class="pre">y</span></code> should be (x, 3):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.fitting</span> <span class="kn">import</span> <span class="n">LinearLSQFitter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fitter</span> <span class="o">=</span> <span class="n">LinearLSQFitter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="go">[[1 4 0]</span>
<span class="go"> [3 5 1]</span>
<span class="go"> [5 6 2]</span>
<span class="go"> [7 7 3]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(4, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Polynomial1D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mfit</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>For 2D models with 3 models and <code class="docutils literal notranslate"><span class="pre">model_set_axis</span> <span class="pre">=</span> <span class="pre">0</span></code> the shape of <code class="docutils literal notranslate"><span class="pre">z</span></code> should be (3, x, y):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Polynomial2D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.fitting</span> <span class="kn">import</span> <span class="n">LinearLSQFitter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fitter</span> <span class="o">=</span> <span class="n">LinearLSQFitter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(3, 2, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Polynomial2D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">model_set_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mfit</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="model-serialization-writing-a-model-to-a-file">
<span id="modeling-asdf"></span><h2>Model Serialization (Writing a Model to a File)<a class="headerlink" href="#model-serialization-writing-a-model-to-a-file" title="Permalink to this headline">¶</a></h2>
<p>Models are serializable using the <a class="reference external" href="https://asdf-standard.readthedocs.io/en/latest/">ASDF</a>
format. This can be useful in many contexts, one of which is the implementation of a
<a class="reference external" href="https://gwcs.readthedocs.io/en/latest/">Generalized World Coordinate System (GWCS)</a>.</p>
<p>Serializing a model to disk is possible by assigning the object to <code class="docutils literal notranslate"><span class="pre">AsdfFile.tree</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">asdf</span> <span class="kn">import</span> <span class="n">AsdfFile</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rotation</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Rotation2D</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mf">23.7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">AsdfFile</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">write_to</span><span class="p">(</span><span class="s1">&#39;rotation.asdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To read the file and create the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">asdf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">asdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;rotation.asdf&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">model</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tree</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="go">Model: Rotation2D</span>
<span class="go">Inputs: (&#39;x&#39;, &#39;y&#39;)</span>
<span class="go">Outputs: (&#39;x&#39;, &#39;y&#39;)</span>
<span class="go">Model set size: 1</span>
<span class="go">Parameters:</span>
<span class="go">    angle</span>
<span class="go">    -----</span>
<span class="go">     23.7</span>
</pre></div>
</div>
<p>Compound models can also be serialized. Please note that some model attributes (e.g <code class="docutils literal notranslate"><span class="pre">meta</span></code>,
<code class="docutils literal notranslate"><span class="pre">tied</span></code> parameter constraints used in fitting), as well as model sets are not yet serializable.
For more information on serialization of models, see <a class="reference internal" href="../io/misc.html#asdf-dev"><span class="std std-ref">Details</span></a>.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Models</a><ul>
<li><a class="reference internal" href="#basics">Basics</a><ul>
<li><a class="reference internal" href="#instantiating-and-evaluating-models">Instantiating and Evaluating Models</a></li>
<li><a class="reference internal" href="#model-inverses">Model inverses</a></li>
<li><a class="reference internal" href="#bounding-boxes">Bounding Boxes</a><ul>
<li><a class="reference internal" href="#efficient-model-rendering-with-bounding-boxes">Efficient Model Rendering with Bounding Boxes</a></li>
<li><a class="reference internal" href="#using-the-standard-bounding-box">Using the standard Bounding Box</a></li>
<li><a class="reference internal" href="#using-the-compound-bounding-box">Using the Compound Bounding Box</a></li>
<li><a class="reference internal" href="#ignoring-inputs-in-bounding-boxes">Ignoring Inputs in Bounding Boxes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#efficient-evaluation-with-model-render">Efficient evaluation with <code class="xref py py-obj docutils literal notranslate"><span class="pre">Model.render()</span></code></a></li>
<li><a class="reference internal" href="#model-separability">Model Separability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#model-sets">Model Sets</a></li>
<li><a class="reference internal" href="#model-serialization-writing-a-model-to-a-file">Model Serialization (Writing a Model to a File)</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/modeling/models.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>