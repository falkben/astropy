


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Defining New Model Classes &#8212; Astropy v5.2.dev104+gcdd6a1f81.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Defining New Fitter Classes" href="new-fitter.html" />
    <link rel="prev" title="Performance Tips" href="performance.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="new-fitter.html" title="Defining New Fitter Classes">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="performance.html" title="Performance Tips">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev104+gcdd6a1f81.d20220509</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Models and Fitting (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.modeling</span></code>)</a> &#187;</li>
      
      <li>Defining New Model Classes</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defining-new-model-classes">
<span id="modeling-new-classes"></span><h1>Defining New Model Classes<a class="headerlink" href="#defining-new-model-classes" title="Permalink to this headline">¶</a></h1>
<p>This document describes how to add a model to the package or to create a
user-defined model. In short, one needs to define all model parameters and
write a function which evaluates the model, that is, computes the mathematical
function that implements the model.  If the model is fittable, a function to
compute the derivatives with respect to parameters is required if a linear
fitting algorithm is to be used and optional if a non-linear fitter is to be
used.</p>
<div class="section" id="basic-custom-models">
<h2>Basic custom models<a class="headerlink" href="#basic-custom-models" title="Permalink to this headline">¶</a></h2>
<p>For most cases, the <a class="reference internal" href="../api/astropy.modeling.custom_model.html#astropy.modeling.custom_model" title="astropy.modeling.custom_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">custom_model</span></code></a> decorator provides an
easy way to make a new <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model</span></code></a> class from an existing Python
callable. The following example demonstrates how to set up a model consisting
of two Gaussians:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">custom_model</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.fitting</span> <span class="kn">import</span> <span class="n">LevMarLSQFitter</span>

<span class="c1"># Define model</span>
<span class="nd">@custom_model</span>
<span class="k">def</span> <span class="nf">sum_of_gaussians</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude1</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">mean1</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">sigma1</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                        <span class="n">amplitude2</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">mean2</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">amplitude1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean1</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">amplitude2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean2</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Generate fake data</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">m_ref</span> <span class="o">=</span> <span class="n">sum_of_gaussians</span><span class="p">(</span><span class="n">amplitude1</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mean1</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sigma1</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                         <span class="n">amplitude2</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mean2</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">m_ref</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Fit model to data</span>
<span class="n">m_init</span> <span class="o">=</span> <span class="n">sum_of_gaussians</span><span class="p">()</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">LevMarLSQFitter</span><span class="p">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">m_init</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Plot the data and the best fit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../modeling/new-model-1.png">png</a>, <a class="reference external" href="../modeling/new-model-1.svg">svg</a>, <a class="reference external" href="../modeling/new-model-1.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../_images/new-model-1.png" class="plot-directive" src="../_images/new-model-1.png" />
</div>
<p>This decorator also supports setting a model’s
<a class="reference internal" href="../api/astropy.modeling.FittableModel.html#astropy.modeling.FittableModel.fit_deriv" title="astropy.modeling.FittableModel.fit_deriv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fit_deriv</span></code></a> as well as creating models with
more than one inputs.  Note that when creating a model from a function with
multiple outputs, the keyword argument <code class="docutils literal notranslate"><span class="pre">n_outputs</span></code> must be set to the
number of outputs of the function.  It can also be used as a normal factory
function (for example <code class="docutils literal notranslate"><span class="pre">SumOfGaussians</span> <span class="pre">=</span> <span class="pre">custom_model(sum_of_gaussians)</span></code>)
rather than as a decorator.  See the <a class="reference internal" href="../api/astropy.modeling.custom_model.html#astropy.modeling.custom_model" title="astropy.modeling.custom_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">custom_model</span></code></a>
documentation for more examples.</p>
</div>
<div class="section" id="a-step-by-step-definition-of-a-1-d-gaussian-model">
<h2>A step by step definition of a 1-D Gaussian model<a class="headerlink" href="#a-step-by-step-definition-of-a-1-d-gaussian-model" title="Permalink to this headline">¶</a></h2>
<p>The example described in <a class="reference internal" href="#basic-custom-models">Basic custom models</a> can be used for most simple
cases, but the following section describes how to construct model classes in
general.  Defining a full model class may be desirable, for example, to
provide more specialized parameters, or to implement special functionality not
supported by the basic <a class="reference internal" href="../api/astropy.modeling.custom_model.html#astropy.modeling.custom_model" title="astropy.modeling.custom_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">custom_model</span></code></a> factory function.</p>
<p>The details are explained below with a 1-D Gaussian model as an example.  There
are two base classes for models. If the model is fittable, it should inherit
from <a class="reference internal" href="../api/astropy.modeling.FittableModel.html#astropy.modeling.FittableModel" title="astropy.modeling.FittableModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FittableModel</span></code></a>; if not it should subclass
<a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Model</span></code></a>.</p>
<p>If the model takes parameters they should be specified as class attributes in
the model’s class definition using the <a class="reference internal" href="../api/astropy.modeling.Parameter.html#astropy.modeling.Parameter" title="astropy.modeling.Parameter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Parameter</span></code></a>
descriptor.  All arguments to the Parameter constructor are optional, and may
include a default value for that parameter, a text description of the parameter
(useful for <a class="reference external" href="https://docs.python.org/3/library/functions.html#help" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">help</span></code></a> and documentation generation), as well default constraints
and custom getters/setters for the parameter value.  It is also possible to
define a “validator” method for each parameter, enabling custom code to check
whether that parameter’s value is valid according to the model definition (for
example if it must be non-negative).  See the example in
<a class="reference internal" href="../api/astropy.modeling.Parameter.html#astropy.modeling.Parameter.validator" title="astropy.modeling.Parameter.validator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Parameter.validator</span></code></a> for more details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">Fittable1DModel</span><span class="p">,</span> <span class="n">Parameter</span>

<span class="k">class</span> <span class="nc">Gaussian1D</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="n">n_inputs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_outputs</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
    <span class="n">stddev</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">n_inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">n_outputs</span></code> class attributes must be integers
indicating the number of independent variables that are input to evaluate the
model, and the number of outputs it returns.  The labels of the inputs and
outputs, <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code>, are generated automatically. It is possible
to overwrite the default ones by assigning the desired values in the class <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
method, after calling <code class="docutils literal notranslate"><span class="pre">super</span></code>. <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">inputs</span></code> must be tuples of
strings with length <code class="docutils literal notranslate"><span class="pre">n_outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">n_inputs</span></code> respectively.
Outputs may have the same labels as inputs (eg. <code class="docutils literal notranslate"><span class="pre">inputs</span> <span class="pre">=</span> <span class="pre">('x',</span> <span class="pre">'y')</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span> <span class="pre">=</span> <span class="pre">('x',</span> <span class="pre">'y')</span></code>).
However, inputs must not conflict with each other (eg. <code class="docutils literal notranslate"><span class="pre">inputs</span> <span class="pre">=</span> <span class="pre">('x',</span> <span class="pre">'x')</span></code> is
incorrect) and likewise for outputs.</p>
<p>There are two helpful base classes in the modeling package that can be used to
avoid specifying <code class="docutils literal notranslate"><span class="pre">n_inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">n_outputs</span></code> for most common models.  These are
<a class="reference internal" href="../api/astropy.modeling.Fittable1DModel.html#astropy.modeling.Fittable1DModel" title="astropy.modeling.Fittable1DModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fittable1DModel</span></code></a> and <a class="reference internal" href="../api/astropy.modeling.Fittable2DModel.html#astropy.modeling.Fittable2DModel" title="astropy.modeling.Fittable2DModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fittable2DModel</span></code></a>.
For example, the actual <a class="reference internal" href="../api/astropy.modeling.functional_models.Gaussian1D.html#astropy.modeling.functional_models.Gaussian1D" title="astropy.modeling.functional_models.Gaussian1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Gaussian1D</span></code></a> model is
a subclass of <a class="reference internal" href="../api/astropy.modeling.Fittable1DModel.html#astropy.modeling.Fittable1DModel" title="astropy.modeling.Fittable1DModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fittable1DModel</span></code></a>. This helps cut
down on boilerplate by not having to specify <code class="docutils literal notranslate"><span class="pre">n_inputs</span></code>, <code class="docutils literal notranslate"><span class="pre">n_outputs</span></code>, <code class="docutils literal notranslate"><span class="pre">inputs</span></code>
and <code class="docutils literal notranslate"><span class="pre">outputs</span></code> for many models (follow the link to Gaussian1D to see its source code, for
example).</p>
<p>Fittable models can be linear or nonlinear in a regression sense. The default
value of the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.linear" title="astropy.modeling.Model.linear"><code class="xref py py-obj docutils literal notranslate"><span class="pre">linear</span></code></a> attribute is <code class="docutils literal notranslate"><span class="pre">False</span></code>.  Linear
models should define the <code class="docutils literal notranslate"><span class="pre">linear</span></code> class attribute as <code class="docutils literal notranslate"><span class="pre">True</span></code>.  Because this
model is non-linear we can stick with the default.</p>
<p>Models which inherit from <a class="reference internal" href="../api/astropy.modeling.Fittable1DModel.html#astropy.modeling.Fittable1DModel" title="astropy.modeling.Fittable1DModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fittable1DModel</span></code></a> have the
<code class="docutils literal notranslate"><span class="pre">Model._separable</span></code> property already set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
All other models should define this property to indicate the
<a class="reference internal" href="models.html#separability"><span class="std std-ref">Model Separability</span></a>.</p>
<p>Next, provide methods called <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> to evaluate the model and
<code class="docutils literal notranslate"><span class="pre">fit_deriv</span></code>, to compute its derivatives with respect to parameters.  These
may be normal methods, <a class="reference external" href="https://docs.python.org/3/library/functions.html#classmethod" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">classmethod</span></code></a>, or <a class="reference external" href="https://docs.python.org/3/library/functions.html#staticmethod" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">staticmethod</span></code></a>, though the convention
is to use <a class="reference external" href="https://docs.python.org/3/library/functions.html#staticmethod" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">staticmethod</span></code></a> when the function does not depend on any of the
object’s other attributes (i.e., it does not reference <code class="docutils literal notranslate"><span class="pre">self</span></code>) or any of the
class’s other attributes as in the case of <a class="reference external" href="https://docs.python.org/3/library/functions.html#classmethod" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">classmethod</span></code></a>.  The evaluation
method takes all input coordinates as separate arguments and all of the model’s
parameters in the same order they would be listed by
<a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.param_names" title="astropy.modeling.Model.param_names"><code class="xref py py-obj docutils literal notranslate"><span class="pre">param_names</span></code></a>.</p>
<p>For this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>It should be made clear that the <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> method must be designed to take
the model’s parameter values as arguments.  This may seem at odds with the fact
that the parameter values are already available via attribute of the model
(eg. <code class="docutils literal notranslate"><span class="pre">model.amplitude</span></code>).  However, passing the parameter values directly to
<code class="docutils literal notranslate"><span class="pre">evaluate</span></code> is a more efficient way to use it in many cases, such as fitting.</p>
<p>Users of your model would not generally use <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> directly.  Instead
they create an instance of the model and call it on some input.  The
<code class="docutils literal notranslate"><span class="pre">__call__</span></code> method of models uses <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> internally, but users do not
need to be aware of it.  The default <code class="docutils literal notranslate"><span class="pre">__call__</span></code> implementation also handles
details such as checking that the inputs are correctly formatted and follow
Numpy’s broadcasting rules before attempting to evaluate the model.</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">evaluate</span></code>, the <code class="docutils literal notranslate"><span class="pre">fit_deriv</span></code> method takes as input all coordinates and
all parameter values as arguments.  There is an option to compute numerical
derivatives for nonlinear models in which case the <code class="docutils literal notranslate"><span class="pre">fit_deriv</span></code> method should
be <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">):</span>
    <span class="n">d_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">d_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">amplitude</span> <span class="o">*</span>
              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
              <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">d_stddev</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">amplitude</span> <span class="o">*</span>
                <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">d_amplitude</span><span class="p">,</span> <span class="n">d_mean</span><span class="p">,</span> <span class="n">d_stddev</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that we did <em>not</em> have to define an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method or a <code class="docutils literal notranslate"><span class="pre">__call__</span></code>
method for our model. For most models the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> follows the same pattern,
taking the parameter values as positional arguments, followed by several optional
keyword arguments (constraints, etc.).  The modeling framework automatically generates an
<code class="docutils literal notranslate"><span class="pre">__init__</span></code> for your class that has the correct calling signature (see for
yourself by calling <code class="docutils literal notranslate"><span class="pre">help(Gaussian1D.__init__)</span></code> on the example model we just
defined).</p>
<p>There are cases where it might be desirable to define a custom <code class="docutils literal notranslate"><span class="pre">__init__</span></code>.
For example, the <a class="reference internal" href="../api/astropy.modeling.functional_models.Gaussian2D.html#astropy.modeling.functional_models.Gaussian2D" title="astropy.modeling.functional_models.Gaussian2D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Gaussian2D</span></code></a> model takes
an optional <code class="docutils literal notranslate"><span class="pre">cov_matrix</span></code> argument which can be used as an alternative way to
specify the x/y_stddev and theta parameters.  This is perfectly valid so long
as the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> determines appropriate values for the actual parameters and
then calls the super <code class="docutils literal notranslate"><span class="pre">__init__</span></code> with the standard arguments.  Schematically
this looks something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">x_stddev</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">y_stddev</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># The **kwargs here should be understood as other keyword arguments</span>
    <span class="c1"># accepted by the basic Model.__init__ (such as constraints)</span>
    <span class="k">if</span> <span class="n">cov_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Set x/y_stddev and theta from the covariance matrix</span>
        <span class="n">x_stddev</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">y_stddev</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="o">...</span>

    <span class="c1"># Don&#39;t pass on cov_matrix since it doesn&#39;t mean anything to the base</span>
    <span class="c1"># class</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">x_stddev</span><span class="p">,</span> <span class="n">y_stddev</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="full-example">
<h3>Full example<a class="headerlink" href="#full-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">Fittable1DModel</span><span class="p">,</span> <span class="n">Parameter</span>

<span class="k">class</span> <span class="nc">Gaussian1D</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
    <span class="n">stddev</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">):</span>
        <span class="n">d_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">d_mean</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">amplitude</span> <span class="o">*</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span>
                  <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">d_stddev</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">amplitude</span> <span class="o">*</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span>
                    <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">stddev</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d_amplitude</span><span class="p">,</span> <span class="n">d_mean</span><span class="p">,</span> <span class="n">d_stddev</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-full-example-of-a-linemodel">
<h2>A full example of a LineModel<a class="headerlink" href="#a-full-example-of-a-linemodel" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates one other optional feature for model classes, which
is an <em>inverse</em>.  An <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.inverse" title="astropy.modeling.Model.inverse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">inverse</span></code></a> implementation should be
a <a class="reference external" href="https://docs.python.org/3/library/functions.html#property" title="(in Python v3.10)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">property</span></code></a> that returns a new model instance (not necessarily of the same
class as the model being inverted) that computes the inverse of that model, so
that for some model instance with an inverse, <code class="docutils literal notranslate"><span class="pre">model.inverse(model(*input))</span> <span class="pre">==</span>
<span class="pre">input</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">Fittable1DModel</span><span class="p">,</span> <span class="n">Parameter</span>

<span class="k">class</span> <span class="nc">LineModel</span><span class="p">(</span><span class="n">Fittable1DModel</span><span class="p">):</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
    <span class="n">intercept</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">()</span>
    <span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">):</span>
        <span class="n">d_slope</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">d_intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d_slope</span><span class="p">,</span> <span class="n">d_intercept</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slope</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">new_intercept</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">intercept</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">slope</span>
        <span class="k">return</span> <span class="n">LineModel</span><span class="p">(</span><span class="n">slope</span><span class="o">=</span><span class="n">new_slope</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="n">new_intercept</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above example is essentially equivalent to the built-in
<a class="reference internal" href="../api/astropy.modeling.functional_models.Linear1D.html#astropy.modeling.functional_models.Linear1D" title="astropy.modeling.functional_models.Linear1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Linear1D</span></code></a> model.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Defining New Model Classes</a><ul>
<li><a class="reference internal" href="#basic-custom-models">Basic custom models</a></li>
<li><a class="reference internal" href="#a-step-by-step-definition-of-a-1-d-gaussian-model">A step by step definition of a 1-D Gaussian model</a><ul>
<li><a class="reference internal" href="#full-example">Full example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-full-example-of-a-linemodel">A full example of a LineModel</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/modeling/new-model.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>