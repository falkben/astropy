


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verification &#8212; Astropy v5.2.dev94+gb1133d712.d20220509</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Less Familiar Objects" href="unfamiliar.html" />
    <link rel="prev" title="Table Data" href="table.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="unfamiliar.html" title="Less Familiar Objects">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="table.html" title="Table Data">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">Astropy v5.2.dev94+gb1133d712.d20220509</a>
	 &#187;
      </li>
      <li><a href="../index.html" accesskey="U">FITS File Handling (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.io.fits</span></code>)</a> &#187;</li>
      
      <li>Verification</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="verification">
<span id="fits-io-verification"></span><h1>Verification<a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">astropy</span></code> has built in a flexible scheme to verify FITS data conforming to
the FITS standard. The basic verification philosophy in <code class="docutils literal notranslate"><span class="pre">astropy</span></code> is to be
tolerant with input and strict with output.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">astropy</span></code> reads a FITS file which does not conform to FITS standard, it
will not raise an error and exit. It will try to make the best educated
interpretation and only gives up when the offending data is accessed and no
unambiguous interpretation can be reached.</p>
<p>On the other hand, when writing to an output FITS file, the content to be
written must be strictly compliant to the FITS standard by default. This
default behavior can be overwritten by several other options, so the user will
not be held up because of a minor standard violation.</p>
<div class="section" id="fits-standard">
<h2>FITS Standard<a class="headerlink" href="#fits-standard" title="Permalink to this headline">¶</a></h2>
<p>Since FITS standard is a “loose” standard, there are many places the violation
can occur and to enforce them all will be almost impossible. It is not uncommon
for major observatories to generate data products which are not 100% FITS
compliant. Some observatories have also developed their own nonstandard
dialect and some of these are so prevalent that they have become de facto
standards. Examples include the long string value and the use of the CONTINUE
card.</p>
<p>The violation of the standard can happen at different levels of the data
structure. <code class="docutils literal notranslate"><span class="pre">astropy</span></code>’s verification scheme is developed on these hierarchical
levels. Here are the three <code class="docutils literal notranslate"><span class="pre">astropy</span></code> verification levels:</p>
<ol class="arabic simple">
<li><p>The HDU List</p></li>
<li><p>Each HDU</p></li>
<li><p>Each Card in the HDU Header</p></li>
</ol>
<p>These three levels correspond to the three categories of objects:
<a class="reference internal" href="../api/hdulists.html#astropy.io.fits.HDUList" title="astropy.io.fits.HDUList"><code class="xref py py-class docutils literal notranslate"><span class="pre">HDUList</span></code></a>, any HDU (e.g., <a class="reference internal" href="../api/hdus.html#astropy.io.fits.PrimaryHDU" title="astropy.io.fits.PrimaryHDU"><code class="xref py py-class docutils literal notranslate"><span class="pre">PrimaryHDU</span></code></a>, <a class="reference internal" href="../api/images.html#astropy.io.fits.ImageHDU" title="astropy.io.fits.ImageHDU"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageHDU</span></code></a>, etc.),
and <a class="reference internal" href="../api/cards.html#astropy.io.fits.Card" title="astropy.io.fits.Card"><code class="xref py py-class docutils literal notranslate"><span class="pre">Card</span></code></a>. They are the only objects having the <code class="docutils literal notranslate"><span class="pre">verify()</span></code> method.
Most other classes in <a class="reference internal" href="../index.html#module-astropy.io.fits" title="astropy.io.fits"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.io.fits</span></code></a> do not have a <code class="docutils literal notranslate"><span class="pre">verify()</span></code> method.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">verify()</span></code> is called at the HDU List level, it verifies standard
compliance at all three levels, but a call of <code class="docutils literal notranslate"><span class="pre">verify()</span></code> at the Card level
will only check the compliance of that Card. Since <code class="docutils literal notranslate"><span class="pre">astropy</span></code> is tolerant when
reading a FITS file, no <code class="docutils literal notranslate"><span class="pre">verify()</span></code> is called on input. On output,
<code class="docutils literal notranslate"><span class="pre">verify()</span></code> is called with the most restrictive option as the default.</p>
</div>
<div class="section" id="verification-options">
<h2>Verification Options<a class="headerlink" href="#verification-options" title="Permalink to this headline">¶</a></h2>
<p>There are several options accepted by all verify(option) calls in <code class="docutils literal notranslate"><span class="pre">astropy</span></code>.
In addition, they available for the <code class="docutils literal notranslate"><span class="pre">output_verify</span></code> argument of the following
methods: <code class="docutils literal notranslate"><span class="pre">close()</span></code>, <code class="docutils literal notranslate"><span class="pre">writeto()</span></code>, and <code class="docutils literal notranslate"><span class="pre">flush()</span></code>. In these cases, they are
passed to a <code class="docutils literal notranslate"><span class="pre">verify()</span></code> call within these methods. The available options are:</p>
<p><strong>exception</strong></p>
<p>This option will raise an exception if any FITS standard is violated. This is
the default option for output (i.e., when <code class="docutils literal notranslate"><span class="pre">writeto()</span></code>, <code class="docutils literal notranslate"><span class="pre">close()</span></code>, or
<code class="docutils literal notranslate"><span class="pre">flush()</span></code> is called). If a user wants to overwrite this default on output, the
other options listed below can be used.</p>
<p><strong>warn</strong></p>
<p>This option is the same as the ignore option but will send warning messages. It
will not try to fix any FITS standard violations whether fixable or not.</p>
<p><strong>ignore</strong></p>
<p>This option will ignore any FITS standard violation. On output, it will write
the HDU List content to the output FITS file, whether or not it is conforming
to the FITS standard.</p>
<p>The ignore option is useful in the following situations:</p>
<ol class="arabic simple">
<li><p>An input FITS file with nonstandard formatting is read and the user wants
to copy or write out to an output file. The nonstandard formatting will be
preserved in the output file.</p></li>
<li><p>A user wants to create a nonstandard FITS file on purpose, possibly for
testing or consistency.</p></li>
</ol>
<p>No warning message will be printed out. This is like a silent warning option
(see below).</p>
<p><strong>fix</strong></p>
<p>This option will try to fix any FITS standard violations. It is not always
possible to fix such violations. In general, there are two kinds of FITS
standard violations: fixable and non-fixable. For example, if a keyword has a
floating number with an exponential notation in lower case ‘e’ (e.g., 1.23e11)
instead of the upper case ‘E’ as required by the FITS standard, it is a fixable
violation. On the other hand, a keyword name like ‘P.I.’ is not fixable, since
it will not know what to use to replace the disallowed periods. If a violation
is fixable, this option will print out a message noting it is fixed. If it is
not fixable, it will throw an exception.</p>
<p>The principle behind fixing is to do no harm. For example, it is plausible to
‘fix’ a Card with a keyword name like ‘P.I.’ by deleting it, but <code class="docutils literal notranslate"><span class="pre">astropy</span></code>
will not take such action to hurt the integrity of the data.</p>
<p>Not all fixes may be the “correct” fix, but at least <code class="docutils literal notranslate"><span class="pre">astropy</span></code> will try to
make the fix in such a way that it will not throw off other FITS readers.</p>
<p><strong>silentfix</strong></p>
<p>Same as fix, but will not print out informative messages. This may be useful in
a large script where the user does not want excessive harmless messages. If the
violation is not fixable, it will still throw an exception.</p>
<p>In addition the following combined options are available:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>fix+ignore</strong></p></li>
<li><p><strong>fix+warn</strong></p></li>
<li><p><strong>fix+exception</strong></p></li>
<li><p><strong>silentfix+ignore</strong></p></li>
<li><p><strong>silentfix+warn</strong></p></li>
<li><p><strong>silentfix+exception</strong></p></li>
</ul>
</div></blockquote>
<p>These options combine the semantics of the basic options. For example,
<code class="docutils literal notranslate"><span class="pre">silentfix+exception</span></code> is actually equivalent to just <code class="docutils literal notranslate"><span class="pre">silentfix</span></code> in that
fixable errors will be fixed silently, but any unfixable errors will raise an
exception. On the other hand, <code class="docutils literal notranslate"><span class="pre">silentfix+warn</span></code> will issue warnings for
unfixable errors, but will stay silent about any fixed errors.</p>
</div>
<div class="section" id="verifications-at-different-data-object-levels">
<h2>Verifications at Different Data Object Levels<a class="headerlink" href="#verifications-at-different-data-object-levels" title="Permalink to this headline">¶</a></h2>
<p>We will examine what <code class="docutils literal notranslate"><span class="pre">astropy</span></code>’s verification does at the three different
levels:</p>
<div class="section" id="verification-at-hdulist">
<h3>Verification at HDUList<a class="headerlink" href="#verification-at-hdulist" title="Permalink to this headline">¶</a></h3>
<p>At the HDU List level, the verification is only for two simple cases:</p>
<ol class="arabic simple">
<li><p>Verify that the first HDU in the HDU list is a primary HDU. This is a
fixable case. The fix is to insert a minimal primary HDU into the HDU list.</p></li>
<li><p>Verify the second or later HDU in the HDU list is not a primary HDU.
Violation will not be fixable.</p></li>
</ol>
</div>
<div class="section" id="verification-at-each-hdu">
<h3>Verification at Each HDU<a class="headerlink" href="#verification-at-each-hdu" title="Permalink to this headline">¶</a></h3>
<p>For each HDU, the mandatory keywords, their locations in the header, and their
values will be verified. Each FITS HDU has a fixed set of required keywords in
a fixed order. For example, the primary HDU’s header must at least have the
following keywords:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIMPLE</span> <span class="o">=</span>                     <span class="n">T</span> <span class="o">/</span>
<span class="n">BITPIX</span> <span class="o">=</span>                     <span class="mi">8</span> <span class="o">/</span>
<span class="n">NAXIS</span>  <span class="o">=</span>                     <span class="mi">0</span>
</pre></div>
</div>
<p>If any of the mandatory keywords are missing or in the wrong order, the fix
option will fix them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_testdata_filepath</span><span class="p">(</span><span class="s1">&#39;verify.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
<span class="go">SIMPLE  =                    T / conforms to FITS standard</span>
<span class="go">NAXIS   =                    0 / NUMBER OF AXES</span>
<span class="go">BITPIX  =                    8 / BITS PER PIXEL</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;fix&#39;</span><span class="p">)</span> 
<span class="go">VerifyWarning: Verification reported errors:</span>
<span class="go">VerifyWarning: &#39;BITPIX&#39; card at the wrong place (card 2).</span>
<span class="go">  Fixed by moving it to the right place (card 1).</span>
<span class="go">VerifyWarning: Note: astropy.io.fits uses zero-based indexing.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>           <span class="c1"># voila!</span>
<span class="go">SIMPLE  =                    T / conforms to FITS standard</span>
<span class="go">BITPIX  =                    8 / BITS PER PIXEL</span>
<span class="go">NAXIS   =                    0 / NUMBER OF AXES</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="verification-at-each-card">
<h3>Verification at Each Card<a class="headerlink" href="#verification-at-each-card" title="Permalink to this headline">¶</a></h3>
<p>The lowest level, the Card, also has the most complicated verification
possibilities.</p>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<p>Here is a list of fixable and not fixable Cards:</p>
<p>Fixable Cards:</p>
<ol class="arabic">
<li><p>Floating point numbers with lower case ‘e’ or ‘d’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;FIX1    = 2.1e23&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;silentfix&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">FIX1    =               2.1E23</span>
</pre></div>
</div>
</li>
<li><p>The equal sign is before column nine in the card image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;FIX2= 2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;silentfix&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">FIX2    =                    2</span>
</pre></div>
</div>
</li>
<li><p>String value without enclosing quotes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;FIX3    = string value without quotes&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;silentfix&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">FIX3    = &#39;string value without quotes&#39;</span>
</pre></div>
</div>
</li>
<li><p>Missing equal sign before column nine in the card image.</p></li>
<li><p>Space between numbers and E or D in floating point values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;FIX5    = 2.4 e 03&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;silentfix&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">FIX5    =               2.4E03</span>
</pre></div>
</div>
</li>
<li><p>Unparsable values will be “fixed” as a string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;FIX6    = 2 10 &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;fix+warn&#39;</span><span class="p">)</span> 
<span class="go">VerifyWarning: Verification reported errors:</span>
<span class="go">VerifyWarning: Card &#39;FIX6&#39; is not FITS standard</span>
<span class="go"> (invalid value string: &#39;2 10&#39;).</span>
<span class="go">   Fixed &#39;FIX6&#39; card to meet the FITS standard.</span>
<span class="go">VerifyWarning: Note: astropy.io.fits uses zero-based indexing.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">FIX6    = &#39;2 10    &#39;</span>
</pre></div>
</div>
</li>
</ol>
<p>Unfixable Cards:</p>
<ol class="arabic simple">
<li><p>Illegal characters in keyword name.</p></li>
</ol>
<p>We will summarize the verification with a “life-cycle” example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">()</span>  <span class="c1"># create a PrimaryHDU</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Try to add an non-standard FITS keyword &#39;P.I.&#39; (FITS does no allow</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># &#39;.&#39; in the keyword), if using the update() method - doesn&#39;t work!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;P.I.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Hubble&#39;</span> 
<span class="go">VerifyWarning: Keyword name &#39;P.I.&#39; is greater than 8 characters or</span>
<span class="go"> contains characters not allowed by the FITS standard;</span>
<span class="go">  a HIERARCH card will be created.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Have to do it the hard way (so a user will not do this by accident)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># First, create a card image and give verbatim card content (including</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the proper spacing, but no need to add the trailing blanks)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;P.I. = &#39;Hubble&#39;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># then append it to the header</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now if we try to write to a FITS file, the default output</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># verification will not take it.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;pi.fits&#39;</span><span class="p">)</span>  
<span class="gt">Traceback (most recent call last):</span>
 <span class="c">...</span>
<span class="gr">VerifyError</span>: <span class="n">HDU 0:</span>
<span class="go">    Card 5:</span>
<span class="go">        Card &#39;P.I. &#39; is not FITS standard (equal sign not at column 8).</span>
<span class="go">        Illegal keyword name &#39;P.I. &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Must set the output_verify argument to &#39;ignore&#39;, to force writing a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># non-standard FITS file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;pi.fits&#39;</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now reading a non-standard FITS file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># astropy.io.fits is magnanimous in reading non-standard FITS files</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;pi.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span> 
<span class="go">SIMPLE  =            T / conforms to FITS standard</span>
<span class="go">BITPIX  =            8 / array data type</span>
<span class="go">NAXIS   =            0 / number of array dimensions</span>
<span class="go">EXTEND  =            T</span>
<span class="go">HIERARCH P.I. = &#39;Hubble  &#39;</span>
<span class="go">P.I.    = &#39;Hubble  &#39;</span>
<span class="go">VerifyWarning: Verification reported errors:</span>
<span class="go">VerifyWarning: Card &#39;P.I. &#39; is not FITS standard (equal sign</span>
<span class="go"> not at column 8).  Fixed &#39;P.I. &#39; card to meet the FITS standard.</span>
<span class="go">VerifyWarning: Unfixable error: Illegal keyword name &#39;P.I. &#39;</span>
<span class="go">VerifyWarning: Note: astropy.io.fits uses zero-based indexing.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># even when you try to access the offending keyword, it does NOT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># complain</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;p.i.&#39;</span><span class="p">]</span>
<span class="go">&#39;Hubble&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But if you want to make sure if there is anything wrong/non-standard,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># use the verify() method</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span> 
<span class="go">VerifyWarning: Verification reported errors:</span>
<span class="go">VerifyWarning: HDU 0:</span>
<span class="go">VerifyWarning:     Card 5:</span>
<span class="go">VerifyWarning:         Illegal keyword name &#39;P.I. &#39;</span>
<span class="go">VerifyWarning: Note: astropy.io.fits uses zero-based indexing.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="verification-using-the-fits-checksum-keyword-convention">
<h2>Verification Using the FITS Checksum Keyword Convention<a class="headerlink" href="#verification-using-the-fits-checksum-keyword-convention" title="Permalink to this headline">¶</a></h2>
<p>The North American FITS committee has reviewed the FITS Checksum Keyword
Convention for possible adoption as a FITS Standard. This convention provides
an integrity check on information contained in FITS HDUs. The convention
consists of two header keyword cards: CHECKSUM and DATASUM. The CHECKSUM
keyword is defined as an ASCII character string whose value forces the 32-bit
1’s complement checksum accumulated over all the 2880-byte FITS logical records
in the HDU to equal negative zero. The DATASUM keyword is defined as a
character string containing the unsigned integer value of the 32-bit 1’s
complement checksum of the data records in the HDU. Verifying the
accumulated checksum is still equal to negative zero provides a fairly reliable
way to determine that the HDU has not been modified by subsequent data
processing operations or corrupted while copying or storing the file on
physical media.</p>
<p>In order to avoid any impact on performance, by default <code class="docutils literal notranslate"><span class="pre">astropy</span></code> will not
verify HDU checksums when a file is opened or generate checksum values when a
file is written. In fact, CHECKSUM and DATASUM cards are automatically removed
from HDU headers when a file is opened, and any CHECKSUM or DATASUM cards are
stripped from headers when an HDU is written to a file. In order to verify the
checksum values for HDUs when opening a file, the user must supply the checksum
keyword argument in the call to the open convenience function with a value of
True. When this is done, any checksum verification failure will cause a
warning to be issued (via the warnings module). If checksum verification is
requested in the open, and no CHECKSUM or DATASUM cards exist in the HDU
header, the file will open without comment. Similarly, in order to output the
CHECKSUM and DATASUM cards in an HDU header when writing to a file, the user
must supply the checksum keyword argument with a value of True in the call to
the <code class="docutils literal notranslate"><span class="pre">writeto()</span></code> function. It is possible to write only the DATASUM card to the
header by supplying the checksum keyword argument with a value of ‘datasum’.</p>
<div class="section" id="id1">
<h3>Examples<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>To verify the checksum values for HDUs when opening a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Open the file checksum.fits verifying the checksum values for all HDUs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_testdata_filepath</span><span class="p">(</span><span class="s1">&#39;checksum.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Open the file in.fits where checksum verification fails</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_testdata_filepath</span><span class="p">(</span><span class="s1">&#39;checksum_false.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="go">AstropyUserWarning: Checksum verification failed for HDU (&#39;PRIMARY&#39;, 1).</span>
<span class="go">AstropyUserWarning: Datasum verification failed for HDU (&#39;PRIMARY&#39;, 1).</span>
<span class="go">AstropyUserWarning: Checksum verification failed for HDU (&#39;RATE&#39;, 1).</span>
<span class="go">AstropyUserWarning: Datasum verification failed for HDU (&#39;RATE&#39;, 1).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create file out.fits containing an HDU constructed from data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># containing both CHECKSUM and DATASUM cards.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fits</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;out.fits&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdun</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;out.fits&#39;</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdun</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create file out.fits containing all the HDUs in the HDULIST</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># hdul with each HDU header containing only the DATASUM card</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;out2.fits&#39;</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="s1">&#39;datasum&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create file out.fits containing the HDU hdu with both CHECKSUM</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># and DATASUM cards in the header</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdu</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;out3.fits&#39;</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Append a new HDU constructed from array data to the end of</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the file existingfile.fits with only the appended HDU</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># containing both CHECKSUM and DATASUM cards.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;out3.fits&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Verification</a><ul>
<li><a class="reference internal" href="#fits-standard">FITS Standard</a></li>
<li><a class="reference internal" href="#verification-options">Verification Options</a></li>
<li><a class="reference internal" href="#verifications-at-different-data-object-levels">Verifications at Different Data Object Levels</a><ul>
<li><a class="reference internal" href="#verification-at-hdulist">Verification at HDUList</a></li>
<li><a class="reference internal" href="#verification-at-each-hdu">Verification at Each HDU</a></li>
<li><a class="reference internal" href="#verification-at-each-card">Verification at Each Card</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#verification-using-the-fits-checksum-keyword-convention">Verification Using the FITS Checksum Keyword Convention</a><ul>
<li><a class="reference internal" href="#id1">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../_sources/io/fits/usage/verification.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 08 May 2022. <br/>
  </p>
</footer>
  </body>
</html>