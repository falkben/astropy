


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cosmology For Developers &#8212; Astropy v5.2.dev104+gcdd6a1f81.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="z_at_value" href="../api/astropy.cosmology.z_at_value.html" />
    <link rel="prev" title="with_H0" href="../api/astropy.cosmology.units.with_H0.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../api/astropy.cosmology.z_at_value.html" title="z_at_value">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../api/astropy.cosmology.units.with_H0.html" title="with_H0">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev104+gcdd6a1f81.d20220509</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Cosmological Calculations (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.cosmology</span></code>)</a> &#187;</li>
      
      <li>Cosmology For Developers</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cosmology-for-developers">
<span id="astropy-cosmology-for-developers"></span><h1>Cosmology For Developers<a class="headerlink" href="#cosmology-for-developers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cosmologies-in-functions">
<h2>Cosmologies in Functions<a class="headerlink" href="#cosmologies-in-functions" title="Permalink to this headline">¶</a></h2>
<p>It is often useful to assume a default cosmology so that the exact cosmology
does not have to be specified every time a function or method is called. In
this case, it is possible to specify a “default” cosmology.</p>
<p>You can set the default cosmology to a predefined value by using the
“default_cosmology” option in the <code class="docutils literal notranslate"><span class="pre">[cosmology.core]</span></code> section of the
configuration file (see <a class="reference internal" href="../config/index.html#astropy-config"><span class="std std-ref">Configuration System (astropy.config)</span></a>). Alternatively, you can use the
<a class="reference internal" href="../api/astropy.cosmology.default_cosmology.html#astropy.cosmology.default_cosmology.set" title="astropy.cosmology.default_cosmology.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> function of
<a class="reference internal" href="../api/astropy.cosmology.default_cosmology.html#astropy.cosmology.default_cosmology" title="astropy.cosmology.default_cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">default_cosmology</span></code></a> to set a cosmology for the current Python session. If you
have not set a default cosmology using one of the methods described above, then
the cosmology module will default to using the
<code class="docutils literal notranslate"><span class="pre">default_cosmology._value</span></code> parameters.</p>
<p>You can override the default cosmology through the <a class="reference internal" href="../api/astropy.cosmology.default_cosmology.html#astropy.cosmology.default_cosmology" title="astropy.cosmology.default_cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">default_cosmology</span></code></a> science
state object, using something like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">default_cosmology</span>

<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cosmo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cosmo</span> <span class="o">=</span> <span class="n">default_cosmology</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="o">...</span> <span class="n">function</span> <span class="n">code</span> <span class="n">here</span> <span class="o">...</span>
</pre></div>
</div>
<p>This ensures that all code consistently uses the default cosmology unless
explicitly overridden.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are preparing a paper and thus need to ensure your code provides
reproducible results, it is better to use an explicit cosmology (for
example <code class="docutils literal notranslate"><span class="pre">WMAP9.H(0)</span></code> instead of <code class="docutils literal notranslate"><span class="pre">default_cosmology.get().H(0)</span></code>).
Use of the default cosmology should generally be reserved for code that
allows for the global cosmology state to be changed; e.g. code included in
<code class="docutils literal notranslate"><span class="pre">astropy</span></code> core or an affiliated package.</p>
</div>
</div>
<div class="section" id="custom-cosmologies">
<span id="astropy-cosmology-custom"></span><h2>Custom Cosmologies<a class="headerlink" href="#custom-cosmologies" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="index.html#module-astropy.cosmology" title="astropy.cosmology"><code class="xref py py-mod docutils literal notranslate"><span class="pre">astropy.cosmology</span></code></a> cosmologies are classes, so custom cosmologies may
be implemented by subclassing <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology" title="astropy.cosmology.Cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cosmology</span></code></a> (or more likely <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW" title="astropy.cosmology.FLRW"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLRW</span></code></a>) and adding
details specific to that cosmology. Here we will review some of those details
and tips and tricks to building a performant cosmology class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">FLRW</span>

<span class="k">class</span> <span class="nc">CustomCosmology</span><span class="p">(</span><span class="n">FLRW</span><span class="p">):</span>
    <span class="o">...</span>  <span class="c1"># [details discussed below]</span>
</pre></div>
</div>
<div class="section" id="parameters">
<span id="astropy-cosmology-custom-parameters"></span><h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>An astropy <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology" title="astropy.cosmology.Cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cosmology</span></code></a> is characterized by 1) its class, which encodes the
physics, and 2) its free parameter(s), which specify a cosmological realization.
When defining the former, all parameters must be declared using <a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter" title="astropy.cosmology.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> and
should have values assigned at instantiation.</p>
<p>A <a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter" title="astropy.cosmology.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> is a <a class="reference external" href="https://docs.python.org/3/howto/descriptor.html">descriptor</a>.
When accessed from a class it transparently stores information, like the units
and accepted equivalencies, that might be opaquely contained in the constructor
signature or more deeply in the code. On a cosmology instance, the descriptor
will return the parameter value.</p>
<p>There are a number of best practices. For a reference, this is excerpted from
the definition of <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW" title="astropy.cosmology.FLRW"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLRW</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FLRW</span><span class="p">(</span><span class="n">Cosmology</span><span class="p">):</span>

    <span class="n">H0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Hubble constant as an `~astropy.units.Quantity` at z=0&quot;</span><span class="p">,</span>
                   <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;km/(s Mpc)&quot;</span><span class="p">,</span> <span class="n">fvalidate</span><span class="o">=</span><span class="s2">&quot;scalar&quot;</span><span class="p">)</span>
    <span class="n">Om0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Omega matter; matter density/critical density at z=0&quot;</span><span class="p">,</span>
                    <span class="n">fvalidate</span><span class="o">=</span><span class="s2">&quot;non-negative&quot;</span><span class="p">)</span>
    <span class="n">Ode0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Omega dark energy; dark energy density/critical density at z=0.&quot;</span><span class="p">,</span>
                     <span class="n">fvalidate</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
    <span class="n">Tcmb0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Temperature of the CMB as `~astropy.units.Quantity` at z=0.&quot;</span><span class="p">,</span>
              <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Kelvin&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;0.4g&quot;</span><span class="p">,</span> <span class="n">fvalidate</span><span class="o">=</span><span class="s2">&quot;scalar&quot;</span><span class="p">)</span>
    <span class="n">Neff</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Number of effective neutrino species.&quot;</span><span class="p">,</span> <span class="n">fvalidate</span><span class="o">=</span><span class="s2">&quot;non-negative&quot;</span><span class="p">)</span>
    <span class="n">m_nu</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass of neutrino species.&quot;</span><span class="p">,</span>
             <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;eV&quot;</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">mass_energy</span><span class="p">(),</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">Ob0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Omega baryon; baryonic matter density/critical density at z=0.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">Om0</span><span class="p">,</span> <span class="n">Ode0</span><span class="p">,</span> <span class="n">Tcmb0</span><span class="o">=</span><span class="mf">0.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="mf">3.04</span><span class="p">,</span> <span class="n">m_nu</span><span class="o">=</span><span class="mf">0.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">eV</span><span class="p">,</span>
                 <span class="n">Ob0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H0</span> <span class="o">=</span> <span class="n">H0</span>
        <span class="o">...</span>  <span class="c1"># for each Parameter in turn</span>

    <span class="nd">@Ob0</span><span class="o">.</span><span class="n">validator</span>
    <span class="k">def</span> <span class="nf">Ob0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate baryon density to None or positive float &gt; matter density.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">_validate_non_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Om0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;baryonic density can not be larger than total matter density.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<p>First note that all the parameters are also arguments in <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. This is
not strictly necessary, but is good practice. If the parameter has units (and
related equivalencies) these must be specified on the Parameter, as seen in
<a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW.H0" title="astropy.cosmology.FLRW.H0"><code class="xref py py-attr docutils literal notranslate"><span class="pre">H0</span></code></a> and <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW.m_nu" title="astropy.cosmology.FLRW.m_nu"><code class="xref py py-attr docutils literal notranslate"><span class="pre">m_nu</span></code></a>.</p>
<p>The next important thing to note is how the parameter value is set, in
<code class="docutils literal notranslate"><span class="pre">__init__</span></code>. <a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter" title="astropy.cosmology.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> allows for a value to be set once (before
auto-locking), so <code class="docutils literal notranslate"><span class="pre">self.H0</span> <span class="pre">=</span> <span class="pre">H0</span></code> will use this setter and put the value on
“._H0”. The advantage of this method over direct assignment to the private
attribute is the use of validators. <a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter" title="astropy.cosmology.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> allows for custom value
validators, using the method-decorator <code class="docutils literal notranslate"><span class="pre">validator</span></code>, that can check a value’s
validity and modify the value, e.g to assign units. If no custom <code class="docutils literal notranslate"><span class="pre">validator</span></code>
is specified the default is to check if the <a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter" title="astropy.cosmology.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> has defined units and
if so, return the value as a <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Quantity</span></code></a> with those units, using all enabled and
the parameter’s unit equivalencies.</p>
<p>The last thing to note is pretty formatting for the <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology" title="astropy.cosmology.Cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cosmology</span></code></a>. Each
<a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter" title="astropy.cosmology.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> defaults to the <a class="reference external" href="https://docs.python.org/3/library/string.html#formatspec">format specification</a> “.3g”, but this
may be overridden, like <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW.Tcmb0" title="astropy.cosmology.FLRW.Tcmb0"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Tcmb0</span></code></a> does.</p>
<p>If a new cosmology modifies an existing Parameter, then the
<a class="reference internal" href="../api/astropy.cosmology.Parameter.html#astropy.cosmology.Parameter.clone" title="astropy.cosmology.Parameter.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> method is useful to deep-copy the
parameter and change any constructor argument. For example, see
<code class="docutils literal notranslate"><span class="pre">FlatFLRWMixin</span></code> in <code class="docutils literal notranslate"><span class="pre">astropy.cosmology.flrw</span></code> (also shown below).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlatFLRWMixin</span><span class="p">(</span><span class="n">FlatCosmologyMixin</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">Ode0</span> <span class="o">=</span> <span class="n">FLRW</span><span class="o">.</span><span class="n">Ode0</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">derived</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># now a derived param.</span>
</pre></div>
</div>
</div>
<div class="section" id="mixins">
<h3>Mixins<a class="headerlink" href="#mixins" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Mixin">Mixins</a> are used in
<a class="reference internal" href="index.html#module-astropy.cosmology" title="astropy.cosmology"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cosmology</span></code></a> to reuse code across multiple classes in different
inheritance lines. We use the term loosely as mixins are meant to be strictly
orthogonal, but may not be, particularly in <code class="docutils literal notranslate"><span class="pre">__init__</span></code>.</p>
<p>Currently the only mixin is <a class="reference internal" href="../api/astropy.cosmology.FlatCosmologyMixin.html#astropy.cosmology.FlatCosmologyMixin" title="astropy.cosmology.FlatCosmologyMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlatCosmologyMixin</span></code></a> and its <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW" title="astropy.cosmology.FLRW"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLRW</span></code></a>-specific
subclass <a class="reference internal" href="../api/astropy.cosmology.FlatFLRWMixin.html#astropy.cosmology.FlatFLRWMixin" title="astropy.cosmology.FlatFLRWMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlatFLRWMixin</span></code></a>. “Flat” cosmologies should use this mixin.
<a class="reference internal" href="../api/astropy.cosmology.FlatFLRWMixin.html#astropy.cosmology.FlatFLRWMixin" title="astropy.cosmology.FlatFLRWMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlatFLRWMixin</span></code></a> must precede the base class in the multiple-inheritance so that
this mixin’s <code class="docutils literal notranslate"><span class="pre">__init__</span></code> proceeds the base class’.</p>
</div>
<div class="section" id="speeding-up-integrals-in-custom-cosmologies">
<span id="astropy-cosmology-fast-integrals"></span><h3>Speeding up Integrals in Custom Cosmologies<a class="headerlink" href="#speeding-up-integrals-in-custom-cosmologies" title="Permalink to this headline">¶</a></h3>
<p>The supplied cosmology classes use a few tricks to speed up distance and time
integrals.  It is not necessary for anyone subclassing <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW" title="astropy.cosmology.FLRW"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLRW</span></code></a> to use these
tricks – but if they do, such calculations may be a lot faster.</p>
<p>The first, more basic, idea is that, in many cases, it’s a big deal to provide
explicit formulae for <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW.inv_efunc" title="astropy.cosmology.FLRW.inv_efunc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">inv_efunc()</span></code></a> rather than
simply setting up <code class="docutils literal notranslate"><span class="pre">de_energy_scale</span></code> – assuming there is a nice expression.
As noted above, almost all of the provided classes do this, and that template
can pretty much be followed directly with the appropriate formula changes.</p>
<p>The second, and more advanced, option is to also explicitly provide a scalar
only version of <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW.inv_efunc" title="astropy.cosmology.FLRW.inv_efunc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">inv_efunc()</span></code></a>. This results in a
fairly large speedup (&gt;10x in most cases) in the distance and age integrals,
even if only done in python, because testing whether the inputs are iterable or
pure scalars turns out to be rather expensive. To take advantage of this, the
key thing is to explicitly set the instance variables
<code class="docutils literal notranslate"><span class="pre">self._inv_efunc_scalar</span></code> and <code class="docutils literal notranslate"><span class="pre">self._inv_efunc_scalar_args</span></code> in the
constructor for the subclass, where the latter are all the arguments except
<code class="docutils literal notranslate"><span class="pre">z</span></code> to <code class="docutils literal notranslate"><span class="pre">_inv_efunc_scalar</span></code>. The provided classes do use this optimization,
and in fact go even further and provide optimizations for no radiation, and for
radiation with massless neutrinos coded in cython. Consult the <a class="reference internal" href="../api/astropy.cosmology.FLRW.html#astropy.cosmology.FLRW" title="astropy.cosmology.FLRW"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLRW</span></code></a>
subclasses and <code class="docutils literal notranslate"><span class="pre">scalar_inv_efuncs</span></code> for the details.</p>
<p>However, the important point is that it is <em>not</em> necessary to do this.</p>
</div>
</div>
<div class="section" id="astropy-interoperability-i-o-and-your-cosmology-package">
<span id="cosmology-mypackage"></span><h2>Astropy Interoperability: I/O and your Cosmology Package<a class="headerlink" href="#astropy-interoperability-i-o-and-your-cosmology-package" title="Permalink to this headline">¶</a></h2>
<p>If you are developing a package and want to be able to interoperate with
<a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology" title="astropy.cosmology.Cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cosmology</span></code></a>, you’re in the right place! Here we will discuss how to enable
Astropy to read and write your file formats, and convert your cosmology objects
to and from Astropy’s <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology" title="astropy.cosmology.Cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cosmology</span></code></a>.</p>
<p>The following presumes knowledge of how Astropy structures I/O functions. For
a quick tutorial see <a class="reference internal" href="io.html#cosmology-io"><span class="std std-ref">Read, Write, and Convert Cosmology Objects</span></a>.</p>
<p>Now that we know how to build and register functions into <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.read" title="astropy.cosmology.Cosmology.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>,
<a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.write" title="astropy.cosmology.Cosmology.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a>, <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.from_format" title="astropy.cosmology.Cosmology.from_format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_format()</span></code></a>, <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.to_format" title="astropy.cosmology.Cosmology.to_format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_format()</span></code></a>, we can do
this in your package.</p>
<p>Consider a package – since this is mine, it’s cleverly named <code class="docutils literal notranslate"><span class="pre">mypackage</span></code> –
with the following file structure: a module for cosmology codes and a module
for defining related input/output functions. In the cosmology module are
defined cosmology classes and a file format – <code class="docutils literal notranslate"><span class="pre">myformat</span></code> – and everything
should interoperate with astropy. The tests are done with <a class="reference external" href="https://docs.pytest.org/en/stable/index.html#module-pytest" title="(in pytest v7.1.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pytest</span></code></a> and are
integrated within the code structure.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mypackage/
    __init__.py
    cosmology/
        __init__.py
        ...
    io/
<span class="hll">        __init__.py
</span><span class="hll">        astropy_convert.py
</span><span class="hll">        astropy_io.py
</span>        ...
        tests/
            __init__.py
<span class="hll">            test_astropy_convert.py
</span><span class="hll">            test_astropy_io.py
</span>            ...
</pre></div>
</div>
<div class="section" id="converting-objects-between-packages">
<h3>Converting Objects Between Packages<a class="headerlink" href="#converting-objects-between-packages" title="Permalink to this headline">¶</a></h3>
<p>We want to enable conversion between cosmology objects from <code class="docutils literal notranslate"><span class="pre">mypackage</span></code>
to/from <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology" title="astropy.cosmology.Cosmology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cosmology</span></code></a>. All the Astropy interface code is defined in
<code class="docutils literal notranslate"><span class="pre">mypackage/io/astropy_convert.py</span></code>. The following is a rough outline of the
necessary functions and how to register them with astropy’s unified I/O to be
automatically available to <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.from_format" title="astropy.cosmology.Cosmology.from_format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_format()</span></code></a> and <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.to_format" title="astropy.cosmology.Cosmology.to_format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_format()</span></code></a>.</p>
</div>
<div class="section" id="reading-and-writing">
<h3>Reading and Writing<a class="headerlink" href="#reading-and-writing" title="Permalink to this headline">¶</a></h3>
<p>Everything Astropy read/write related is defined in
<code class="docutils literal notranslate"><span class="pre">mypackage/io/astropy_io.py</span></code>. The following is a rough outline of the read,
write, and identify functions and how to register them with astropy’s unified
IO to be automatically available to <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.read" title="astropy.cosmology.Cosmology.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a> and <a class="reference internal" href="../api/astropy.cosmology.Cosmology.html#astropy.cosmology.Cosmology.write" title="astropy.cosmology.Cosmology.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a>.</p>
</div>
<div class="section" id="if-astropy-is-an-optional-dependency">
<h3>If Astropy is an optional dependency<a class="headerlink" href="#if-astropy-is-an-optional-dependency" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">astropy_io</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy_convert</span></code> modules are written assuming Astropy
is installed. If in <code class="docutils literal notranslate"><span class="pre">mypackage</span></code> it is an optional dependency then it is
important to detect if Astropy is installed (and the correct version) before
importing <code class="docutils literal notranslate"><span class="pre">astropy_io</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy_convert</span></code>.
We do this in <code class="docutils literal notranslate"><span class="pre">mypackage/io/__init__.py</span></code>:</p>
</div>
<div class="section" id="astropy-interoperability-tests">
<h3>Astropy Interoperability Tests<a class="headerlink" href="#astropy-interoperability-tests" title="Permalink to this headline">¶</a></h3>
<p>Lastly, it’s important to test that everything works. In this example package
all such tests are contained in <code class="docutils literal notranslate"><span class="pre">mypackage/io/tests/test_astropy_io.py</span></code>.
These tests require Astropy and will be skipped if it is not installed (and
not the correct version), so at least one test in the test matrix should
include <code class="docutils literal notranslate"><span class="pre">astropy</span> <span class="pre">&gt;=</span> <span class="pre">5.0</span></code>.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Cosmology For Developers</a><ul>
<li><a class="reference internal" href="#cosmologies-in-functions">Cosmologies in Functions</a></li>
<li><a class="reference internal" href="#custom-cosmologies">Custom Cosmologies</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#mixins">Mixins</a></li>
<li><a class="reference internal" href="#speeding-up-integrals-in-custom-cosmologies">Speeding up Integrals in Custom Cosmologies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#astropy-interoperability-i-o-and-your-cosmology-package">Astropy Interoperability: I/O and your Cosmology Package</a><ul>
<li><a class="reference internal" href="#converting-objects-between-packages">Converting Objects Between Packages</a></li>
<li><a class="reference internal" href="#reading-and-writing">Reading and Writing</a></li>
<li><a class="reference internal" href="#if-astropy-is-an-optional-dependency">If Astropy is an optional dependency</a></li>
<li><a class="reference internal" href="#astropy-interoperability-tests">Astropy Interoperability Tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/cosmology/dev.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 09 May 2022. <br/>
  </p>
</footer>
  </body>
</html>