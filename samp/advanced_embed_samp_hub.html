


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Embedding a SAMP Hub in a GUI &#8212; Astropy v5.2.dev94+gb1133d712.d20220509</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Conf" href="../api/astropy.samp.Conf.html" />
    <link rel="prev" title="Communication between Integrated Clients Objects" href="example_clients.html" />
  
  <meta name="robots" content="noindex, nofollow">
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>


  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../api/astropy.samp.Conf.html" title="Conf">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="example_clients.html" title="Communication between Integrated Clients Objects">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v5.2.dev94+gb1133d712.d20220509</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">SAMP (Simple Application Messaging Protocol) (<code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.samp</span></code>)</a> &#187;</li>
      
      <li>Embedding a SAMP Hub in a GUI</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="embedding-a-samp-hub-in-a-gui">
<h1>Embedding a SAMP Hub in a GUI<a class="headerlink" href="#embedding-a-samp-hub-in-a-gui" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>If you wish to embed a SAMP hub in your Python Graphical User Interface (GUI)
tool, you will need to start the hub programmatically using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.samp</span> <span class="kn">import</span> <span class="n">SAMPHubServer</span>
<span class="n">hub</span> <span class="o">=</span> <span class="n">SAMPHubServer</span><span class="p">()</span>
<span class="n">hub</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>This launches the hub in a thread and is non-blocking. If you are not
interested in connections from web SAMP clients, then you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.samp</span> <span class="kn">import</span> <span class="n">SAMPHubServer</span>
<span class="n">hub</span> <span class="o">=</span> <span class="n">SAMPHubServer</span><span class="p">(</span><span class="n">web_profile</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hub</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>This should be all you need to do. However, if you want to keep the Web
Profile active, there is an additional consideration: when a web
SAMP client connects, you will need to ask the user whether they accept the
connection (for security reasons). By default, the confirmation message is a
text-based message in the terminal, but if you have a GUI tool, you will
likely want to open a GUI dialog instead.</p>
<p>To do this, you will need to define a class that handles the dialog, and then
pass an <strong>instance</strong> of the class to <a class="reference internal" href="../api/astropy.samp.SAMPHubServer.html#astropy.samp.SAMPHubServer" title="astropy.samp.SAMPHubServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">SAMPHubServer</span></code></a> (not the class itself).
This class should inherit from <a class="reference internal" href="../api/astropy.samp.WebProfileDialog.html#astropy.samp.WebProfileDialog" title="astropy.samp.WebProfileDialog"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.samp.WebProfileDialog</span></code></a> and add the
following:</p>
<blockquote>
<div><ol class="arabic">
<li><p>A GUI timer callback that periodically calls
<code class="docutils literal notranslate"><span class="pre">WebProfileDialog.handle_queue</span></code> (available as
<code class="docutils literal notranslate"><span class="pre">self.handle_queue</span></code>).</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">show_dialog</span></code> method to display a consent dialog.
It should take the following arguments:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samp_name</span></code>: The name of the application making the request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">details</span></code>: A dictionary of details about the client
making the request. The only key in this dictionary required by
the SAMP standard is <code class="docutils literal notranslate"><span class="pre">samp.name</span></code> which gives the name of the
client making the request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">client</span></code>: A hostname, port pair containing the client
address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">origin</span></code>: A string containing the origin of the
request.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Based on the user response, the <code class="docutils literal notranslate"><span class="pre">show_dialog</span></code> should call
<code class="docutils literal notranslate"><span class="pre">WebProfileDialog.consent</span></code> or <code class="docutils literal notranslate"><span class="pre">WebProfileDialog.reject</span></code>.
This may, in some cases, be the result of another GUI callback.</p></li>
</ol>
</div></blockquote>
<div class="section" id="example-of-embedding-a-samp-hub-in-a-tk-application">
<h3>Example of embedding a SAMP hub in a Tk application<a class="headerlink" href="#example-of-embedding-a-samp-hub-in-a-tk-application" title="Permalink to this headline">¶</a></h3>
<p>The following code is a full example of a Tk application that watches for web
SAMP connections and opens the appropriate dialog:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">import</span> <span class="nn">tkinter.messagebox</span> <span class="k">as</span> <span class="nn">tkMessageBox</span>

<span class="kn">from</span> <span class="nn">astropy.samp</span> <span class="kn">import</span> <span class="n">SAMPHubServer</span>
<span class="kn">from</span> <span class="nn">astropy.samp.hub</span> <span class="kn">import</span> <span class="n">WebProfileDialog</span>

<span class="n">MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">A Web application which declares to be</span>

<span class="s2">Name: </span><span class="si">{name}</span><span class="s2"></span>
<span class="s2">Origin: </span><span class="si">{origin}</span><span class="s2"></span>

<span class="s2">is requesting to be registered with the SAMP Hub.  Pay attention</span>
<span class="s2">that if you permit its registration, such application will acquire</span>
<span class="s2">all current user privileges, like file read/write.</span>

<span class="s2">Do you give your consent?</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">TkWebProfileDialog</span><span class="p">(</span><span class="n">WebProfileDialog</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">wait_for_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_dialog</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samp_name</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">MESSAGE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">samp_name</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">tkMessageBox</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
            <span class="s1">&#39;SAMP Hub&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">tkMessageBox</span><span class="o">.</span><span class="n">NO</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consent</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">()</span>

<span class="c1"># Start up Tk application</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
<span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Example SAMP Tk application&quot;</span><span class="p">,</span>
         <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span> <span class="n">justify</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;500x500&quot;</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="c1"># Start up SAMP hub</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">SAMPHubServer</span><span class="p">(</span><span class="n">web_profile_dialog</span><span class="o">=</span><span class="n">TkWebProfileDialog</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">h</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Main GUI loop</span>
    <span class="n">root</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">h</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p>If you run the above script, a window will open that says “Example SAMP Tk
application.” If you then go to the following page, for example:</p>
<p><a class="reference external" href="http://astrojs.github.io/sampjs/examples/pinger.html">http://astrojs.github.io/sampjs/examples/pinger.html</a></p>
<p>and click on the Ping button, you will see the dialog open in the Tk
application. Once you click on “CONFIRM,” future “Ping” calls will no longer
bring up the dialog.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Embedding a SAMP Hub in a GUI</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#example-of-embedding-a-samp-hub-in-a-tk-application">Example of embedding a SAMP hub in a Tk application</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/samp/advanced_embed_samp_hub.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011–2022, The Astropy Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.5.4. &nbsp;
    Last built 08 May 2022. <br/>
  </p>
</footer>
  </body>
</html>